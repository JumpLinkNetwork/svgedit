svgedit={NS:{HTML:"http://www.w3.org/1999/xhtml",MATH:"http://www.w3.org/1998/Math/MathML",SE:"http://svg-edit.googlecode.com",SVG:"http://www.w3.org/2000/svg",XLINK:"http://www.w3.org/1999/xlink",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}};svgedit.getReverseNS=function(){var a={};$.each(this.NS,function(t,l){a[l]=t.toLowerCase()});return a};(function(){var a=jQuery.fn.attr;jQuery.fn.attr=function(t,l){var b,d=this.length;if(!d)return a.apply(this,arguments);for(b=0;b<d;++b){var k=this[b];if(k.namespaceURI==="http://www.w3.org/2000/svg"){if(l!==undefined)k.setAttribute(t,l);else if($.isArray(t)){d=t.length;for(var e={};d--;){var v=t[d];if((b=k.getAttribute(v))||b==="0")b=isNaN(b)?b:b-0;e[v]=b}return e}if(typeof t==="object")for(e in t)k.setAttribute(e,t[e]);else{if((b=k.getAttribute(t))||b==="0")b=isNaN(b)?b:b-0;return b}}else return a.apply(this,
arguments)}return this}})();jQuery&&function(){var a=$(window),t=$(document);$.extend($.fn,{contextMenu:function(l,b){if(l.menu==undefined)return false;if(l.inSpeed==undefined)l.inSpeed=150;if(l.outSpeed==undefined)l.outSpeed=75;if(l.inSpeed==0)l.inSpeed=-1;if(l.outSpeed==0)l.outSpeed=-1;$(this).each(function(){var d=$(this),k=$(d).offset(),e=$("#"+l.menu);e.addClass("contextMenu");$(this).bind("mousedown",function(v){$(this).mouseup(function(z){var N=$(this);N.unbind("mouseup");if(v.button===2||l.allowLeft||v.ctrlKey&&svgedit.browser.isMac()){z.stopPropagation();
$(".contextMenu").hide();if(d.hasClass("disabled"))return false;var B=z.pageX,f=z.pageY;z=a.width()-e.width();var m=a.height()-e.height();if(B>z-15)B=z-15;if(f>m-30)f=m-30;t.unbind("click");e.css({top:f,left:B}).fadeIn(l.inSpeed);e.find("A").mouseover(function(){e.find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){e.find("LI.hover").removeClass("hover")});t.keypress(function(i){switch(i.keyCode){case 38:if(e.find("LI.hover").length){e.find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");
e.find("LI.hover").length||e.find("LI:last").addClass("hover")}else e.find("LI:last").addClass("hover");break;case 40:if(e.find("LI.hover").length==0)e.find("LI:first").addClass("hover");else{e.find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");e.find("LI.hover").length||e.find("LI:first").addClass("hover")}break;case 13:e.find("LI.hover A").trigger("click");break;case 27:t.trigger("click")}});e.find("A").unbind("mouseup");e.find("LI:not(.disabled) A").mouseup(function(){t.unbind("click").unbind("keypress");
$(".contextMenu").hide();b&&b($(this).attr("href").substr(1),$(N),{x:B-k.left,y:f-k.top,docX:B,docY:f});return false});setTimeout(function(){t.click(function(){t.unbind("click").unbind("keypress");e.fadeOut(l.outSpeed);return false})},0)}})});if($.browser.mozilla)$("#"+l.menu).each(function(){$(this).css({MozUserSelect:"none"})});else $.browser.msie?$("#"+l.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+l.menu).each(function(){$(this).bind("mousedown.disableTextSelect",
function(){return false})});$(d).add($("UL.contextMenu")).bind("contextmenu",function(){return false})});return $(this)},disableContextMenuItems:function(l){if(l==undefined){$(this).find("LI").addClass("disabled");return $(this)}$(this).each(function(){if(l!=undefined)for(var b=l.split(","),d=0;d<b.length;d++)$(this).find('A[href="'+b[d]+'"]').parent().addClass("disabled")});return $(this)},enableContextMenuItems:function(l){if(l==undefined){$(this).find("LI.disabled").removeClass("disabled");return $(this)}$(this).each(function(){if(l!=
undefined)for(var b=l.split(","),d=0;d<b.length;d++)$(this).find('A[href="'+b[d]+'"]').parent().removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)}})}(jQuery);(function(){if(!window.SVGPathSeg){window.SVGPathSeg=function(a,t,l){this.pathSegType=a;this.pathSegTypeAsLetter=t;this._owningPathSegList=l};SVGPathSeg.PATHSEG_UNKNOWN=0;SVGPathSeg.PATHSEG_CLOSEPATH=1;SVGPathSeg.PATHSEG_MOVETO_ABS=2;SVGPathSeg.PATHSEG_MOVETO_REL=3;SVGPathSeg.PATHSEG_LINETO_ABS=4;SVGPathSeg.PATHSEG_LINETO_REL=5;SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS=6;SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL=7;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS=8;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL=9;SVGPathSeg.PATHSEG_ARC_ABS=
10;SVGPathSeg.PATHSEG_ARC_REL=11;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS=12;SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL=13;SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS=14;SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL=15;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS=16;SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL=17;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS=18;SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL=19;SVGPathSeg.prototype._segmentChanged=function(){this._owningPathSegList&&this._owningPathSegList.segmentChanged(this)};
window.SVGPathSegClosePath=function(a){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CLOSEPATH,"z",a)};SVGPathSegClosePath.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegClosePath.prototype.toString=function(){return"[object SVGPathSegClosePath]"};SVGPathSegClosePath.prototype._asPathString=function(){return this.pathSegTypeAsLetter};SVGPathSegClosePath.prototype.clone=function(){return new SVGPathSegClosePath(undefined)};window.SVGPathSegMovetoAbs=function(a,t,l){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_ABS,
"M",a);this._x=t;this._y=l};SVGPathSegMovetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoAbs.prototype.toString=function(){return"[object SVGPathSegMovetoAbs]"};SVGPathSegMovetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoAbs.prototype.clone=function(){return new SVGPathSegMovetoAbs(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoAbs.prototype,"x",{get:function(){return this._x},set:function(a){this._x=
a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegMovetoAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});window.SVGPathSegMovetoRel=function(a,t,l){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_MOVETO_REL,"m",a);this._x=t;this._y=l};SVGPathSegMovetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegMovetoRel.prototype.toString=function(){return"[object SVGPathSegMovetoRel]"};SVGPathSegMovetoRel.prototype._asPathString=
function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegMovetoRel.prototype.clone=function(){return new SVGPathSegMovetoRel(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegMovetoRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegMovetoRel.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoAbs=
function(a,t,l){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_ABS,"L",a);this._x=t;this._y=l};SVGPathSegLinetoAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoAbs.prototype.toString=function(){return"[object SVGPathSegLinetoAbs]"};SVGPathSegLinetoAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoAbs.prototype.clone=function(){return new SVGPathSegLinetoAbs(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoAbs.prototype,
"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegLinetoAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoRel=function(a,t,l){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_REL,"l",a);this._x=t;this._y=l};SVGPathSegLinetoRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoRel.prototype.toString=function(){return"[object SVGPathSegLinetoRel]"};
SVGPathSegLinetoRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegLinetoRel.prototype.clone=function(){return new SVGPathSegLinetoRel(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegLinetoRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegLinetoRel.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},
enumerable:true});window.SVGPathSegCurvetoCubicAbs=function(a,t,l,b,d,k,e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS,"C",a);this._x=t;this._y=l;this._x1=b;this._y1=d;this._x2=k;this._y2=e};SVGPathSegCurvetoCubicAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicAbs]"};SVGPathSegCurvetoCubicAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+
" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicAbs(undefined,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});
Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x1",{get:function(){return this._x1},set:function(a){this._x1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"y1",{get:function(){return this._y1},set:function(a){this._y1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,"x2",{get:function(){return this._x2},set:function(a){this._x2=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicAbs.prototype,
"y2",{get:function(){return this._y2},set:function(a){this._y2=a;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoCubicRel=function(a,t,l,b,d,k,e){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL,"c",a);this._x=t;this._y=l;this._x1=b;this._y1=d;this._x2=k;this._y2=e};SVGPathSegCurvetoCubicRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicRel]"};SVGPathSegCurvetoCubicRel.prototype._asPathString=
function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicRel(undefined,this._x,this._y,this._x1,this._y1,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y",{get:function(){return this._y},
set:function(a){this._y=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x1",{get:function(){return this._x1},set:function(a){this._x1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y1",{get:function(){return this._y1},set:function(a){this._y1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"x2",{get:function(){return this._x2},set:function(a){this._x2=
a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicRel.prototype,"y2",{get:function(){return this._y2},set:function(a){this._y2=a;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoQuadraticAbs=function(a,t,l,b,d){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS,"Q",a);this._x=t;this._y=l;this._x1=b;this._y1=d};SVGPathSegCurvetoQuadraticAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticAbs.prototype.toString=
function(){return"[object SVGPathSegCurvetoQuadraticAbs]"};SVGPathSegCurvetoQuadraticAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticAbs(undefined,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});
Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"x1",{get:function(){return this._x1},set:function(a){this._x1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticAbs.prototype,"y1",{get:function(){return this._y1},set:function(a){this._y1=a;this._segmentChanged()},enumerable:true});
window.SVGPathSegCurvetoQuadraticRel=function(a,t,l,b,d){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL,"q",a);this._x=t;this._y=l;this._x1=b;this._y1=d};SVGPathSegCurvetoQuadraticRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticRel]"};SVGPathSegCurvetoQuadraticRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x1+" "+this._y1+" "+this._x+" "+this._y};
SVGPathSegCurvetoQuadraticRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticRel(undefined,this._x,this._y,this._x1,this._y1)};Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,
"x1",{get:function(){return this._x1},set:function(a){this._x1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticRel.prototype,"y1",{get:function(){return this._y1},set:function(a){this._y1=a;this._segmentChanged()},enumerable:true});window.SVGPathSegArcAbs=function(a,t,l,b,d,k,e,v){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_ABS,"A",a);this._x=t;this._y=l;this._r1=b;this._r2=d;this._angle=k;this._largeArcFlag=e;this._sweepFlag=v};SVGPathSegArcAbs.prototype=
Object.create(SVGPathSeg.prototype);SVGPathSegArcAbs.prototype.toString=function(){return"[object SVGPathSegArcAbs]"};SVGPathSegArcAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcAbs.prototype.clone=function(){return new SVGPathSegArcAbs(undefined,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcAbs.prototype,
"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"r1",{get:function(){return this._r1},set:function(a){this._r1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"r2",{get:function(){return this._r2},set:function(a){this._r2=
a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(a){this._largeArcFlag=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcAbs.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(a){this._sweepFlag=
a;this._segmentChanged()},enumerable:true});window.SVGPathSegArcRel=function(a,t,l,b,d,k,e,v){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_ARC_REL,"a",a);this._x=t;this._y=l;this._r1=b;this._r2=d;this._angle=k;this._largeArcFlag=e;this._sweepFlag=v};SVGPathSegArcRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegArcRel.prototype.toString=function(){return"[object SVGPathSegArcRel]"};SVGPathSegArcRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._r1+" "+this._r2+" "+
this._angle+" "+(this._largeArcFlag?"1":"0")+" "+(this._sweepFlag?"1":"0")+" "+this._x+" "+this._y};SVGPathSegArcRel.prototype.clone=function(){return new SVGPathSegArcRel(undefined,this._x,this._y,this._r1,this._r2,this._angle,this._largeArcFlag,this._sweepFlag)};Object.defineProperty(SVGPathSegArcRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"y",{get:function(){return this._y},
set:function(a){this._y=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"r1",{get:function(){return this._r1},set:function(a){this._r1=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"r2",{get:function(){return this._r2},set:function(a){this._r2=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=
a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"largeArcFlag",{get:function(){return this._largeArcFlag},set:function(a){this._largeArcFlag=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegArcRel.prototype,"sweepFlag",{get:function(){return this._sweepFlag},set:function(a){this._sweepFlag=a;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoHorizontalAbs=function(a,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS,
"H",a);this._x=t};SVGPathSegLinetoHorizontalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalAbs]"};SVGPathSegLinetoHorizontalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalAbs.prototype.clone=function(){return new SVGPathSegLinetoHorizontalAbs(undefined,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype,"x",{get:function(){return this._x},
set:function(a){this._x=a;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoHorizontalRel=function(a,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL,"h",a);this._x=t};SVGPathSegLinetoHorizontalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoHorizontalRel.prototype.toString=function(){return"[object SVGPathSegLinetoHorizontalRel]"};SVGPathSegLinetoHorizontalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x};SVGPathSegLinetoHorizontalRel.prototype.clone=
function(){return new SVGPathSegLinetoHorizontalRel(undefined,this._x)};Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoVerticalAbs=function(a,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS,"V",a);this._y=t};SVGPathSegLinetoVerticalAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalAbs.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalAbs]"};
SVGPathSegLinetoVerticalAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalAbs.prototype.clone=function(){return new SVGPathSegLinetoVerticalAbs(undefined,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});window.SVGPathSegLinetoVerticalRel=function(a,t){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL,"v",a);
this._y=t};SVGPathSegLinetoVerticalRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegLinetoVerticalRel.prototype.toString=function(){return"[object SVGPathSegLinetoVerticalRel]"};SVGPathSegLinetoVerticalRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._y};SVGPathSegLinetoVerticalRel.prototype.clone=function(){return new SVGPathSegLinetoVerticalRel(undefined,this._y)};Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype,"y",{get:function(){return this._y},
set:function(a){this._y=a;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoCubicSmoothAbs=function(a,t,l,b,d){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS,"S",a);this._x=t;this._y=l;this._x2=b;this._y2=d};SVGPathSegCurvetoCubicSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothAbs]"};SVGPathSegCurvetoCubicSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+
" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothAbs(undefined,this._x,this._y,this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},
enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"x2",{get:function(){return this._x2},set:function(a){this._x2=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothAbs.prototype,"y2",{get:function(){return this._y2},set:function(a){this._y2=a;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoCubicSmoothRel=function(a,t,l,b,d){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL,"s",a);this._x=t;
this._y=l;this._x2=b;this._y2=d};SVGPathSegCurvetoCubicSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoCubicSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoCubicSmoothRel]"};SVGPathSegCurvetoCubicSmoothRel.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x2+" "+this._y2+" "+this._x+" "+this._y};SVGPathSegCurvetoCubicSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoCubicSmoothRel(undefined,this._x,this._y,
this._x2,this._y2)};Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"x2",{get:function(){return this._x2},set:function(a){this._x2=a;this._segmentChanged()},
enumerable:true});Object.defineProperty(SVGPathSegCurvetoCubicSmoothRel.prototype,"y2",{get:function(){return this._y2},set:function(a){this._y2=a;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoQuadraticSmoothAbs=function(a,t,l){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS,"T",a);this._x=t;this._y=l};SVGPathSegCurvetoQuadraticSmoothAbs.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothAbs.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothAbs]"};
SVGPathSegCurvetoQuadraticSmoothAbs.prototype._asPathString=function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothAbs.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothAbs.prototype,
"y",{get:function(){return this._y},set:function(a){this._y=a;this._segmentChanged()},enumerable:true});window.SVGPathSegCurvetoQuadraticSmoothRel=function(a,t,l){SVGPathSeg.call(this,SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL,"t",a);this._x=t;this._y=l};SVGPathSegCurvetoQuadraticSmoothRel.prototype=Object.create(SVGPathSeg.prototype);SVGPathSegCurvetoQuadraticSmoothRel.prototype.toString=function(){return"[object SVGPathSegCurvetoQuadraticSmoothRel]"};SVGPathSegCurvetoQuadraticSmoothRel.prototype._asPathString=
function(){return this.pathSegTypeAsLetter+" "+this._x+" "+this._y};SVGPathSegCurvetoQuadraticSmoothRel.prototype.clone=function(){return new SVGPathSegCurvetoQuadraticSmoothRel(undefined,this._x,this._y)};Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a;this._segmentChanged()},enumerable:true});Object.defineProperty(SVGPathSegCurvetoQuadraticSmoothRel.prototype,"y",{get:function(){return this._y},set:function(a){this._y=
a;this._segmentChanged()},enumerable:true});SVGPathElement.prototype.createSVGPathSegClosePath=function(){return new SVGPathSegClosePath(undefined)};SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(a,t){return new SVGPathSegMovetoAbs(undefined,a,t)};SVGPathElement.prototype.createSVGPathSegMovetoRel=function(a,t){return new SVGPathSegMovetoRel(undefined,a,t)};SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(a,t){return new SVGPathSegLinetoAbs(undefined,a,t)};SVGPathElement.prototype.createSVGPathSegLinetoRel=
function(a,t){return new SVGPathSegLinetoRel(undefined,a,t)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(a,t,l,b,d,k){return new SVGPathSegCurvetoCubicAbs(undefined,a,t,l,b,d,k)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(a,t,l,b,d,k){return new SVGPathSegCurvetoCubicRel(undefined,a,t,l,b,d,k)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(a,t,l,b){return new SVGPathSegCurvetoQuadraticAbs(undefined,a,t,l,b)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=
function(a,t,l,b){return new SVGPathSegCurvetoQuadraticRel(undefined,a,t,l,b)};SVGPathElement.prototype.createSVGPathSegArcAbs=function(a,t,l,b,d,k,e){return new SVGPathSegArcAbs(undefined,a,t,l,b,d,k,e)};SVGPathElement.prototype.createSVGPathSegArcRel=function(a,t,l,b,d,k,e){return new SVGPathSegArcRel(undefined,a,t,l,b,d,k,e)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(a){return new SVGPathSegLinetoHorizontalAbs(undefined,a)};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=
function(a){return new SVGPathSegLinetoHorizontalRel(undefined,a)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(a){return new SVGPathSegLinetoVerticalAbs(undefined,a)};SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(a){return new SVGPathSegLinetoVerticalRel(undefined,a)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(a,t,l,b){return new SVGPathSegCurvetoCubicSmoothAbs(undefined,a,t,l,b)};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=
function(a,t,l,b){return new SVGPathSegCurvetoCubicSmoothRel(undefined,a,t,l,b)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(a,t){return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined,a,t)};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(a,t){return new SVGPathSegCurvetoQuadraticSmoothRel(undefined,a,t)}}if(!window.SVGPathSegList){window.SVGPathSegList=function(a){this._pathElement=a;this._list=this._parsePath(this._pathElement.getAttribute("d"));
this._mutationObserverConfig={attributes:true,attributeFilter:["d"]};this._pathElementMutationObserver=new MutationObserver(this._updateListFromPathMutations.bind(this));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};Object.defineProperty(SVGPathSegList.prototype,"numberOfItems",{get:function(){this._checkPathSynchronizedToList();return this._list.length}});SVGPathSegList.prototype._checkPathSynchronizedToList=function(){this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords())};
SVGPathSegList.prototype._updateListFromPathMutations=function(a){if(this._pathElement){var t=false;a.forEach(function(l){if(l.attributeName=="d")t=true});if(t)this._list=this._parsePath(this._pathElement.getAttribute("d"))}};SVGPathSegList.prototype._writeListToPath=function(){this._pathElementMutationObserver.disconnect();this._pathElement.setAttribute("d",SVGPathSegList._pathSegArrayAsString(this._list));this._pathElementMutationObserver.observe(this._pathElement,this._mutationObserverConfig)};
SVGPathSegList.prototype.segmentChanged=function(){this._writeListToPath()};SVGPathSegList.prototype.clear=function(){this._checkPathSynchronizedToList();this._list.forEach(function(a){a._owningPathSegList=null});this._list=[];this._writeListToPath()};SVGPathSegList.prototype.initialize=function(a){this._checkPathSynchronizedToList();this._list=[a];a._owningPathSegList=this;this._writeListToPath();return a};SVGPathSegList.prototype._checkValidIndex=function(a){if(isNaN(a)||a<0||a>=this.numberOfItems)throw"INDEX_SIZE_ERR";
};SVGPathSegList.prototype.getItem=function(a){this._checkPathSynchronizedToList();this._checkValidIndex(a);return this._list[a]};SVGPathSegList.prototype.insertItemBefore=function(a,t){this._checkPathSynchronizedToList();if(t>this.numberOfItems)t=this.numberOfItems;if(a._owningPathSegList)a=a.clone();this._list.splice(t,0,a);a._owningPathSegList=this;this._writeListToPath();return a};SVGPathSegList.prototype.replaceItem=function(a,t){this._checkPathSynchronizedToList();if(a._owningPathSegList)a=
a.clone();this._checkValidIndex(t);this._list[t]=a;a._owningPathSegList=this;this._writeListToPath();return a};SVGPathSegList.prototype.removeItem=function(a){this._checkPathSynchronizedToList();this._checkValidIndex(a);var t=this._list[a];this._list.splice(a,1);this._writeListToPath();return t};SVGPathSegList.prototype.appendItem=function(a){this._checkPathSynchronizedToList();if(a._owningPathSegList)a=a.clone();this._list.push(a);a._owningPathSegList=this;this._writeListToPath();return a};SVGPathSegList._pathSegArrayAsString=
function(a){var t="",l=true;a.forEach(function(b){if(l){l=false;t+=b._asPathString()}else t+=" "+b._asPathString()});return t};SVGPathSegList.prototype._parsePath=function(a){if(!a||a.length==0)return[];var t=this,l=function(){this.pathSegList=[]};l.prototype.appendSegment=function(d){this.pathSegList.push(d)};var b=function(d){this._string=d;this._currentIndex=0;this._endIndex=this._string.length;this._previousCommand=SVGPathSeg.PATHSEG_UNKNOWN;this._skipOptionalSpaces()};b.prototype._isCurrentSpace=
function(){var d=this._string[this._currentIndex];return d<=" "&&(d==" "||d=="\n"||d=="\t"||d=="\r"||d=="\u000c")};b.prototype._skipOptionalSpaces=function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex++;return this._currentIndex<this._endIndex};b.prototype._skipOptionalSpacesOrDelimiter=function(){if(this._currentIndex<this._endIndex&&!this._isCurrentSpace()&&this._string.charAt(this._currentIndex)!=",")return false;if(this._skipOptionalSpaces())if(this._currentIndex<
this._endIndex&&this._string.charAt(this._currentIndex)==","){this._currentIndex++;this._skipOptionalSpaces()}return this._currentIndex<this._endIndex};b.prototype.hasMoreData=function(){return this._currentIndex<this._endIndex};b.prototype.peekSegmentType=function(){return this._pathSegTypeFromChar(this._string[this._currentIndex])};b.prototype._pathSegTypeFromChar=function(d){switch(d){case "Z":case "z":return SVGPathSeg.PATHSEG_CLOSEPATH;case "M":return SVGPathSeg.PATHSEG_MOVETO_ABS;case "m":return SVGPathSeg.PATHSEG_MOVETO_REL;
case "L":return SVGPathSeg.PATHSEG_LINETO_ABS;case "l":return SVGPathSeg.PATHSEG_LINETO_REL;case "C":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;case "c":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;case "Q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;case "q":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;case "A":return SVGPathSeg.PATHSEG_ARC_ABS;case "a":return SVGPathSeg.PATHSEG_ARC_REL;case "H":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;case "h":return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;
case "V":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;case "v":return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;case "S":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;case "s":return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;case "T":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;case "t":return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;default:return SVGPathSeg.PATHSEG_UNKNOWN}};b.prototype._nextCommandHelper=function(d,k){if((d=="+"||d=="-"||d=="."||d>="0"&&d<="9")&&k!=SVGPathSeg.PATHSEG_CLOSEPATH){if(k==
SVGPathSeg.PATHSEG_MOVETO_ABS)return SVGPathSeg.PATHSEG_LINETO_ABS;if(k==SVGPathSeg.PATHSEG_MOVETO_REL)return SVGPathSeg.PATHSEG_LINETO_REL;return k}return SVGPathSeg.PATHSEG_UNKNOWN};b.prototype.initialCommandIsMoveTo=function(){if(!this.hasMoreData())return true;var d=this.peekSegmentType();return d==SVGPathSeg.PATHSEG_MOVETO_ABS||d==SVGPathSeg.PATHSEG_MOVETO_REL};b.prototype._parseNumber=function(){var d=0,k=0,e=1,v=0,z=1,N=1,B=this._currentIndex;this._skipOptionalSpaces();if(this._currentIndex<
this._endIndex&&this._string.charAt(this._currentIndex)=="+")this._currentIndex++;else if(this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)=="-"){this._currentIndex++;z=-1}if(!(this._currentIndex==this._endIndex||(this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")&&this._string.charAt(this._currentIndex)!=".")){for(var f=this._currentIndex;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<=
"9";)this._currentIndex++;if(this._currentIndex!=f)for(var m=this._currentIndex-1,i=1;m>=f;){k+=i*(this._string.charAt(m--)-"0");i*=10}if(this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)=="."){this._currentIndex++;if(this._currentIndex>=this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<=
"9";)v+=(this._string.charAt(this._currentIndex++)-"0")*(e*=0.1)}if(this._currentIndex!=B&&this._currentIndex+1<this._endIndex&&(this._string.charAt(this._currentIndex)=="e"||this._string.charAt(this._currentIndex)=="E")&&this._string.charAt(this._currentIndex+1)!="x"&&this._string.charAt(this._currentIndex+1)!="m"){this._currentIndex++;if(this._string.charAt(this._currentIndex)=="+")this._currentIndex++;else if(this._string.charAt(this._currentIndex)=="-"){this._currentIndex++;N=-1}if(this._currentIndex>=
this._endIndex||this._string.charAt(this._currentIndex)<"0"||this._string.charAt(this._currentIndex)>"9")return;for(;this._currentIndex<this._endIndex&&this._string.charAt(this._currentIndex)>="0"&&this._string.charAt(this._currentIndex)<="9";){d*=10;d+=this._string.charAt(this._currentIndex)-"0";this._currentIndex++}}k=k+v;k*=z;if(d)k*=Math.pow(10,N*d);if(B!=this._currentIndex){this._skipOptionalSpacesOrDelimiter();return k}}};b.prototype._parseArcFlag=function(){if(!(this._currentIndex>=this._endIndex)){var d=
false;d=this._string.charAt(this._currentIndex++);if(d=="0")d=false;else if(d=="1")d=true;else return;this._skipOptionalSpacesOrDelimiter();return d}};b.prototype.parseSegment=function(){var d=this._string[this._currentIndex],k=this._pathSegTypeFromChar(d);if(k==SVGPathSeg.PATHSEG_UNKNOWN){if(this._previousCommand==SVGPathSeg.PATHSEG_UNKNOWN)return null;k=this._nextCommandHelper(d,this._previousCommand);if(k==SVGPathSeg.PATHSEG_UNKNOWN)return null}else this._currentIndex++;this._previousCommand=k;
switch(k){case SVGPathSeg.PATHSEG_MOVETO_REL:return new SVGPathSegMovetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_MOVETO_ABS:return new SVGPathSegMovetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_REL:return new SVGPathSegLinetoRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_ABS:return new SVGPathSegLinetoAbs(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:return new SVGPathSegLinetoHorizontalRel(t,
this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:return new SVGPathSegLinetoHorizontalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:return new SVGPathSegLinetoVerticalRel(t,this._parseNumber());case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:return new SVGPathSegLinetoVerticalAbs(t,this._parseNumber());case SVGPathSeg.PATHSEG_CLOSEPATH:this._skipOptionalSpaces();return new SVGPathSegClosePath(t);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL:d={x1:this._parseNumber(),
y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicRel(t,d.x,d.y,d.x1,d.y1,d.x2,d.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:d={x1:this._parseNumber(),y1:this._parseNumber(),x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicAbs(t,d.x,d.y,d.x1,d.y1,d.x2,d.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL:d={x2:this._parseNumber(),
y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothRel(t,d.x,d.y,d.x2,d.y2);case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS:d={x2:this._parseNumber(),y2:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoCubicSmoothAbs(t,d.x,d.y,d.x2,d.y2);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL:d={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticRel(t,
d.x,d.y,d.x1,d.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:d={x1:this._parseNumber(),y1:this._parseNumber(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegCurvetoQuadraticAbs(t,d.x,d.y,d.x1,d.y1);case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:return new SVGPathSegCurvetoQuadraticSmoothRel(t,this._parseNumber(),this._parseNumber());case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:return new SVGPathSegCurvetoQuadraticSmoothAbs(t,this._parseNumber(),this._parseNumber());
case SVGPathSeg.PATHSEG_ARC_REL:d={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};return new SVGPathSegArcRel(t,d.x,d.y,d.x1,d.y1,d.arcAngle,d.arcLarge,d.arcSweep);case SVGPathSeg.PATHSEG_ARC_ABS:d={x1:this._parseNumber(),y1:this._parseNumber(),arcAngle:this._parseNumber(),arcLarge:this._parseArcFlag(),arcSweep:this._parseArcFlag(),x:this._parseNumber(),y:this._parseNumber()};
return new SVGPathSegArcAbs(t,d.x,d.y,d.x1,d.y1,d.arcAngle,d.arcLarge,d.arcSweep);default:throw"Unknown path seg type.";}};l=new l;a=new b(a);if(!a.initialCommandIsMoveTo())return[];for(;a.hasMoreData();){b=a.parseSegment();if(!b)return[];l.appendSegment(b)}return l.pathSegList};Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){if(!this._pathSegList)this._pathSegList=new SVGPathSegList(this);return this._pathSegList},enumerable:true});Object.defineProperty(SVGPathElement.prototype,
"normalizedPathSegList",{get:function(){return this.pathSegList},enumerable:true});Object.defineProperty(SVGPathElement.prototype,"animatedPathSegList",{get:function(){return this.pathSegList},enumerable:true});Object.defineProperty(SVGPathElement.prototype,"animatedNormalizedPathSegList",{get:function(){return this.pathSegList},enumerable:true})}})();(function(){if(!svgedit.browser)svgedit.browser={};var a=svgedit.NS,t=!!document.createElementNS&&!!document.createElementNS(a.SVG,"svg").createSVGRect;svgedit.browser.supportsSvg=function(){return t};if(svgedit.browser.supportsSvg()){var l=navigator.userAgent,b=document.createElementNS(a.SVG,"svg"),d=!!window.opera,k=l.indexOf("AppleWebKit")>=0,e=l.indexOf("Gecko/")>=0,v=l.indexOf("MSIE")>=0,z=l.indexOf("Chrome/")>=0,N=l.indexOf("Windows")>=0,B=l.indexOf("Macintosh")>=0,f="ontouchstart"in window,
m=!!b.querySelector,i=!!document.evaluate,h=function(){var T=document.createElementNS(a.SVG,"path");T.setAttribute("d","M0,0 10,10");var ba=T.pathSegList;T=T.createSVGPathSegLinetoAbs(5,5);try{ba.replaceItem(T,1);return true}catch(ya){}return false}(),o=function(){var T=document.createElementNS(a.SVG,"path");T.setAttribute("d","M0,0 10,10");var ba=T.pathSegList;T=T.createSVGPathSegLinetoAbs(5,5);try{ba.insertItemBefore(T,1);return true}catch(ya){}return false}(),r=function(){var T=document.createElementNS(a.SVG,
"svg"),ba=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(T);ba.setAttribute("x",5);T.appendChild(ba);var ya=document.createElementNS(a.SVG,"text");ya.textContent="a";ba.appendChild(ya);ba=ya.getStartPositionOfChar(0).x;document.documentElement.removeChild(T);return ba===0}(),w=function(){var T=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(T);var ba=document.createElementNS(a.SVG,"path");ba.setAttribute("d","M0,0 C0,0 10,10 10,0");T.appendChild(ba);
ba=ba.getBBox();document.documentElement.removeChild(T);return ba.height>4&&ba.height<5}(),A=function(){var T=document.createElementNS(a.SVG,"svg");document.documentElement.appendChild(T);var ba=document.createElementNS(a.SVG,"path");ba.setAttribute("d","M0,0 10,0");var ya=document.createElementNS(a.SVG,"path");ya.setAttribute("d","M5,0 15,0");var ta=document.createElementNS(a.SVG,"g");ta.appendChild(ba);ta.appendChild(ya);T.appendChild(ta);ba=ta.getBBox();document.documentElement.removeChild(T);
return ba.width==15}(),S=function(){var T=document.createElementNS(a.SVG,"rect");T.setAttribute("x",0.1);(T=T.cloneNode(false).getAttribute("x").indexOf(",")==-1)||$.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\nPlease upgrade to the <a href="http://opera.com">latest version</a> in which the problems have been fixed.');return T}(),W=function(){var T=document.createElementNS(a.SVG,"rect");T.setAttribute("style","vector-effect:non-scaling-stroke");return T.style.vectorEffect===
"non-scaling-stroke"}(),R=function(){var T=document.createElementNS(a.SVG,"rect").transform.baseVal,ba=b.createSVGTransform();T.appendItem(ba);return T.getItem(0)==ba}();svgedit.browser.isOpera=function(){return d};svgedit.browser.isWebkit=function(){return k};svgedit.browser.isGecko=function(){return e};svgedit.browser.isIE=function(){return v};svgedit.browser.isChrome=function(){return z};svgedit.browser.isWindows=function(){return N};svgedit.browser.isMac=function(){return B};svgedit.browser.isTouch=
function(){return f};svgedit.browser.supportsSelectors=function(){return m};svgedit.browser.supportsXpath=function(){return i};svgedit.browser.supportsPathReplaceItem=function(){return h};svgedit.browser.supportsPathInsertItemBefore=function(){return o};svgedit.browser.supportsPathBBox=function(){return w};svgedit.browser.supportsHVLineContainerBBox=function(){return A};svgedit.browser.supportsGoodTextCharPos=function(){return r};svgedit.browser.supportsEditableText=function(){return d};svgedit.browser.supportsGoodDecimals=
function(){return S};svgedit.browser.supportsNonScalingStroke=function(){return W};svgedit.browser.supportsNativeTransformLists=function(){return R}}else window.location="browser-not-supported.html"})();(function(){if(!svgedit.transformlist)svgedit.transformlist={};var a=document.createElementNS(svgedit.NS.SVG,"svg"),t={};svgedit.transformlist.SVGTransformList=function(l){this._elem=l||null;this._xforms=[];this._update=function(){var b="";a.createSVGMatrix();var d;for(d=0;d<this.numberOfItems;++d){var k=this._list.getItem(d);b=b;k=k;var e=k.matrix,v="";switch(k.type){case 1:v="matrix("+[e.a,e.b,e.c,e.d,e.e,e.f].join(",")+")";break;case 2:v="translate("+e.e+","+e.f+")";break;case 3:v=e.a==e.d?"scale("+
e.a+")":"scale("+e.a+","+e.d+")";break;case 4:var z=0;v=0;if(k.angle!=0){z=1-e.a;v=(z*e.f+e.b*e.e)/(z*z+e.b*e.b);z=(e.e-e.b*v)/z}v="rotate("+k.angle+" "+z+","+v+")"}b=b+(v+" ")}this._elem.setAttribute("transform",b)};this._list=this;this._init=function(){var b=this._elem.getAttribute("transform");if(b)for(var d=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/,k=true;k;){k=b.match(d);b=b.replace(d,"");if(k&&k[1]){var e=k[1].split(/\s*\(/),v=e[0];e=e[1].match(/\s*(.*?)\s*\)/);e[1]=e[1].replace(/(\d)-/g,
"$1 -");var z=e[1].split(/[, ]+/),N="abcdef".split(""),B=a.createSVGMatrix();$.each(z,function(i,h){z[i]=parseFloat(h);if(v=="matrix")B[N[i]]=z[i]});e=a.createSVGTransform();var f="set"+v.charAt(0).toUpperCase()+v.slice(1),m=v=="matrix"?[B]:z;if(v=="scale"&&m.length==1)m.push(m[0]);else if(v=="translate"&&m.length==1)m.push(0);else v=="rotate"&&m.length==1&&m.push(0,0);e[f].apply(e,m);this._list.appendItem(e)}}};this._removeFromOtherLists=function(b){if(b){var d=false,k;for(k in t){var e=t[k],v,z;
v=0;for(z=e._xforms.length;v<z;++v)if(e._xforms[v]==b){d=true;e.removeItem(v);break}if(d)break}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(b){this.numberOfItems=1;this._removeFromOtherLists(b);this._xforms=[b]};this.getItem=function(b){if(b<this.numberOfItems&&b>=0)return this._xforms[b];throw{code:1};};this.insertItemBefore=function(b,d){var k=null;if(d>=0)if(d<this.numberOfItems){this._removeFromOtherLists(b);k=Array(this.numberOfItems+
1);var e;for(e=0;e<d;++e)k[e]=this._xforms[e];k[e]=b;var v;for(v=e+1;e<this.numberOfItems;++v,++e)k[v]=this._xforms[e];this.numberOfItems++;this._xforms=k;k=b;this._list._update()}else k=this._list.appendItem(b);return k};this.replaceItem=function(b,d){var k=null;if(d<this.numberOfItems&&d>=0){this._removeFromOtherLists(b);k=this._xforms[d]=b;this._list._update()}return k};this.removeItem=function(b){if(b<this.numberOfItems&&b>=0){var d=this._xforms[b],k=Array(this.numberOfItems-1),e;for(e=0;e<b;++e)k[e]=
this._xforms[e];for(b=e;b<this.numberOfItems-1;++b,++e)k[b]=this._xforms[e+1];this.numberOfItems--;this._xforms=k;this._list._update();return d}throw{code:1};};this.appendItem=function(b){this._removeFromOtherLists(b);this._xforms.push(b);this.numberOfItems++;this._list._update();return b}};svgedit.transformlist.resetListMap=function(){t={}};svgedit.transformlist.removeElementFromListMap=function(l){l.id&&t[l.id]&&delete t[l.id]};svgedit.transformlist.getTransformList=function(l){if(!svgedit.browser.supportsNativeTransformLists()){var b=
l.id||"temp",d=t[b];if(!d||b==="temp"){t[b]=new svgedit.transformlist.SVGTransformList(l);t[b]._init();d=t[b]}return d}if(l.transform)return l.transform.baseVal;if(l.gradientTransform)return l.gradientTransform.baseVal;if(l.patternTransform)return l.patternTransform.baseVal;return null}})();(function(){if(!svgedit.math)svgedit.math={};var a=document.createElementNS(svgedit.NS.SVG,"svg");svgedit.math.transformPoint=function(t,l,b){return{x:b.a*t+b.c*l+b.e,y:b.b*t+b.d*l+b.f}};svgedit.math.isIdentity=function(t){return t.a===1&&t.b===0&&t.c===0&&t.d===1&&t.e===0&&t.f===0};svgedit.math.matrixMultiply=function(){for(var t=arguments,l=t.length,b=t[l-1];l-- >1;)b=t[l-1].multiply(b);if(Math.abs(b.a)<1.0E-14)b.a=0;if(Math.abs(b.b)<1.0E-14)b.b=0;if(Math.abs(b.c)<1.0E-14)b.c=0;if(Math.abs(b.d)<
1.0E-14)b.d=0;if(Math.abs(b.e)<1.0E-14)b.e=0;if(Math.abs(b.f)<1.0E-14)b.f=0;return b};svgedit.math.hasMatrixTransform=function(t){if(!t)return false;for(var l=t.numberOfItems;l--;){var b=t.getItem(l);if(b.type==1&&!svgedit.math.isIdentity(b.matrix))return true}return false};svgedit.math.transformBox=function(t,l,b,d,k){var e=svgedit.math.transformPoint,v=e(t,l,k),z=e(t+b,l,k),N=e(t,l+d,k);t=e(t+b,l+d,k);l=Math.min(v.x,z.x,N.x,t.x);b=Math.min(v.y,z.y,N.y,t.y);return{tl:v,tr:z,bl:N,br:t,aabox:{x:l,
y:b,width:Math.max(v.x,z.x,N.x,t.x)-l,height:Math.max(v.y,z.y,N.y,t.y)-b}}};svgedit.math.transformListToTransform=function(t,l,b){if(t==null)return a.createSVGTransformFromMatrix(a.createSVGMatrix());l=l||0;b=b||t.numberOfItems-1;l=parseInt(l,10);b=parseInt(b,10);if(l>b){var d=b;b=l;l=d}d=a.createSVGMatrix();for(l=l;l<=b;++l){var k=l>=0&&l<t.numberOfItems?t.getItem(l).matrix:a.createSVGMatrix();d=svgedit.math.matrixMultiply(d,k)}return a.createSVGTransformFromMatrix(d)};svgedit.math.getMatrix=function(t){t=
svgedit.transformlist.getTransformList(t);return svgedit.math.transformListToTransform(t).matrix};svgedit.math.snapToAngle=function(t,l,b,d){var k=Math.PI/4;b=b-t;var e=d-l;d=Math.sqrt(b*b+e*e);k=Math.round(Math.atan2(e,b)/k)*k;return{x:t+d*Math.cos(k),y:l+d*Math.sin(k),a:k}};svgedit.math.rectsIntersect=function(t,l){return l.x<t.x+t.width&&l.x+l.width>t.x&&l.y<t.y+t.height&&l.y+l.height>t.y}})();(function(){if(!svgedit.units)svgedit.units={};var a=svgedit.NS,t=["x","x1","cx","rx","width"],l=["y","y1","cy","ry","height"],b=["r","radius"].concat(t,l),d,k={};svgedit.units.init=function(v){d=v;v=document.createElementNS(a.SVG,"svg");document.body.appendChild(v);var z=document.createElementNS(a.SVG,"rect");z.setAttribute("width","1em");z.setAttribute("height","1ex");z.setAttribute("x","1in");v.appendChild(z);z=z.getBBox();document.body.removeChild(v);v=z.x;k={em:z.width,ex:z.height,"in":v,cm:v/
2.54,mm:v/25.4,pt:v/72,pc:v/6,px:1,"%":0}};svgedit.units.getTypeMap=function(){return k};svgedit.units.shortFloat=function(v){var z=d.getRoundDigits();if(!isNaN(v))return+(+v).toFixed(z);if($.isArray(v))return svgedit.units.shortFloat(v[0])+","+svgedit.units.shortFloat(v[1]);return parseFloat(v).toFixed(z)-0};svgedit.units.convertUnit=function(v,z){z=z||d.getBaseUnit();return svgedit.units.shortFloat(v/k[z])};svgedit.units.setUnitAttr=function(v,z,N){v.setAttribute(z,N)};var e={line:["x1","x2","y1",
"y2"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],foreignObject:["x","y","width","height"],rect:["x","y","width","height"],image:["x","y","width","height"],use:["x","y","width","height"],text:["x","y"]};svgedit.units.convertAttrs=function(v){var z=v.tagName,N=d.getBaseUnit();if(z=e[z]){var B=z.length,f;for(f=0;f<B;f++){var m=z[f],i=v.getAttribute(m);if(i)isNaN(i)||v.setAttribute(m,i/k[N]+N)}}};svgedit.units.convertToNum=function(v,z){if(!isNaN(z))return z-0;var N;if(z.substr(-1)==="%"){N=
z.substr(0,z.length-1)/100;var B=d.getWidth(),f=d.getHeight();if(t.indexOf(v)>=0)return N*B;if(l.indexOf(v)>=0)return N*f;return N*Math.sqrt(B*B+f*f)/Math.sqrt(2)}B=z.substr(-2);N=z.substr(0,z.length-2);return N*k[B]};svgedit.units.isValidUnit=function(v,z,N){var B=false;if(b.indexOf(v)>=0)if(isNaN(z)){z=z.toLowerCase();$.each(k,function(i){if(!B)if(RegExp("^-?[\\d\\.]+"+i+"$").test(z))B=true})}else B=true;else if(v=="id"){v=false;try{var f=d.getElement(z);v=f==null||f===N}catch(m){}return v}return B=
true}})();(function(a){function t(f){if(svgedit.browser.supportsHVLineContainerBBox())try{return f.getBBox()}catch(m){}var i=$.data(f,"ref"),h=null,o;if(i){o=$(i).children().clone().attr("visibility","hidden");$(N).append(o);h=o.filter("line, path")}else h=$(f).find("line, path");var r=false;if(h.length){h.each(function(){var w=this.getBBox();if(!w.width||!w.height)r=true});if(r){f=i?o:$(f).children();f=getStrokedBBox(f)}else f=f.getBBox()}else f=f.getBBox();i&&o.remove();return f}function l(f){var m=f.getAttribute("stroke-width");
return!isNaN(m)&&f.getAttribute("stroke")!="none"?m/2:0}function b(f,m,i,h){$.each(m,function(o,r){m[o]=svgedit.units.shortFloat(r)});f=f+m.join(" ");if(i)f+=" "+i.join(" ");if(h)f+=" "+svgedit.units.shortFloat(h);return f}if(!svgedit.utilities)svgedit.utilities={};var d=svgedit.NS,k="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),e=null,v=null,z=null,N=null;svgedit.utilities.init=function(f){e=f;v=f.getDOMDocument();z=f.getDOMContainer();N=f.getSVGRoot()};
svgedit.utilities.toXml=function(f){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/,"&#x27;")};svgedit.utilities.fromXml=function(f){return $("<p/>").html(f).text()};svgedit.utilities.encode64=function(f){f=svgedit.utilities.encodeUTF8(f);if(window.btoa)return window.btoa(f);var m=[];m.length=Math.floor((f.length+2)/3)*4;var i,h,o,r,w,A,S=0,W=0;do{i=f.charCodeAt(S++);h=f.charCodeAt(S++);o=f.charCodeAt(S++);r=i>>2;i=(i&3)<<4|h>>4;w=(h&15)<<
2|o>>6;A=o&63;if(isNaN(h))w=A=64;else if(isNaN(o))A=64;m[W++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(r);m[W++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i);m[W++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(w);m[W++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(A)}while(S<f.length);return m.join("")};svgedit.utilities.decode64=function(f){if(window.atob)return svgedit.utilities.decodeUTF8(window.atob(f));
var m="",i,h,o="",r,w="",A=0;f=f.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(A++));h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(A++));r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(A++));w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(A++));i=i<<2|h>>4;h=(h&15)<<4|r>>2;o=(r&3)<<6|w;m+=String.fromCharCode(i);
if(r!=64)m+=String.fromCharCode(h);if(w!=64)m+=String.fromCharCode(o)}while(A<f.length);return svgedit.utilities.decodeUTF8(m)};svgedit.utilities.decodeUTF8=function(f){return decodeURIComponent(escape(f))};svgedit.utilities.encodeUTF8=function(f){return unescape(encodeURIComponent(f))};svgedit.utilities.convertToXMLReferences=function(f){var m,i="";for(m=0;m<f.length;m++){var h=f.charCodeAt(m);if(h<128)i+=f[m];else if(h>127)i+="&#"+h+";"}return i};svgedit.utilities.text2xml=function(f){if(f.indexOf("<svg:svg")>=
0)f=f.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns");var m,i;try{i=window.DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM");i.async=false}catch(h){throw Error("XML Parser could not be instantiated");}try{m=i.loadXML?i.loadXML(f)?i:false:i.parseFromString(f,"text/xml")}catch(o){throw Error("Error parsing XML string");}return m};svgedit.utilities.bboxToObj=function(f){return{x:f.x,y:f.y,width:f.width,height:f.height}};svgedit.utilities.walkTree=function(f,m){if(f&&f.nodeType==
1){m(f);for(var i=f.childNodes.length;i--;)svgedit.utilities.walkTree(f.childNodes.item(i),m)}};svgedit.utilities.walkTreePost=function(f,m){if(f&&f.nodeType==1){for(var i=f.childNodes.length;i--;)svgedit.utilities.walkTree(f.childNodes.item(i),m);m(f)}};svgedit.utilities.getUrlFromAttr=function(f){if(f){if(f.indexOf('url("')===0)return f.substring(5,f.indexOf('"',6));if(f.indexOf("url('")===0)return f.substring(5,f.indexOf("'",6));if(f.indexOf("url(")===0)return f.substring(4,f.indexOf(")"))}return null};
svgedit.utilities.getHref=function(f){return f.getAttributeNS(d.XLINK,"href")};svgedit.utilities.setHref=function(f,m){f.setAttributeNS(d.XLINK,"xlink:href",m)};svgedit.utilities.findDefs=function(){var f=e.getSVGContent(),m=f.getElementsByTagNameNS(d.SVG,"defs");if(m.length>0)m=m[0];else{m=f.ownerDocument.createElementNS(d.SVG,"defs");f.firstChild?f.insertBefore(m,f.firstChild.nextSibling):f.appendChild(m)}return m};svgedit.utilities.getPathBBox=function(f){var m=f.pathSegList,i=m.numberOfItems;
f=[[],[]];var h=m.getItem(0),o=[h.x,h.y];for(h=0;h<i;h++){var r=m.getItem(h);if(r.x!==a){f[0].push(o[0]);f[1].push(o[1]);if(r.x1){var w=[r.x1,r.y1],A=[r.x2,r.y2],S=[r.x,r.y],W;for(W=0;W<2;W++){r=function(ta){return Math.pow(1-ta,3)*o[W]+3*Math.pow(1-ta,2)*ta*w[W]+3*(1-ta)*Math.pow(ta,2)*A[W]+Math.pow(ta,3)*S[W]};var R=6*o[W]-12*w[W]+6*A[W],T=-3*o[W]+9*w[W]-9*A[W]+3*S[W],ba=3*w[W]-3*o[W];if(T==0){if(R!=0){R=-ba/R;0<R&&R<1&&f[W].push(r(R))}}else{ba=Math.pow(R,2)-4*ba*T;if(!(ba<0)){var ya=(-R+Math.sqrt(ba))/
(2*T);0<ya&&ya<1&&f[W].push(r(ya));R=(-R-Math.sqrt(ba))/(2*T);0<R&&R<1&&f[W].push(r(R))}}}o=S}else{f[0].push(r.x);f[1].push(r.y)}}}m=Math.min.apply(null,f[0]);i=Math.max.apply(null,f[0])-m;h=Math.min.apply(null,f[1]);f=Math.max.apply(null,f[1])-h;return{x:m,y:h,width:i,height:f}};svgedit.utilities.getBBox=function(f){var m=f||e.geSelectedElements()[0];if(f.nodeType!=1)return null;f=null;var i=m.nodeName;switch(i){case "text":if(m.textContent===""){m.textContent="a";f=m.getBBox();m.textContent=""}else if(m.getBBox)f=
m.getBBox();break;case "path":if(svgedit.browser.supportsPathBBox()){if(m.getBBox)f=m.getBBox()}else f=svgedit.utilities.getPathBBox(m);break;case "g":case "a":f=t(m);break;default:if(i==="use")f=t(m,true);if(i==="use"||i==="foreignObject"&&svgedit.browser.isWebkit()){f||(f=m.getBBox());if(!svgedit.browser.isWebkit()){i={};i.width=f.width;i.height=f.height;i.x=f.x+parseFloat(m.getAttribute("x")||0);i.y=f.y+parseFloat(m.getAttribute("y")||0);f=i}}else if(~k.indexOf(i))if(m)f=m.getBBox();else{m=$(m).closest("foreignObject");
if(m.length)if(m[0].getBBox)f=m[0].getBBox()}}if(f)f=svgedit.utilities.bboxToObj(f);return f};svgedit.utilities.getPathDFromSegments=function(f){var m="";$.each(f,function(i,h){var o,r=h[1];m+=h[0];for(o=0;o<r.length;o+=2)m+=r[o]+","+r[o+1]+" "});return m};svgedit.utilities.getPathDFromElement=function(f){var m=1.81,i,h;switch(f.tagName){case "ellipse":case "circle":h=$(f).attr(["rx","ry","cx","cy"]);var o=h.cx,r=h.cy;i=h.rx;h=h.ry;if(f.tagName=="circle")i=h=$(f).attr("r");i=svgedit.utilities.getPathDFromSegments([["M",
[o-i,r]],["C",[o-i,r-h/m,o-i/m,r-h,o,r-h]],["C",[o+i/m,r-h,o+i,r-h/m,o+i,r]],["C",[o+i,r+h/m,o+i/m,r+h,o,r+h]],["C",[o-i/m,r+h,o-i,r+h/m,o-i,r]],["Z",[]]]);break;case "path":i=f.getAttribute("d");break;case "line":h=$(f).attr(["x1","y1","x2","y2"]);i="M"+h.x1+","+h.y1+"L"+h.x2+","+h.y2;break;case "polyline":i="M"+f.getAttribute("points");break;case "polygon":i="M"+f.getAttribute("points")+" Z";break;case "rect":h=$(f).attr(["rx","ry"]);i=h.rx;h=h.ry;var w=f.getBBox();f=w.x;o=w.y;r=w.width;w=w.height;
m=4-m;i=!i&&!h?svgedit.utilities.getPathDFromSegments([["M",[f,o]],["L",[f+r,o]],["L",[f+r,o+w]],["L",[f,o+w]],["L",[f,o]],["Z",[]]]):svgedit.utilities.getPathDFromSegments([["M",[f,o+h]],["C",[f,o+h/m,f+i/m,o,f+i,o]],["L",[f+r-i,o]],["C",[f+r-i/m,o,f+r,o+h/m,f+r,o+h]],["L",[f+r,o+w-h]],["C",[f+r,o+w-h/m,f+r-i/m,o+w,f+r-i,o+w]],["L",[f+i,o+w]],["C",[f+i/m,o+w,f,o+w-h/m,f,o+w-h]],["L",[f,o+h]],["Z",[]]])}return i};svgedit.utilities.getExtraAttributesForConvertToPath=function(f){var m={};$.each(["marker-start",
"marker-end","marker-mid","filter","clip-path"],function(){var i=f.getAttribute(this);if(i)m[this]=i});return m};svgedit.utilities.getBBoxOfElementAsPath=function(f,m,i){m=m({element:"path",attr:svgedit.utilities.getExtraAttributesForConvertToPath(f)});var h=f.getAttribute("transform");h&&m.setAttribute("transform",h);h=f.parentNode;f.nextSibling?h.insertBefore(m,f):h.appendChild(m);(f=svgedit.utilities.getPathDFromElement(f))?m.setAttribute("d",f):m.parentNode.removeChild(m);i.resetOrientation(m);
i=false;try{i=m.getBBox()}catch(o){}m.parentNode.removeChild(m);return i};svgedit.utilities.convertToPath=function(f,m,i,h,o,r,w,A){var S=new w.BatchCommand("Convert element to Path");m=$.extend({},m,svgedit.utilities.getExtraAttributesForConvertToPath(f));m=i({element:"path",attr:m});var W=f.getAttribute("transform");W&&m.setAttribute("transform",W);i=f.id;var R=f.parentNode;f.nextSibling?R.insertBefore(m,f):R.appendChild(m);var T=svgedit.utilities.getPathDFromElement(f);if(T){m.setAttribute("d",
T);if(W){W=svgedit.transformlist.getTransformList(m);svgedit.math.hasMatrixTransform(W)&&h.resetOrientation(m)}S.addSubCommand(new w.RemoveElementCommand(f,f.nextSibling,R));S.addSubCommand(new w.InsertElementCommand(m));o();f.parentNode.removeChild(f);m.setAttribute("id",i);m.removeAttribute("visibility");r([m],true);A(S);return m}else{m.parentNode.removeChild(m);return null}};svgedit.utilities.getBBoxWithTransform=function(f,m,i){var h=svgedit.utilities.getBBox(f);if(!h)return null;var o=svgedit.transformlist.getTransformList(f),
r=svgedit.utilities.getRotationAngleFromTransformList(o),w=svgedit.math.hasMatrixTransform(o);if(r||w){var A=false,S=r%90;r=S<-89.99||S>89.99;S=S>-0.001&&S<0.001;if(w||!(S||r))if(["ellipse","path","line","polyline","polygon"].indexOf(f.tagName)>=0)h=A=svgedit.utilities.getBBoxOfElementAsPath(f,m,i);else if(f.tagName=="rect"){w=f.getAttribute("rx");r=f.getAttribute("ry");if(w||r)h=A=svgedit.utilities.getBBoxOfElementAsPath(f,m,i)}if(!A){f=svgedit.math.transformListToTransform(o).matrix;h=svgedit.math.transformBox(h.x,
h.y,h.width,h.height,f).aabox}}return h};svgedit.utilities.getStrokedBBox=function(f,m,i){if(!f||!f.length)return false;var h;$.each(f,function(){if(!h)if(this.parentNode)h=svgedit.utilities.getBBoxWithTransform(this,m,i)});if(h===undefined)return null;var o=h.x+h.width,r=h.y+h.height,w=h.x,A=h.y;if(f.length===1){f=l(f[0]);w-=f;A-=f;o+=f;r+=f}else $.each(f,function(S,W){var R=svgedit.utilities.getBBoxWithTransform(W,m,i);if(R){var T=l(W);w=Math.min(w,R.x-T);A=Math.min(A,R.y-T);if(W.nodeType==1){o=
Math.max(o,R.x+R.width+T);r=Math.max(r,R.y+R.height+T)}}});h.x=w;h.y=A;h.width=o-w;h.height=r-A;return h};svgedit.utilities.getRotationAngleFromTransformList=function(f,m){if(!f)return 0;var i=f.numberOfItems,h;for(h=0;h<i;++h){var o=f.getItem(h);if(o.type==4)return m?o.angle*Math.PI/180:o.angle}return 0};svgedit.utilities.getRotationAngle=function(f,m){var i=f||e.getSelectedElements()[0];i=svgedit.transformlist.getTransformList(i);return svgedit.utilities.getRotationAngleFromTransformList(i,m)};
svgedit.utilities.getRefElem=function(f){return svgedit.utilities.getElem(svgedit.utilities.getUrlFromAttr(f).substr(1))};svgedit.utilities.getElem=svgedit.browser.supportsSelectors()?function(f){return N.querySelector("#"+f)}:svgedit.browser.supportsXpath()?function(f){return v.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+f+'"]',z,function(){return svgedit.NS.SVG},9,null).singleNodeValue}:function(f){return $(N).find("[id="+f+"]")[0]};svgedit.utilities.assignAttributes=function(f,m,i,h){for(var o in m)if(i=
o.substr(0,4)==="xml:"?d.XML:o.substr(0,6)==="xlink:"?d.XLINK:null)f.setAttributeNS(i,o,m[o]);else h?svgedit.units.setUnitAttr(f,o,m[o]):f.setAttribute(o,m[o])};svgedit.utilities.cleanupElement=function(f){var m={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};if(f.nodeName==="ellipse"){delete m.rx;delete m.ry}for(var i in m){var h=m[i];f.getAttribute(i)==h&&f.removeAttribute(i)}};
svgedit.utilities.snapToGrid=function(f){var m=e.getSnappingStep(),i=e.getBaseUnit();if(i!=="px")m*=svgedit.units.getTypeMap()[i];return f=Math.round(f/m)*m};svgedit.utilities.preg_quote=function(f,m){return String(f).replace(RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\"+(m||"")+"-]","g"),"\\$&")};svgedit.utilities.executeAfterLoads=function(f,m,i){return function(){function h(){i.apply(null,o)}var o=arguments;window[f]?h():m.reduceRight(function(r,w){return function(){$.getScript(w,r)}},h)()}};svgedit.utilities.buildCanvgCallback=
function(f){return svgedit.utilities.executeAfterLoads("canvg",["canvg/rgbcolor.js","canvg/canvg.js"],f)};svgedit.utilities.buildJSPDFCallback=function(f){return svgedit.utilities.executeAfterLoads("RGBColor",["canvg/rgbcolor.js"],function(){var m=[];if(!RGBColor||RGBColor.ok===a)m.push("canvg/rgbcolor.js");svgedit.utilities.executeAfterLoads("jsPDF",m.concat("jspdf/underscore-min.js","jspdf/jspdf.min.js","jspdf/jspdf.plugin.svgToPdf.js"),f)()})};svgedit.utilities.preventClickDefault=function(f){$(f).click(function(m){m.preventDefault()})};
svgedit.utilities.copyElem=function(f,m){var i=document.createElementNS(f.namespaceURI,f.nodeName);$.each(f.attributes,function(o,r){r.localName!="-moz-math-font-style"&&i.setAttributeNS(r.namespaceURI,r.nodeName,r.value)});i.removeAttribute("id");i.id=m();if(svgedit.browser.isWebkit()&&f.nodeName=="path"){var h=svgedit.utilities.convertPath(f);i.setAttribute("d",h)}$.each(f.childNodes,function(o,r){switch(r.nodeType){case 1:i.appendChild(svgedit.utilities.copyElem(r,m));break;case 3:i.textContent=
r.nodeValue}});if($(f).data("gsvg"))$(i).data("gsvg",i.firstChild);else if($(f).data("symbol")){h=$(f).data("symbol");$(i).data("ref",h).data("symbol",h)}else i.tagName=="image"&&preventClickDefault(i);return i};var B=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"];svgedit.utilities.convertPath=function(f,m){var i,h=f.pathSegList,o=h.numberOfItems,r=0,w=0,A="",S=null;for(i=0;i<o;++i){var W=h.getItem(i),R=W.x||0,T=W.y||0,ba=W.x1||0,ya=W.y1||0,ta=W.x2||0,Ta=W.y2||0,Xa=
W.pathSegType,Oa=B[Xa]["to"+(m?"Lower":"Upper")+"Case"]();switch(Xa){case 1:A+="z";if(S&&!m){r=S[0];w=S[1]}break;case 12:R-=r;case 13:if(m){r+=R;Oa="l"}else{R+=r;r=R;Oa="L"}A+=b(Oa,[[R,w]]);break;case 14:T-=w;case 15:if(m){w+=T;Oa="l"}else{T+=w;w=T;Oa="L"}A+=b(Oa,[[r,T]]);break;case 2:case 4:case 18:R-=r;T-=w;case 5:case 3:case 19:if(m){r+=R;w+=T}else{R+=r;T+=w;r=R;w=T}if(Xa===2||Xa===3)S=[r,w];A+=b(Oa,[[R,T]]);break;case 6:R-=r;ba-=r;ta-=r;T-=w;ya-=w;Ta-=w;case 7:if(m){r+=R;w+=T}else{R+=r;ba+=r;
ta+=r;T+=w;ya+=w;Ta+=w;r=R;w=T}A+=b(Oa,[[ba,ya],[ta,Ta],[R,T]]);break;case 8:R-=r;ba-=r;T-=w;ya-=w;case 9:if(m){r+=R;w+=T}else{R+=r;ba+=r;T+=w;ya+=w;r=R;w=T}A+=b(Oa,[[ba,ya],[R,T]]);break;case 10:R-=r;T-=w;case 11:if(m){r+=R;w+=T}else{R+=r;T+=w;r=R;w=T}A+=b(Oa,[[W.r1,W.r2]],[W.angle,W.largeArcFlag?1:0,W.sweepFlag?1:0],[R,T]);break;case 16:R-=r;ta-=r;T-=w;Ta-=w;case 17:if(m){r+=R;w+=T}else{R+=r;ta+=r;T+=w;Ta+=w;r=R;w=T}A+=b(Oa,[[ta,Ta],[R,T]])}}return A}})();(function(){if(!svgedit.sanitize)svgedit.sanitize={};var a=svgedit.NS,t=svgedit.getReverseNS(),l={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask",
"opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],style:["type"],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin",
"stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display",
"fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","font-family","font-size","font-style","font-weight","text-anchor"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id",
"class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity",
"stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","viewBox","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id",
"r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class",
"clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit",
"stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures",
"spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class",
"clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],
mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width","height","depth","voffset"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing",
"width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},b={};$.each(l,function(d,k){var e={};$.each(k,function(v,z){if(z.indexOf(":")>=0){var N=z.split(":");e[N[1]]=a[N[0].toUpperCase()]}else e[z]=z=="xmlns"?a.XMLNS:null});b[d]=e});svgedit.sanitize.sanitizeSvg=function(d){if(d.nodeType==3){d.nodeValue=d.nodeValue.replace(/^\s+|\s+$/g,"");d.nodeValue.length===0&&d.parentNode.removeChild(d)}if(d.nodeType==1){var k=
d.parentNode;if(d.ownerDocument&&k){var e=l[d.nodeName],v=b[d.nodeName],z;if(typeof e!=="undefined"){var N=[];for(z=d.attributes.length;z--;){var B=d.attributes.item(z),f=B.nodeName,m=B.localName,i=B.namespaceURI;if(!(v.hasOwnProperty(m)&&i==v[m]&&i!=a.XMLNS)&&!(i==a.XMLNS&&t[B.value])){if(f.indexOf("se:")===0||f.indexOf("data-")===0)N.push([f,B.value]);d.removeAttributeNS(i,m)}if(svgedit.browser.isGecko())switch(f){case "transform":case "gradientTransform":case "patternTransform":m=B.value.replace(/(\d)-/g,
"$1 -");d.setAttribute(f,m)}if(f=="style"){B=B.value.split(";");for(f=B.length;f--;){i=B[f].split(":");m=$.trim(i[0]);i=$.trim(i[1]);e.indexOf(m)>=0&&d.setAttribute(m,i)}d.removeAttribute("style")}}$.each(N,function(h,o){d.setAttributeNS(a.SE,o[0],o[1])});if((z=svgedit.utilities.getHref(d))&&["filter","linearGradient","pattern","radialGradient","textPath","use"].indexOf(d.nodeName)>=0)if(z[0]!="#"){svgedit.utilities.setHref(d,"");d.removeAttributeNS(a.XLINK,"href")}if(d.nodeName=="use"&&!svgedit.utilities.getHref(d))k.removeChild(d);
else{$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(h,o){var r=d.getAttribute(o);if(r)if((r=svgedit.utilities.getUrlFromAttr(r))&&r[0]!=="#"){d.setAttribute(o,"");d.removeAttribute(o)}});for(z=d.childNodes.length;z--;)svgedit.sanitize.sanitizeSvg(d.childNodes.item(z))}}else{for(e=[];d.hasChildNodes();)e.push(k.insertBefore(d.firstChild,d));k.removeChild(d);for(z=e.length;z--;)svgedit.sanitize.sanitizeSvg(e[z])}}}}})();(function(){if(!svgedit.history)svgedit.history={};svgedit.history.HistoryEventTypes={BEFORE_APPLY:"before_apply",AFTER_APPLY:"after_apply",BEFORE_UNAPPLY:"before_unapply",AFTER_UNAPPLY:"after_unapply"};svgedit.history.MoveElementCommand=function(a,t,l,b){this.elem=a;this.text=b?"Move "+a.tagName+" to "+b:"Move "+a.tagName;this.oldNextSibling=t;this.oldParent=l;this.newNextSibling=a.nextSibling;this.newParent=a.parentNode};svgedit.history.MoveElementCommand.type=function(){return"svgedit.history.MoveElementCommand"};
svgedit.history.MoveElementCommand.prototype.type=svgedit.history.MoveElementCommand.type;svgedit.history.MoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.MoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.MoveElementCommand.prototype.unapply=
function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.MoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.InsertElementCommand=function(a,t){this.elem=a;this.text=t||"Create "+a.tagName;this.parent=a.parentNode;this.nextSibling=this.elem.nextSibling};svgedit.history.InsertElementCommand.type=
function(){return"svgedit.history.InsertElementCommand"};svgedit.history.InsertElementCommand.prototype.type=svgedit.history.InsertElementCommand.type;svgedit.history.InsertElementCommand.prototype.getText=function(){return this.text};svgedit.history.InsertElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);this.elem=this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.InsertElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.InsertElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.RemoveElementCommand=function(a,t,l,b){this.elem=a;this.text=b||"Delete "+a.tagName;
this.nextSibling=t;this.parent=l;svgedit.transformlist.removeElementFromListMap(a)};svgedit.history.RemoveElementCommand.type=function(){return"svgedit.history.RemoveElementCommand"};svgedit.history.RemoveElementCommand.prototype.type=svgedit.history.RemoveElementCommand.type;svgedit.history.RemoveElementCommand.prototype.getText=function(){return this.text};svgedit.history.RemoveElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);
svgedit.transformlist.removeElementFromListMap(this.elem);this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,this)};svgedit.history.RemoveElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);svgedit.transformlist.removeElementFromListMap(this.elem);this.nextSibling==null&&window.console&&console.log("Error: reference element was lost");
this.parent.insertBefore(this.elem,this.nextSibling);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.RemoveElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.ChangeElementCommand=function(a,t,l){this.elem=a;this.text=l?"Change "+a.tagName+" "+l:"Change "+a.tagName;this.newValues={};this.oldValues=t;for(var b in t)this.newValues[b]=b=="#text"?a.textContent:b=="#href"?svgedit.utilities.getHref(a):a.getAttribute(b)};svgedit.history.ChangeElementCommand.type=
function(){return"svgedit.history.ChangeElementCommand"};svgedit.history.ChangeElementCommand.prototype.type=svgedit.history.ChangeElementCommand.type;svgedit.history.ChangeElementCommand.prototype.getText=function(){return this.text};svgedit.history.ChangeElementCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var t=false,l;for(l in this.newValues){if(this.newValues[l])if(l=="#text")this.elem.textContent=this.newValues[l];else l=="#href"?
svgedit.utilities.setHref(this.elem,this.newValues[l]):this.elem.setAttribute(l,this.newValues[l]);else if(l=="#text")this.elem.textContent="";else{this.elem.setAttribute(l,"");this.elem.removeAttribute(l)}if(l=="transform")t=true}if(!t)if(t=svgedit.utilities.getRotationAngle(this.elem)){l=elem.getBBox();t=["rotate(",t," ",l.x+l.width/2,",",l.y+l.height/2,")"].join("");t!=elem.getAttribute("transform")&&elem.setAttribute("transform",t)}a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this);return true};svgedit.history.ChangeElementCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var t=false,l;for(l in this.oldValues){if(this.oldValues[l])if(l=="#text")this.elem.textContent=this.oldValues[l];else l=="#href"?svgedit.utilities.setHref(this.elem,this.oldValues[l]):this.elem.setAttribute(l,this.oldValues[l]);else if(l=="#text")this.elem.textContent="";else this.elem.removeAttribute(l);if(l=="transform")t=true}if(!t)if(t=
svgedit.utilities.getRotationAngle(this.elem)){l=elem.getBBox();t=["rotate(",t," ",l.x+l.width/2,",",l.y+l.height/2,")"].join("");t!=elem.getAttribute("transform")&&elem.setAttribute("transform",t)}svgedit.transformlist.removeElementFromListMap(this.elem);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this);return true};svgedit.history.ChangeElementCommand.prototype.elements=function(){return[this.elem]};svgedit.history.BatchCommand=function(a){this.text=a||"Batch Command";
this.stack=[]};svgedit.history.BatchCommand.type=function(){return"svgedit.history.BatchCommand"};svgedit.history.BatchCommand.prototype.type=svgedit.history.BatchCommand.type;svgedit.history.BatchCommand.prototype.getText=function(){return this.text};svgedit.history.BatchCommand.prototype.apply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_APPLY,this);var t,l=this.stack.length;for(t=0;t<l;++t)this.stack[t].apply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_APPLY,
this)};svgedit.history.BatchCommand.prototype.unapply=function(a){a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.BEFORE_UNAPPLY,this);var t;for(t=this.stack.length-1;t>=0;t--)this.stack[t].unapply(a);a&&a.handleHistoryEvent(svgedit.history.HistoryEventTypes.AFTER_UNAPPLY,this)};svgedit.history.BatchCommand.prototype.elements=function(){for(var a=[],t=this.stack.length;t--;)for(var l=this.stack[t].elements(),b=l.length;b--;)a.indexOf(l[b])==-1&&a.push(l[b]);return a};svgedit.history.BatchCommand.prototype.addSubCommand=
function(a){this.stack.push(a)};svgedit.history.BatchCommand.prototype.isEmpty=function(){return this.stack.length===0};svgedit.history.UndoManager=function(a){this.handler_=a||null;this.undoStackPointer=0;this.undoStack=[];this.undoChangeStackPointer=-1;this.undoableChangeStack=[]};svgedit.history.UndoManager.prototype.resetUndoStack=function(){this.undoStack=[];this.undoStackPointer=0};svgedit.history.UndoManager.prototype.getUndoStackSize=function(){return this.undoStackPointer};svgedit.history.UndoManager.prototype.getRedoStackSize=
function(){return this.undoStack.length-this.undoStackPointer};svgedit.history.UndoManager.prototype.getNextUndoCommandText=function(){return this.undoStackPointer>0?this.undoStack[this.undoStackPointer-1].getText():""};svgedit.history.UndoManager.prototype.getNextRedoCommandText=function(){return this.undoStackPointer<this.undoStack.length?this.undoStack[this.undoStackPointer].getText():""};svgedit.history.UndoManager.prototype.undo=function(){this.undoStackPointer>0&&this.undoStack[--this.undoStackPointer].unapply(this.handler_)};
svgedit.history.UndoManager.prototype.redo=function(){this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0&&this.undoStack[this.undoStackPointer++].apply(this.handler_)};svgedit.history.UndoManager.prototype.addCommandToHistory=function(a){if(this.undoStackPointer<this.undoStack.length&&this.undoStack.length>0)this.undoStack=this.undoStack.splice(0,this.undoStackPointer);this.undoStack.push(a);this.undoStackPointer=this.undoStack.length};svgedit.history.UndoManager.prototype.beginUndoableChange=
function(a,t){for(var l=++this.undoChangeStackPointer,b=t.length,d=Array(b),k=Array(b);b--;){var e=t[b];if(e!=null){k[b]=e;d[b]=e.getAttribute(a)}}this.undoableChangeStack[l]={attrName:a,oldValues:d,elements:k}};svgedit.history.UndoManager.prototype.finishUndoableChange=function(){for(var a=this.undoChangeStackPointer--,t=this.undoableChangeStack[a],l=t.elements.length,b=t.attrName,d=new svgedit.history.BatchCommand("Change "+b);l--;){var k=t.elements[l];if(k!=null){var e={};e[b]=t.oldValues[l];e[b]!=
k.getAttribute(b)&&d.addSubCommand(new svgedit.history.ChangeElementCommand(k,e,b))}}this.undoableChangeStack[a]=null;return d}})();(function(){if(!svgedit.history)svgedit.history={};var a=svgedit.history,t=a.HistoryRecordingService=function(l){this.undoManager_=l;this.currentBatchCommand_=null;this.batchCommandStack_=[]};t.NO_HISTORY=new t;t.prototype.startBatchCommand=function(l){if(!this.undoManager_)return this;this.currentBatchCommand_=new a.BatchCommand(l);this.batchCommandStack_.push(this.currentBatchCommand_);return this};t.prototype.endBatchCommand=function(){if(!this.undoManager_)return this;if(this.currentBatchCommand_){var l=
this.currentBatchCommand_;this.batchCommandStack_.pop();var b=this.batchCommandStack_.length;this.currentBatchCommand_=b?this.batchCommandStack_[b-1]:null;this.addCommand_(l)}return this};t.prototype.moveElement=function(l,b,d,k){if(!this.undoManager_)return this;this.addCommand_(new a.MoveElementCommand(l,b,d,k));return this};t.prototype.insertElement=function(l,b){if(!this.undoManager_)return this;this.addCommand_(new a.InsertElementCommand(l,b));return this};t.prototype.removeElement=function(l,
b,d,k){if(!this.undoManager_)return this;this.addCommand_(new a.RemoveElementCommand(l,b,d,k));return this};t.prototype.changeElement=function(l,b,d){if(!this.undoManager_)return this;this.addCommand_(new a.ChangeElementCommand(l,b,d));return this};t.prototype.addCommand_=function(l){if(!this.undoManager_)return this;this.currentBatchCommand_?this.currentBatchCommand_.addSubCommand(l):this.undoManager_.addCommandToHistory(l)}})();var svgedit=svgedit||{};
(function(){if(!svgedit.coords)svgedit.coords={};var a=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"],t=null;svgedit.coords.init=function(l){t=l};svgedit.coords.remapElement=function(l,b,d){var k,e,v=function(h,o){return svgedit.math.transformPoint(h,o,d)},z=t.getGridSnapping()&&l.parentNode.parentNode.localName==="svg",N=function(){var h;if(z)for(h in b)b[h]=svgedit.utilities.snapToGrid(b[h]);svgedit.utilities.assignAttributes(l,b,1E3,true)},B=svgedit.utilities.getBBox(l);
for(k=0;k<2;k++){e=k===0?"fill":"stroke";var f=l.getAttribute(e);if(f&&f.indexOf("url(")===0)if(d.a<0||d.d<0){f=svgedit.utilities.getRefElem(f).cloneNode(true);if(d.a<0){var m=f.getAttribute("x1"),i=f.getAttribute("x2");f.setAttribute("x1",-(m-1));f.setAttribute("x2",-(i-1))}if(d.d<0){m=f.getAttribute("y1");i=f.getAttribute("y2");f.setAttribute("y1",-(m-1));f.setAttribute("y2",-(i-1))}f.id=t.getDrawing().getNextId();svgedit.utilities.findDefs().appendChild(f);l.setAttribute(e,"url(#"+f.id+")")}}k=
l.tagName;if(k==="g"||k==="text"||k=="tspan"||k==="use")if(d.a==1&&d.b==0&&d.c==0&&d.d==1&&(d.e!=0||d.f!=0)){e=svgedit.math.transformListToTransform(l).matrix;e=svgedit.math.matrixMultiply(e.inverse(),d,e);b.x=parseFloat(b.x)+e.e;b.y=parseFloat(b.y)+e.f}else{e=svgedit.transformlist.getTransformList(l);f=svgroot.createSVGTransform();f.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(e).matrix,d));e.clear();e.appendItem(f)}switch(k){case "foreignObject":case "rect":case "image":if(k===
"image"&&(d.a<0||d.d<0)){e=svgedit.transformlist.getTransformList(l);f=svgroot.createSVGTransform();f.setMatrix(svgedit.math.matrixMultiply(svgedit.math.transformListToTransform(e).matrix,d));e.clear();e.appendItem(f)}else{f=v(b.x,b.y);b.width=d.a*b.width;b.height=d.d*b.height;b.x=f.x+Math.min(0,b.width);b.y=f.y+Math.min(0,b.height);b.width=Math.abs(b.width);b.height=Math.abs(b.height)}N();break;case "ellipse":v=v(b.cx,b.cy);b.cx=v.x;b.cy=v.y;b.rx=d.a*b.rx;b.ry=d.d*b.ry;b.rx=Math.abs(b.rx);b.ry=Math.abs(b.ry);
N();break;case "circle":v=v(b.cx,b.cy);b.cx=v.x;b.cy=v.y;v=svgedit.math.transformBox(B.x,B.y,B.width,B.height,d);b.r=Math.min((v.tr.x-v.tl.x)/2,(v.bl.y-v.tl.y)/2);if(b.r)b.r=Math.abs(b.r);N();break;case "line":f=v(b.x1,b.y1);m=v(b.x2,b.y2);b.x1=f.x;b.y1=f.y;b.x2=m.x;b.y2=m.y;case "text":case "tspan":case "use":N();break;case "g":(v=$(l).data("gsvg"))&&svgedit.utilities.assignAttributes(v,b,1E3,true);break;case "polyline":case "polygon":N=b.points.length;for(k=0;k<N;++k){e=b.points[k];e=v(e.x,e.y);
b.points[k].x=e.x;b.points[k].y=e.y}N=b.points.length;v="";for(k=0;k<N;++k){e=b.points[k];v+=e.x+","+e.y+" "}l.setAttribute("points",v);break;case "path":e=l.pathSegList;N=e.numberOfItems;b.d=[];for(k=0;k<N;++k){B=e.getItem(k);b.d[k]={type:B.pathSegType,x:B.x,y:B.y,x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,r1:B.r1,r2:B.r2,angle:B.angle,largeArcFlag:B.largeArcFlag,sweepFlag:B.sweepFlag}}N=b.d.length;k=b.d[0];i=v(k.x,k.y);b.d[0].x=i.x;b.d[0].y=i.y;for(k=1;k<N;++k){B=b.d[k];e=B.type;if(e%2==0){e=v(B.x!=undefined?
B.x:i.x,B.y!=undefined?B.y:i.y);f=v(B.x1,B.y1);m=v(B.x2,B.y2);B.x=e.x;B.y=e.y;B.x1=f.x;B.y1=f.y;B.x2=m.x;B.y2=m.y}else{B.x=d.a*B.x;B.y=d.d*B.y;B.x1=d.a*B.x1;B.y1=d.d*B.y1;B.x2=d.a*B.x2;B.y2=d.d*B.y2}B.r1=d.a*B.r1;B.r2=d.d*B.r2}v="";N=b.d.length;for(k=0;k<N;++k){B=b.d[k];e=B.type;v+=a[e];switch(e){case 13:case 12:v+=B.x+" ";break;case 15:case 14:v+=B.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:v+=B.x+","+B.y+" ";break;case 7:case 6:v+=B.x1+","+B.y1+" "+B.x2+","+B.y2+" "+B.x+","+B.y+" ";
break;case 9:case 8:v+=B.x1+","+B.y1+" "+B.x+","+B.y+" ";break;case 11:case 10:v+=B.r1+","+B.r2+" "+B.angle+" "+ +B.largeArcFlag+" "+ +B.sweepFlag+" "+B.x+","+B.y+" ";break;case 17:case 16:v+=B.x2+","+B.y2+" "+B.x+","+B.y+" "}}l.setAttribute("d",v)}}})();svgedit=svgedit||{};
(function(){if(!svgedit.recalculate)svgedit.recalculate={};var a=svgedit.NS,t;svgedit.recalculate.init=function(l){t=l};svgedit.recalculate.updateClipPath=function(l,b,d){l=getRefElem(l).firstChild;var k=svgedit.transformlist.getTransformList(l),e=t.getSVGRoot().createSVGTransform();e.setTranslate(b,d);k.appendItem(e);svgedit.recalculate.recalculateDimensions(l)};svgedit.recalculate.recalculateDimensions=function(l){if(l==null)return null;if(l.nodeName=="svg"&&navigator.userAgent.indexOf("Firefox/20")>=0)return null;
var b=t.getSVGRoot(),d=svgedit.transformlist.getTransformList(l),k;if(d&&d.numberOfItems>0){for(k=d.numberOfItems;k--;){var e=d.getItem(k);if(e.type===0)d.removeItem(k);else if(e.type===1)svgedit.math.isIdentity(e.matrix)&&d.removeItem(k);else e.type===4&&e.angle===0&&d.removeItem(k)}if(d.numberOfItems===1&&svgedit.utilities.getRotationAngle(l))return null}if(!d||d.numberOfItems==0){l.setAttribute("transform","");l.removeAttribute("transform");return null}if(d){k=d.numberOfItems;for(var v=[];k--;){e=
d.getItem(k);if(e.type===1)v.push([e.matrix,k]);else if(v.length)v=[]}if(v.length===2){k=b.createSVGTransformFromMatrix(svgedit.math.matrixMultiply(v[1][0],v[0][0]));d.removeItem(v[0][1]);d.removeItem(v[1][1]);d.insertItemBefore(k,v[1][1])}k=d.numberOfItems;if(k>=2&&d.getItem(k-2).type===1&&d.getItem(k-1).type===2){v=b.createSVGTransform();e=svgedit.math.matrixMultiply(d.getItem(k-2).matrix,d.getItem(k-1).matrix);v.setMatrix(e);d.removeItem(k-2);d.removeItem(k-2);d.appendItem(v)}}switch(l.tagName){case "line":case "polyline":case "polygon":case "path":break;
default:if(d.numberOfItems===1&&d.getItem(0).type===1||d.numberOfItems===2&&d.getItem(0).type===1&&d.getItem(0).type===4)return null}var z=$(l).data("gsvg");k=new svgedit.history.BatchCommand("Transform");var N={},B=null;e=[];switch(l.tagName){case "line":e=["x1","y1","x2","y2"];break;case "circle":e=["cx","cy","r"];break;case "ellipse":e=["cx","cy","rx","ry"];break;case "foreignObject":case "rect":case "image":e=["width","height","x","y"];break;case "use":case "text":case "tspan":e=["x","y"];break;
case "polygon":case "polyline":B={};B.points=l.getAttribute("points");v=l.points;var f=v.numberOfItems;N.points=Array(f);var m;for(m=0;m<f;++m){var i=v.getItem(m);N.points[m]={x:i.x,y:i.y}}break;case "path":B={};B.d=l.getAttribute("d");N.d=l.getAttribute("d")}if(e.length){N=$(l).attr(e);$.each(N,function(db,wa){N[db]=svgedit.units.convertToNum(db,wa)})}else if(z)N={x:$(z).attr("x")||0,y:$(z).attr("y")||0};if(B==null){B=$.extend(true,{},N);$.each(B,function(db,wa){B[db]=svgedit.units.convertToNum(db,
wa)})}B.transform=t.getStartTransform()||"";if(l.tagName=="g"&&!z||l.tagName=="a"){v=svgedit.utilities.getBBox(l);var h={x:v.x+v.width/2,y:v.y+v.height/2},o=svgedit.math.transformPoint(v.x+v.width/2,v.y+v.height/2,svgedit.math.transformListToTransform(d).matrix);e=b.createSVGMatrix();if(v=svgedit.utilities.getRotationAngle(l)){m=v*Math.PI/180;f=Math.abs(m)>1.0E-10?Math.sin(m)/(1-Math.cos(m)):2/m;for(m=0;m<d.numberOfItems;++m){e=d.getItem(m);if(e.type==4){e=e.matrix;h.y=(f*e.e+e.f)/2;h.x=(e.e-f*e.f)/
2;d.removeItem(m);break}}}m=e=z=0;var r=d.numberOfItems;if(r)var w=d.getItem(0).matrix;if(r>=3&&d.getItem(r-2).type==3&&d.getItem(r-3).type==2&&d.getItem(r-1).type==2){m=3;var A=d.getItem(r-3).matrix,S=d.getItem(r-2).matrix,W=d.getItem(r-1).matrix;f=l.childNodes;for(i=f.length;i--;){var R=f.item(i);e=z=0;if(R.nodeType==1){var T=svgedit.transformlist.getTransformList(R);if(T){e=svgedit.math.transformListToTransform(T).matrix;z=svgedit.utilities.getRotationAngle(R);var ba=t.getStartTransform(),ya=[];
t.setStartTransform(R.getAttribute("transform"));if(z||svgedit.math.hasMatrixTransform(T)){var ta=b.createSVGTransform();ta.setMatrix(svgedit.math.matrixMultiply(A,S,W,e));T.clear();T.appendItem(ta);ya.push(ta)}else{z=svgedit.math.matrixMultiply(e.inverse(),W,e);ta=b.createSVGMatrix();ta.e=-z.e;ta.f=-z.f;e=svgedit.math.matrixMultiply(ta.inverse(),e.inverse(),A,S,W,e,z.inverse());var Ta=b.createSVGTransform(),Xa=b.createSVGTransform(),Oa=b.createSVGTransform();Ta.setTranslate(z.e,z.f);Xa.setScale(e.a,
e.d);Oa.setTranslate(ta.e,ta.f);T.appendItem(Oa);T.appendItem(Xa);T.appendItem(Ta);ya.push(Oa);ya.push(Xa);ya.push(Ta)}k.addSubCommand(svgedit.recalculate.recalculateDimensions(R));t.setStartTransform(ba)}}}d.removeItem(r-1);d.removeItem(r-2);d.removeItem(r-3)}else if(r>=3&&d.getItem(r-1).type==1){m=3;e=svgedit.math.transformListToTransform(d).matrix;ta=b.createSVGTransform();ta.setMatrix(e);d.clear();d.appendItem(ta)}else if((r==1||r>1&&d.getItem(1).type!=3)&&d.getItem(0).type==2){m=2;z=svgedit.math.transformListToTransform(d).matrix;
d.removeItem(0);e=svgedit.math.transformListToTransform(d).matrix.inverse();e=svgedit.math.matrixMultiply(e,z);z=e.e;e=e.f;if(z!=0||e!=0){f=l.childNodes;i=f.length;for(r=[];i--;){R=f.item(i);if(R.nodeType==1){if(R.getAttribute("clip-path")){ba=R.getAttribute("clip-path");if(r.indexOf(ba)===-1){svgedit.recalculate.updateClipPath(ba,z,e);r.push(ba)}}ba=t.getStartTransform();t.setStartTransform(R.getAttribute("transform"));if(T=svgedit.transformlist.getTransformList(R)){A=b.createSVGTransform();A.setTranslate(z,
e);T.numberOfItems?T.insertItemBefore(A,0):T.appendItem(A);k.addSubCommand(svgedit.recalculate.recalculateDimensions(R));T=l.getElementsByTagNameNS(a.SVG,"use");R="#"+R.id;for(A=T.length;A--;){S=T.item(A);if(R==svgedit.utilities.getHref(S)){W=b.createSVGTransform();W.setTranslate(-z,-e);svgedit.transformlist.getTransformList(S).insertItemBefore(W,0);k.addSubCommand(svgedit.recalculate.recalculateDimensions(S))}}t.setStartTransform(ba)}}}r=[];t.setStartTransform(ba)}}else if(r==1&&d.getItem(0).type==
1&&!v){m=1;e=d.getItem(0).matrix;f=l.childNodes;for(i=f.length;i--;){R=f.item(i);if(R.nodeType==1){ba=t.getStartTransform();t.setStartTransform(R.getAttribute("transform"));if(T=svgedit.transformlist.getTransformList(R)){z=svgedit.math.matrixMultiply(e,svgedit.math.transformListToTransform(T).matrix);r=b.createSVGTransform();r.setMatrix(z);T.clear();T.appendItem(r,0);k.addSubCommand(svgedit.recalculate.recalculateDimensions(R));t.setStartTransform(ba);ba=R.getAttribute("stroke-width");R.getAttribute("stroke")!==
"none"&&!isNaN(ba)&&R.setAttribute("stroke-width",ba*((Math.abs(z.a)+Math.abs(z.d))/2))}}}d.clear()}else{if(v){b=b.createSVGTransform();b.setRotate(v,o.x,o.y);d.numberOfItems?d.insertItemBefore(b,0):d.appendItem(b)}d.numberOfItems==0&&l.removeAttribute("transform");return null}if(m==2){if(v){o={x:h.x+w.e,y:h.y+w.f};b=b.createSVGTransform();b.setRotate(v,o.x,o.y);d.numberOfItems?d.insertItemBefore(b,0):d.appendItem(b)}}else if(m==3){e=svgedit.math.transformListToTransform(d).matrix;w=b.createSVGTransform();
w.setRotate(v,h.x,h.y);w=w.matrix;h=b.createSVGTransform();h.setRotate(v,o.x,o.y);o=h.matrix.inverse();ba=e.inverse();o=svgedit.math.matrixMultiply(ba,o,w,e);z=o.e;e=o.f;if(z!=0||e!=0){f=l.childNodes;for(i=f.length;i--;){R=f.item(i);if(R.nodeType==1){ba=t.getStartTransform();t.setStartTransform(R.getAttribute("transform"));T=svgedit.transformlist.getTransformList(R);A=b.createSVGTransform();A.setTranslate(z,e);T.numberOfItems?T.insertItemBefore(A,0):T.appendItem(A);k.addSubCommand(svgedit.recalculate.recalculateDimensions(R));
t.setStartTransform(ba)}}}if(v)d.numberOfItems?d.insertItemBefore(h,0):d.appendItem(h)}}else{v=svgedit.utilities.getBBox(l);if(!v&&l.tagName!="path")return null;e=b.createSVGMatrix();if(z=svgedit.utilities.getRotationAngle(l)){h={x:v.x+v.width/2,y:v.y+v.height/2};o=svgedit.math.transformPoint(v.x+v.width/2,v.y+v.height/2,svgedit.math.transformListToTransform(d).matrix);m=z*Math.PI/180;f=Math.abs(m)>1.0E-10?Math.sin(m)/(1-Math.cos(m)):2/m;for(m=0;m<d.numberOfItems;++m){e=d.getItem(m);if(e.type==4){e=
e.matrix;h.y=(f*e.e+e.f)/2;h.x=(e.e-f*e.f)/2;d.removeItem(m);break}}}m=0;r=d.numberOfItems;if(!svgedit.browser.isWebkit())if((w=l.getAttribute("fill"))&&w.indexOf("url(")===0){w=getRefElem(w);ba="pattern";if(w.tagName!==ba)ba="gradient";if(w.getAttribute(ba+"Units")==="userSpaceOnUse"){e=svgedit.math.transformListToTransform(d).matrix;v=svgedit.transformlist.getTransformList(w);v=svgedit.math.transformListToTransform(v).matrix;e=svgedit.math.matrixMultiply(e,v);v="matrix("+[e.a,e.b,e.c,e.d,e.e,e.f].join(",")+
")";w.setAttribute(ba+"Transform",v)}}if(r>=3&&d.getItem(r-2).type==3&&d.getItem(r-3).type==2&&d.getItem(r-1).type==2){m=3;e=svgedit.math.transformListToTransform(d,r-3,r-1).matrix;d.removeItem(r-1);d.removeItem(r-2);d.removeItem(r-3)}else if(r==4&&d.getItem(r-1).type==1){m=3;e=svgedit.math.transformListToTransform(d).matrix;ta=b.createSVGTransform();ta.setMatrix(e);d.clear();d.appendItem(ta);e=b.createSVGMatrix()}else if((r==1||r>1&&d.getItem(1).type!=3)&&d.getItem(0).type==2){m=2;w=d.getItem(0).matrix;
ba=svgedit.math.transformListToTransform(d,1).matrix;v=ba.inverse();e=svgedit.math.matrixMultiply(v,w,ba);d.removeItem(0)}else if(r==1&&d.getItem(0).type==1&&!z){e=svgedit.math.transformListToTransform(d).matrix;switch(l.tagName){case "line":N=$(l).attr(["x1","y1","x2","y2"]);case "polyline":case "polygon":N.points=l.getAttribute("points");if(N.points){v=l.points;f=v.numberOfItems;N.points=Array(f);for(m=0;m<f;++m){i=v.getItem(m);N.points[m]={x:i.x,y:i.y}}}case "path":N.d=l.getAttribute("d");m=1;
d.clear()}}else{m=4;if(z){b=b.createSVGTransform();b.setRotate(z,o.x,o.y);d.numberOfItems?d.insertItemBefore(b,0):d.appendItem(b)}d.numberOfItems==0&&l.removeAttribute("transform");return null}if(m==1||m==2||m==3)svgedit.coords.remapElement(l,N,e);if(m==2){if(z){svgedit.math.hasMatrixTransform(d)||(o={x:h.x+e.e,y:h.y+e.f});b=b.createSVGTransform();b.setRotate(z,o.x,o.y);d.numberOfItems?d.insertItemBefore(b,0):d.appendItem(b)}if(l.tagName=="text"){f=l.childNodes;for(i=f.length;i--;){R=f.item(i);if(R.tagName==
"tspan"){b={x:$(R).attr("x")||0,y:$(R).attr("y")||0};svgedit.coords.remapElement(R,b,e)}}}}else if(m==3&&z){e=svgedit.math.transformListToTransform(d).matrix;w=b.createSVGTransform();w.setRotate(z,h.x,h.y);w=w.matrix;h=b.createSVGTransform();h.setRotate(z,o.x,o.y);o=h.matrix.inverse();ba=e.inverse();o=svgedit.math.matrixMultiply(ba,o,w,e);svgedit.coords.remapElement(l,N,o);if(z)d.numberOfItems?d.insertItemBefore(h,0):d.appendItem(h)}}d.numberOfItems==0&&l.removeAttribute("transform");k.addSubCommand(new svgedit.history.ChangeElementCommand(l,
B));return k}})();(function(){if(!svgedit.select)svgedit.select={};var a,t,l,b=svgedit.browser.isTouch()?10:4;svgedit.select.Selector=function(d,k,e){this.id=d;this.selectedElement=k;this.locked=true;this.selectorGroup=a.createSVGElement({element:"g",attr:{id:"selectorGroup"+this.id}});this.selectorRect=this.selectorGroup.appendChild(a.createSVGElement({element:"path",attr:{id:"selectedBox"+this.id,fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.gripCoords=
{nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.reset(this.selectedElement,e)};svgedit.select.Selector.prototype.reset=function(d,k){this.locked=true;this.selectedElement=d;this.resize(k);this.selectorGroup.setAttribute("display","inline")};svgedit.select.Selector.prototype.updateGripCursors=function(d){var k,e=[];d=Math.round(d/45);if(d<0)d+=8;for(k in l.selectorGrips)e.push(k);for(;d>0;){e.push(e.shift());d--}d=0;for(k in l.selectorGrips){l.selectorGrips[k].setAttribute("style",
"cursor:"+e[d]+"-resize");d++}};svgedit.select.Selector.prototype.showGrips=function(d){l.selectorGripsGroup.setAttribute("display",d?"inline":"none");var k=this.selectedElement;this.hasGrips=d;if(k&&d){this.selectorGroup.appendChild(l.selectorGripsGroup);this.updateGripCursors(svgedit.utilities.getRotationAngle(k))}};svgedit.select.Selector.prototype.resize=function(d){var k=this.selectorRect,e=l,v=e.selectorGrips,z=this.selectedElement,N=z.getAttribute("stroke-width"),B=a.currentZoom(),f=1/B;if(z.getAttribute("stroke")!==
"none"&&!isNaN(N))f+=N/2;var m=z.tagName;if(m==="text")f+=2/B;N=svgedit.transformlist.getTransformList(z);N=svgedit.math.transformListToTransform(N).matrix;N.e*=B;N.f*=B;d||(d=svgedit.utilities.getBBox(z));if(m==="g"&&!$.data(z,"gsvg"))if(m=a.getStrokedBBox(z.childNodes))d=m;m=d.x;var i=d.y,h=d.width;d=d.height;f*=B;B=svgedit.math.transformBox(m*B,i*B,h*B,d*B,N);d=B.aabox;m=d.x-f;i=d.y-f;var o=d.width+f*2;h=d.height+f*2;d=m+o/2;N=i+h/2;if(z=svgedit.utilities.getRotationAngle(z)){m=a.svgRoot().createSVGTransform();
m.setRotate(-z,d,N);m=m.matrix;B.tl=svgedit.math.transformPoint(B.tl.x,B.tl.y,m);B.tr=svgedit.math.transformPoint(B.tr.x,B.tr.y,m);B.bl=svgedit.math.transformPoint(B.bl.x,B.bl.y,m);B.br=svgedit.math.transformPoint(B.br.x,B.br.y,m);m=B.tl;o=m.x;h=m.y;var r=m.x,w=m.y;m=Math.min;i=Math.max;o=m(o,m(B.tr.x,m(B.bl.x,B.br.x)))-f;h=m(h,m(B.tr.y,m(B.bl.y,B.br.y)))-f;r=i(r,i(B.tr.x,i(B.bl.x,B.br.x)))+f;w=i(w,i(B.tr.y,i(B.bl.y,B.br.y)))+f;m=o;i=h;o=r-o;h=w-h}k.setAttribute("d","M"+m+","+i+" L"+(m+o)+","+i+" "+
(m+o)+","+(i+h)+" "+m+","+(i+h)+"z");this.selectorGroup.setAttribute("transform",z?"rotate("+[z,d,N].join(",")+")":"");this.gripCoords={nw:[m,i],ne:[m+o,i],sw:[m,i+h],se:[m+o,i+h],n:[m+o/2,i],w:[m,i+h/2],e:[m+o,i+h/2],s:[m+o/2,i+h]};for(var A in this.gripCoords){k=this.gripCoords[A];v[A].setAttribute("cx",k[0]);v[A].setAttribute("cy",k[1])}e.rotateGripConnector.setAttribute("x1",m+o/2);e.rotateGripConnector.setAttribute("y1",i);e.rotateGripConnector.setAttribute("x2",m+o/2);e.rotateGripConnector.setAttribute("y2",
i-b*5);e.rotateGrip.setAttribute("cx",m+o/2);e.rotateGrip.setAttribute("cy",i-b*5)};svgedit.select.SelectorManager=function(){this.rubberBandBox=this.selectorParentGroup=null;this.selectors=[];this.selectorMap={};this.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.rotateGrip=this.rotateGripConnector=this.selectorGripsGroup=null;this.initGroup()};svgedit.select.SelectorManager.prototype.initGroup=function(){this.selectorParentGroup&&this.selectorParentGroup.parentNode&&
this.selectorParentGroup.parentNode.removeChild(this.selectorParentGroup);this.selectorParentGroup=a.createSVGElement({element:"g",attr:{id:"selectorParentGroup"}});this.selectorGripsGroup=a.createSVGElement({element:"g",attr:{display:"none"}});this.selectorParentGroup.appendChild(this.selectorGripsGroup);a.svgRoot().appendChild(this.selectorParentGroup);this.selectorMap={};this.selectors=[];this.rubberBandBox=null;for(var d in this.selectorGrips){var k=a.createSVGElement({element:"circle",attr:{id:"selectorGrip_resize_"+
d,fill:"#22C",r:b,style:"cursor:"+d+"-resize","stroke-width":2,"pointer-events":"all"}});$.data(k,"dir",d);$.data(k,"type","resize");this.selectorGrips[d]=this.selectorGripsGroup.appendChild(k)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"line",attr:{id:"selectorGrip_rotateconnector",stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGripsGroup.appendChild(a.createSVGElement({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:b,
stroke:"#22C","stroke-width":2,style:"cursor:url("+t.imgPath+"rotate.png) 12 12, auto;"}}));$.data(this.rotateGrip,"type","rotate");if(!$("#canvasBackground").length){d=t.dimensions;d=a.createSVGElement({element:"svg",attr:{id:"canvasBackground",width:d[0],height:d[1],x:0,y:0,overflow:svgedit.browser.isWebkit()?"none":"visible",style:"pointer-events:none"}});k=a.createSVGElement({element:"rect",attr:{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"}});
d.appendChild(k);a.svgRoot().insertBefore(d,a.svgContent())}};svgedit.select.SelectorManager.prototype.requestSelector=function(d,k){if(d==null)return null;var e,v=this.selectors.length;if(typeof this.selectorMap[d.id]=="object"){this.selectorMap[d.id].locked=true;return this.selectorMap[d.id]}for(e=0;e<v;++e)if(this.selectors[e]&&!this.selectors[e].locked){this.selectors[e].locked=true;this.selectors[e].reset(d,k);this.selectorMap[d.id]=this.selectors[e];return this.selectors[e]}this.selectors[v]=
new svgedit.select.Selector(v,d,k);this.selectorParentGroup.appendChild(this.selectors[v].selectorGroup);this.selectorMap[d.id]=this.selectors[v];return this.selectors[v]};svgedit.select.SelectorManager.prototype.releaseSelector=function(d){if(d!=null){var k,e=this.selectors.length,v=this.selectorMap[d.id];v.locked||console.log("WARNING! selector was released but was already unlocked");for(k=0;k<e;++k)if(this.selectors[k]&&this.selectors[k]==v){delete this.selectorMap[d.id];v.locked=false;v.selectedElement=
null;v.showGrips(false);try{v.selectorGroup.setAttribute("display","none")}catch(z){}break}}};svgedit.select.SelectorManager.prototype.getRubberBandBox=function(){if(!this.rubberBandBox)this.rubberBandBox=this.selectorParentGroup.appendChild(a.createSVGElement({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}));return this.rubberBandBox};svgedit.select.init=function(d,k){t=d;a=k;l=new svgedit.select.SelectorManager};
svgedit.select.getSelectorManager=function(){return l}})();(function(){function a(k){for(var e=1;k.indexOf("Layer "+e)>=0;)e++;return"Layer "+e}if(!svgedit.draw)svgedit.draw={};var t=svgedit.NS,l="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use".split(","),b={LET_DOCUMENT_DECIDE:0,ALWAYS_RANDOMIZE:1,NEVER_RANDOMIZE:2},d=b.LET_DOCUMENT_DECIDE;svgedit.draw.randomizeIds=function(k,e){d=k===false?b.NEVER_RANDOMIZE:b.ALWAYS_RANDOMIZE;if(d==b.ALWAYS_RANDOMIZE&&!e.getNonce())e.setNonce(Math.floor(Math.random()*100001));
else d==b.NEVER_RANDOMIZE&&e.getNonce()&&e.clearNonce()};svgedit.draw.Drawing=function(k,e){if(!k||!k.tagName||!k.namespaceURI||k.tagName!="svg"||k.namespaceURI!=t.SVG)throw"Error: svgedit.draw.Drawing instance initialized without a <svg> element";this.svgElem_=k;this.obj_num=0;this.idPrefix=e||"svg_";this.releasedNums=[];this.all_layers=[];this.layer_map={};this.current_layer=null;this.nonce_="";var v=this.svgElem_.getAttributeNS(t.SE,"nonce");if(v&&d!=b.NEVER_RANDOMIZE)this.nonce_=v;else d==b.ALWAYS_RANDOMIZE&&
this.setNonce(Math.floor(Math.random()*100001))};svgedit.draw.Drawing.prototype.getElem_=function(k){if(this.svgElem_.querySelector)return this.svgElem_.querySelector("#"+k);return $(this.svgElem_).find("[id="+k+"]")[0]};svgedit.draw.Drawing.prototype.getSvgElem=function(){return this.svgElem_};svgedit.draw.Drawing.prototype.getNonce=function(){return this.nonce_};svgedit.draw.Drawing.prototype.setNonce=function(k){this.svgElem_.setAttributeNS(t.XMLNS,"xmlns:se",t.SE);this.svgElem_.setAttributeNS(t.SE,
"se:nonce",k);this.nonce_=k};svgedit.draw.Drawing.prototype.clearNonce=function(){this.nonce_=""};svgedit.draw.Drawing.prototype.getId=function(){return this.nonce_?this.idPrefix+this.nonce_+"_"+this.obj_num:this.idPrefix+this.obj_num};svgedit.draw.Drawing.prototype.getNextId=function(){var k=this.obj_num,e=false;if(this.releasedNums.length>0){this.obj_num=this.releasedNums.pop();e=true}else this.obj_num++;for(var v=this.getId();this.getElem_(v);){if(e){this.obj_num=k;e=false}this.obj_num++;v=this.getId()}if(e)this.obj_num=
k;return v};svgedit.draw.Drawing.prototype.releaseId=function(k){var e=this.idPrefix+(this.nonce_?this.nonce_+"_":"");if(typeof k!=="string"||k.indexOf(e)!==0)return false;k=parseInt(k.substr(e.length),10);if(typeof k!=="number"||k<=0||this.releasedNums.indexOf(k)!=-1)return false;this.releasedNums.push(k);return true};svgedit.draw.Drawing.prototype.getNumLayers=function(){return this.all_layers.length};svgedit.draw.Drawing.prototype.hasLayer=function(k){return this.layer_map[k]!==undefined};svgedit.draw.Drawing.prototype.getLayerName=
function(k){return k>=0&&k<this.getNumLayers()?this.all_layers[k].getName():""};svgedit.draw.Drawing.prototype.getCurrentLayer=function(){return this.current_layer?this.current_layer.getGroup():null};svgedit.draw.Drawing.prototype.getLayerByName=function(k){return(k=this.layer_map[k])?k.getGroup():null};svgedit.draw.Drawing.prototype.getCurrentLayerName=function(){return this.current_layer?this.current_layer.getName():""};svgedit.draw.Drawing.prototype.setCurrentLayerName=function(k,e){var v=null;
if(this.current_layer){var z=this.current_layer.getName();if(v=this.current_layer.setName(k,e)){delete this.layer_map[z];this.layer_map[v]=this.current_layer}}return v};svgedit.draw.Drawing.prototype.setCurrentLayerPosition=function(k){var e=this.getNumLayers();if(!this.current_layer||k<0||k>=e)return null;var v;for(v=0;v<e;++v)if(this.all_layers[v]==this.current_layer)break;if(v==e)return null;if(v!=k){var z=null,N=this.current_layer.getGroup(),B=N.nextSibling;if(k>v){if(k<e-1)z=this.all_layers[k+
1].getGroup()}else z=this.all_layers[k].getGroup();this.svgElem_.insertBefore(N,z);this.identifyLayers();this.setCurrentLayer(this.getLayerName(k));return{currentGroup:N,oldNextSibling:B}}return null};svgedit.draw.Drawing.prototype.mergeLayer=function(k){var e=this.current_layer.getGroup(),v=$(e).prev()[0];if(v){k.startBatchCommand("Merge Layer");for(k.removeElement(e,e.nextSibling,this.svgElem_);e.firstChild;){var z=e.firstChild;if(z.localName=="title"){k.removeElement(z,z.nextSibling,e);e.removeChild(z)}else{var N=
z.nextSibling;v.appendChild(z);k.moveElement(z,N,e)}}this.current_layer.removeGroup();e=this.all_layers.indexOf(this.current_layer);if(e>0){v=this.current_layer.getName();this.current_layer=this.all_layers[e-1];this.all_layers.splice(e,1);delete this.layer_map[v]}k.endBatchCommand()}};svgedit.draw.Drawing.prototype.mergeAllLayers=function(k){this.current_layer=this.all_layers[this.all_layers.length-1];for(k.startBatchCommand("Merge all Layers");this.all_layers.length>1;)this.mergeLayer(k);k.endBatchCommand()};
svgedit.draw.Drawing.prototype.setCurrentLayer=function(k){if(k=this.layer_map[k]){this.current_layer&&this.current_layer.deactivate();this.current_layer=k;this.current_layer.activate();return true}return false};svgedit.draw.Drawing.prototype.deleteCurrentLayer=function(){if(this.current_layer&&this.getNumLayers()>1){var k=this.current_layer.removeGroup();this.identifyLayers();return k}return null};svgedit.draw.Drawing.prototype.identifyLayers=function(){this.all_layers=[];this.layer_map={};for(var k=
this.svgElem_.childNodes.length,e=[],v=[],z=null,N=false,B=0;B<k;++B){var f=this.svgElem_.childNodes.item(B);if(f&&f.nodeType==1)if(f.tagName=="g"){N=true;var m;m=f;var i=$("title",m).text();if(!i&&svgedit.browser.isOpera()&&m.querySelectorAll)i=$(m.querySelectorAll("title")).text();if(m=i){v.push(m);z=new svgedit.draw.Layer(m,f);this.all_layers.push(z);this.layer_map[m]=z}else e.push(f)}else~l.indexOf(f.nodeName)&&e.push(f)}if(e.length>0||!N){z=new svgedit.draw.Layer(a(v),null,this.svgElem_);z.appendChildren(e);
this.all_layers.push(z);this.layer_map[m]=z}else z.activate();this.current_layer=z};svgedit.draw.Drawing.prototype.createLayer=function(k,e){this.current_layer&&this.current_layer.deactivate();if(k===undefined||k===null||k===""||this.layer_map[k])k=a(Object.keys(this.layer_map));var v=new svgedit.draw.Layer(k,null,this.svgElem_);if(e){e.startBatchCommand("Create Layer");e.insertElement(v.getGroup());e.endBatchCommand()}this.all_layers.push(v);this.current_layer=this.layer_map[k]=v;return v.getGroup()};
svgedit.draw.Drawing.prototype.cloneLayer=function(k,e){if(!this.current_layer)return null;this.current_layer.deactivate();if(k===undefined||k===null||k===""||this.layer_map[k])k=a(Object.keys(this.layer_map));var v=this.current_layer.getGroup(),z=new svgedit.draw.Layer(k,v,this.svgElem_),N=z.getGroup();v=v.childNodes;var B;for(B=0;B<v.length;B++){var f=v[B];f.localName!="title"&&N.appendChild(this.copyElem(f))}if(e){e.startBatchCommand("Duplicate Layer");e.insertElement(N);e.endBatchCommand()}B=
this.all_layers.indexOf(this.current_layer);B>=0?this.all_layers.splice(B+1,0,z):this.all_layers.push(z);this.current_layer=this.layer_map[k]=z;return N};svgedit.draw.Drawing.prototype.getLayerVisibility=function(k){return(k=this.layer_map[k])?k.isVisible():false};svgedit.draw.Drawing.prototype.setLayerVisibility=function(k,e){if(typeof e!=="boolean")return null;var v=this.layer_map[k];if(!v)return null;v.setVisible(e);return v.getGroup()};svgedit.draw.Drawing.prototype.getLayerOpacity=function(k){k=
this.layer_map[k];if(!k)return null;return k.getOpacity()};svgedit.draw.Drawing.prototype.setLayerOpacity=function(k,e){if(!(typeof e!=="number"||e<0||e>1)){var v=this.layer_map[k];v&&v.setOpacity(e)}};svgedit.draw.Drawing.prototype.copyElem=function(k){var e=this;return svgedit.utilities.copyElem(k,function(){return e.getNextId()})}})();(function(){function a(b){var d=b.getAttribute("class");if(d===null||d===undefined||d.length===0)b.setAttribute("class",l.CLASS_NAME);else l.CLASS_REGEX.test(d)||b.setAttribute("class",d+" "+l.CLASS_NAME)}if(!svgedit.draw)svgedit.draw={};var t=svgedit.NS,l=svgedit.draw.Layer=function(b,d,k){this.name_=b;this.group_=k?null:d;if(k){var e=k.ownerDocument;this.group_=e.createElementNS(t.SVG,"g");e=e.createElementNS(t.SVG,"title");e.textContent=b;this.group_.appendChild(e);d?$(d).after(this.group_):k.appendChild(this.group_)}a(this.group_);
svgedit.utilities.walkTree(this.group_,function(v){v.setAttribute("style","pointer-events:inherit")});this.group_.setAttribute("style",k?"pointer-events:all":"pointer-events:none")};l.CLASS_NAME="layer";l.CLASS_REGEX=RegExp("(\\s|^)"+l.CLASS_NAME+"(\\s|$)");l.prototype.getName=function(){return this.name_};l.prototype.getGroup=function(){return this.group_};l.prototype.activate=function(){this.group_.setAttribute("style","pointer-events:all")};l.prototype.deactivate=function(){this.group_.setAttribute("style",
"pointer-events:none")};l.prototype.setVisible=function(b){b=b===undefined||b?"inline":"none";this.group_.getAttribute("display")!==b&&this.group_.setAttribute("display",b)};l.prototype.isVisible=function(){return this.group_.getAttribute("display")!=="none"};l.prototype.getOpacity=function(){var b=this.group_.getAttribute("opacity");if(b===null||b===undefined)return 1;return parseFloat(b)};l.prototype.setOpacity=function(b){typeof b==="number"&&b>=0&&b<=1&&this.group_.setAttribute("opacity",b)};
l.prototype.appendChildren=function(b){for(var d=0;d<b.length;++d)this.group_.appendChild(b[d])};l.prototype.getTitleElement=function(){for(var b=this.group_.childNodes.length,d=0;d<b;++d){var k=this.group_.childNodes.item(d);if(k&&k.tagName==="title")return k}return null};l.prototype.setName=function(b,d){var k=this.name_;b=svgedit.utilities.toXml(b);var e=this.getTitleElement();if(e){for(;e.firstChild;)e.removeChild(e.firstChild);this.name_=e.textContent=b;d&&d.changeElement(e,{"#text":k});return this.name_}return null};
l.prototype.removeGroup=function(){var b=this.group_.parentNode.removeChild(this.group_);this.group_=undefined;return b}})();(function(){if(!svgedit.path)svgedit.path={};var a=svgedit.NS,t={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties"},l={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]},b=[],d=true,k={};svgedit.path.setLinkControlPoints=function(i){d=i};var e=svgedit.path.path=null;
svgedit.path.init=function(i){e=i;b=[0,"ClosePath"];$.each(["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"],function(h,o){b.push(o+"Abs");b.push(o+"Rel")})};svgedit.path.insertItemBefore=function(i,h,o){i=i.pathSegList;if(svgedit.browser.supportsPathInsertItemBefore())i.insertItemBefore(h,o);else{var r=i.numberOfItems,w=[],A;for(A=0;A<r;A++){var S=i.getItem(A);w.push(S)}i.clear();for(A=0;A<r;A++){A==o&&i.appendItem(h);
i.appendItem(w[A])}}};svgedit.path.ptObjToArr=function(i,h){var o=l[i],r=o.length,w,A=[];for(w=0;w<r;w++)A[w]=h[o[w]];return A};svgedit.path.getGripPt=function(i,h){var o={x:h?h.x:i.item.x,y:h?h.y:i.item.y},r=i.path;if(r.matrix)o=svgedit.math.transformPoint(o.x,o.y,r.matrix);o.x*=e.getCurrentZoom();o.y*=e.getCurrentZoom();return o};svgedit.path.getPointFromGrip=function(i,h){var o={x:i.x,y:i.y};if(h.matrix){i=svgedit.math.transformPoint(o.x,o.y,h.imatrix);o.x=i.x;o.y=i.y}o.x/=e.getCurrentZoom();o.y/=
e.getCurrentZoom();return o};svgedit.path.addPointGrip=function(i,h,o){var r=svgedit.path.getGripContainer(),w=svgedit.utilities.getElem("pathpointgrip_"+i);if(!w){w=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(w,{id:"pathpointgrip_"+i,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":t.pathNodeTooltip});w=r.appendChild(w);$("#pathpointgrip_"+i).dblclick(function(){svgedit.path.path&&svgedit.path.path.setSegType()})}h&&
o&&svgedit.utilities.assignAttributes(w,{cx:h,cy:o,display:"inline"});return w};svgedit.path.getGripContainer=function(){var i=svgedit.utilities.getElem("pathpointgrip_container");if(!i){i=svgedit.utilities.getElem("selectorParentGroup").appendChild(document.createElementNS(a.SVG,"g"));i.id="pathpointgrip_container"}return i};svgedit.path.addCtrlGrip=function(i){var h=svgedit.utilities.getElem("ctrlpointgrip_"+i);if(h)return h;h=document.createElementNS(a.SVG,"circle");svgedit.utilities.assignAttributes(h,
{id:"ctrlpointgrip_"+i,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":t.pathCtrlPtTooltip});svgedit.path.getGripContainer().appendChild(h);return h};svgedit.path.getCtrlLine=function(i){var h=svgedit.utilities.getElem("ctrlLine_"+i);if(h)return h;h=document.createElementNS(a.SVG,"line");svgedit.utilities.assignAttributes(h,{id:"ctrlLine_"+i,stroke:"#555","stroke-width":1,style:"pointer-events:none"});svgedit.path.getGripContainer().appendChild(h);
return h};svgedit.path.getPointGrip=function(i,h){var o=svgedit.path.addPointGrip(i.index);if(h){var r=svgedit.path.getGripPt(i);svgedit.utilities.assignAttributes(o,{cx:r.x,cy:r.y,display:"inline"})}return o};svgedit.path.getControlPoints=function(i){var h=i.item,o=i.index;if(!("x1"in h)||!("x2"in h))return null;var r={};svgedit.path.getGripContainer();var w=[svgedit.path.path.segs[o-1].item,h],A;for(A=1;A<3;A++){var S=o+"c"+A,W=r["c"+A+"_line"]=svgedit.path.getCtrlLine(S),R=svgedit.path.getGripPt(i,
{x:h["x"+A],y:h["y"+A]}),T=svgedit.path.getGripPt(i,{x:w[A-1].x,y:w[A-1].y});svgedit.utilities.assignAttributes(W,{x1:R.x,y1:R.y,x2:T.x,y2:T.y,display:"inline"});r["c"+A+"_line"]=W;S=r["c"+A]=svgedit.path.addCtrlGrip(S);svgedit.utilities.assignAttributes(S,{cx:R.x,cy:R.y,display:"inline"});r["c"+A]=S}return r};svgedit.path.replacePathSeg=function(i,h,o,r){r=r||svgedit.path.path.elem;i=r["createSVGPathSeg"+b[i]].apply(r,o);if(svgedit.browser.supportsPathReplaceItem())r.pathSegList.replaceItem(i,h);
else{o=r.pathSegList;r=o.numberOfItems;var w=[],A;for(A=0;A<r;A++){var S=o.getItem(A);w.push(S)}o.clear();for(A=0;A<r;A++)A==h?o.appendItem(i):o.appendItem(w[A])}};svgedit.path.getSegSelector=function(i,h){var o=i.index,r=svgedit.utilities.getElem("segline_"+o);if(!r){var w=svgedit.path.getGripContainer();r=document.createElementNS(a.SVG,"path");svgedit.utilities.assignAttributes(r,{id:"segline_"+o,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});
w.appendChild(r)}if(h){o=i.prev;if(!o){r.setAttribute("display","none");return r}o=svgedit.path.getGripPt(o);svgedit.path.replacePathSeg(2,0,[o.x,o.y],r);w=svgedit.path.ptObjToArr(i.type,i.item,true);var A;for(A=0;A<w.length;A+=2){o=svgedit.path.getGripPt(i,{x:w[A],y:w[A+1]});w[A]=o.x;w[A+1]=o.y}svgedit.path.replacePathSeg(i.type,1,w,r)}return r};svgedit.path.smoothControlPoints=function(i,h,o){var r=i.x-o.x,w=i.y-o.y,A=h.x-o.x,S=h.y-o.y;if((r!=0||w!=0)&&(A!=0||S!=0)){i=Math.atan2(w,r);h=Math.atan2(S,
A);r=Math.sqrt(r*r+w*w);A=Math.sqrt(A*A+S*S);w=e.getSVGRoot().createSVGPoint();S=e.getSVGRoot().createSVGPoint();if(i<0)i+=2*Math.PI;if(h<0)h+=2*Math.PI;var W=Math.abs(i-h),R=Math.abs(Math.PI-W)/2;if(i-h>0){i=W<Math.PI?i+R:i-R;h=W<Math.PI?h-R:h+R}else{i=W<Math.PI?i-R:i+R;h=W<Math.PI?h+R:h-R}w.x=r*Math.cos(i)+o.x;w.y=r*Math.sin(i)+o.y;S.x=A*Math.cos(h)+o.x;S.y=A*Math.sin(h)+o.y;return[w,S]}};svgedit.path.Segment=function(i,h){this.selected=false;this.index=i;this.item=h;this.type=h.pathSegType;this.ctrlpts=
[];this.segsel=this.ptgrip=null};svgedit.path.Segment.prototype.showCtrlPts=function(i){for(var h in this.ctrlpts)if(this.ctrlpts.hasOwnProperty(h))this.ctrlpts[h].setAttribute("display",i?"inline":"none")};svgedit.path.Segment.prototype.selectCtrls=function(i){$("#ctrlpointgrip_"+this.index+"c1, #ctrlpointgrip_"+this.index+"c2").attr("fill",i?"#0FF":"#EEE")};svgedit.path.Segment.prototype.show=function(i){if(this.ptgrip){this.ptgrip.setAttribute("display",i?"inline":"none");this.segsel.setAttribute("display",
i?"inline":"none");this.showCtrlPts(i)}};svgedit.path.Segment.prototype.select=function(i){if(this.ptgrip){this.ptgrip.setAttribute("stroke",i?"#0FF":"#00F");this.segsel.setAttribute("display",i?"inline":"none");this.ctrlpts&&this.selectCtrls(i);this.selected=i}};svgedit.path.Segment.prototype.addGrip=function(){this.ptgrip=svgedit.path.getPointGrip(this,true);this.ctrlpts=svgedit.path.getControlPoints(this,true);this.segsel=svgedit.path.getSegSelector(this,true)};svgedit.path.Segment.prototype.update=
function(i){if(this.ptgrip){var h=svgedit.path.getGripPt(this);svgedit.utilities.assignAttributes(this.ptgrip,{cx:h.x,cy:h.y});svgedit.path.getSegSelector(this,true);if(this.ctrlpts){if(i){this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);this.type=this.item.pathSegType}svgedit.path.getControlPoints(this)}}};svgedit.path.Segment.prototype.move=function(i,h){var o;o=this.item;o=this.ctrlpts?[o.x+=i,o.y+=h,o.x1,o.y1,o.x2+=i,o.y2+=h]:[o.x+=i,o.y+=h];svgedit.path.replacePathSeg(this.type,
this.index,o);if(this.next&&this.next.ctrlpts){o=this.next.item;o=[o.x,o.y,o.x1+=i,o.y1+=h,o.x2,o.y2];svgedit.path.replacePathSeg(this.next.type,this.next.index,o)}if(this.mate){o=this.mate.item;o=[o.x+=i,o.y+=h];svgedit.path.replacePathSeg(this.mate.type,this.mate.index,o)}this.update(true);this.next&&this.next.update(true)};svgedit.path.Segment.prototype.setLinked=function(i){var h,o,r;if(i==2){o=1;h=this.next;if(!h)return;r=this.item}else{o=2;h=this.prev;if(!h)return;r=h.item}var w=h.item;w["x"+
o]=r.x+(r.x-this.item["x"+i]);w["y"+o]=r.y+(r.y-this.item["y"+i]);svgedit.path.replacePathSeg(h.type,h.index,[w.x,w.y,w.x1,w.y1,w.x2,w.y2]);h.update(true)};svgedit.path.Segment.prototype.moveCtrl=function(i,h,o){var r=this.item;r["x"+i]+=h;r["y"+i]+=o;svgedit.path.replacePathSeg(this.type,this.index,[r.x,r.y,r.x1,r.y1,r.x2,r.y2]);this.update(true)};svgedit.path.Segment.prototype.setType=function(i,h){svgedit.path.replacePathSeg(i,this.index,h);this.type=i;this.item=svgedit.path.path.elem.pathSegList.getItem(this.index);
this.showCtrlPts(i===6);this.ctrlpts=svgedit.path.getControlPoints(this);this.update(true)};svgedit.path.Path=function(i){if(!i||i.tagName!=="path")throw"svgedit.path.Path constructed without a <path> element";this.elem=i;this.segs=[];this.selected_pts=[];svgedit.path.path=this;this.init()};svgedit.path.Path.prototype.init=function(){$(svgedit.path.getGripContainer()).find("*").each(function(){$(this).attr("display","none")});var i=this.elem.pathSegList,h=i.numberOfItems;this.segs=[];this.selected_pts=
[];this.first_seg=null;var o;for(o=0;o<h;o++){var r=i.getItem(o);r=new svgedit.path.Segment(o,r);r.path=this;this.segs.push(r)}i=this.segs;r=null;for(o=0;o<h;o++){var w=i[o],A=o+1>=h?null:i[o+1],S=o-1<0?null:i[o-1];if(w.type===2){if(S&&S.type!==1){A=i[r];A.next=i[r+1];A.next.prev=A;A.addGrip()}r=o}else if(A&&A.type===1){w.next=i[r+1];w.next.prev=w;w.mate=i[r];w.addGrip();if(this.first_seg==null)this.first_seg=w}else if(A){if(w.type!==1){w.addGrip();if(A&&A.type!==2){w.next=A;w.next.prev=w}}}else if(w.type!==
1){A=i[r];A.next=i[r+1];A.next.prev=A;A.addGrip();w.addGrip();if(!this.first_seg)this.first_seg=i[r]}}return this};svgedit.path.Path.prototype.eachSeg=function(i){var h,o=this.segs.length;for(h=0;h<o;h++)if(i.call(this.segs[h],h)===false)break};svgedit.path.Path.prototype.addSeg=function(i){var h=this.segs[i];if(h.prev){var o=h.prev,r,w,A;switch(h.item.pathSegType){case 4:w=(h.item.x+o.item.x)/2;A=(h.item.y+o.item.y)/2;r=this.elem.createSVGPathSegLinetoAbs(w,A);break;case 6:r=(o.item.x+h.item.x1)/
2;var S=(h.item.x1+h.item.x2)/2,W=(h.item.x2+h.item.x)/2,R=(r+S)/2;S=(S+W)/2;w=(R+S)/2;var T=(o.item.y+h.item.y1)/2,ba=(h.item.y1+h.item.y2)/2;o=(h.item.y2+h.item.y)/2;var ya=(T+ba)/2;ba=(ba+o)/2;A=(ya+ba)/2;r=this.elem.createSVGPathSegCurvetoCubicAbs(w,A,r,T,R,ya);svgedit.path.replacePathSeg(h.type,i,[h.item.x,h.item.y,S,ba,W,o])}svgedit.path.insertItemBefore(this.elem,r,i)}};svgedit.path.Path.prototype.deleteSeg=function(i){var h=this.segs[i],o=this.elem.pathSegList;h.show(false);var r=h.next,w;
if(h.mate){w=[r.item.x,r.item.y];svgedit.path.replacePathSeg(2,r.index,w);svgedit.path.replacePathSeg(4,h.index,w);o.removeItem(h.mate.index)}else{if(!h.prev){w=[r.item.x,r.item.y];svgedit.path.replacePathSeg(2,h.next.index,w)}o.removeItem(i)}};svgedit.path.Path.prototype.subpathIsClosed=function(i){var h=false;svgedit.path.path.eachSeg(function(o){if(o<=i)return true;if(this.type===2)return false;if(this.type===1){h=true;return false}});return h};svgedit.path.Path.prototype.removePtFromSelection=
function(i){var h=this.selected_pts.indexOf(i);if(h!=-1){this.segs[i].select(false);this.selected_pts.splice(h,1)}};svgedit.path.Path.prototype.clearSelection=function(){this.eachSeg(function(){this.select(false)});this.selected_pts=[]};svgedit.path.Path.prototype.storeD=function(){this.last_d=this.elem.getAttribute("d")};svgedit.path.Path.prototype.show=function(i){this.eachSeg(function(){this.show(i)});i&&this.selectPt(this.first_seg.index);return this};svgedit.path.Path.prototype.movePts=function(i,
h){for(var o=this.selected_pts.length;o--;)this.segs[this.selected_pts[o]].move(i,h)};svgedit.path.Path.prototype.moveCtrl=function(i,h){var o=this.segs[this.selected_pts[0]];o.moveCtrl(this.dragctrl,i,h);d&&o.setLinked(this.dragctrl)};svgedit.path.Path.prototype.setSegType=function(i){this.storeD();for(var h=this.selected_pts.length,o;h--;){var r=this.segs[this.selected_pts[h]],w=r.prev;if(w){if(!i){o="Toggle Path Segment Type";i=r.type==6?4:6}i=Number(i);var A=r.item.x,S=r.item.y,W=w.item.x;w=w.item.y;
var R;switch(i){case 6:if(r.olditem){W=r.olditem;R=[A,S,W.x1,W.y1,W.x2,W.y2]}else{R=A-W;var T=S-w;R=[A,S,W+R/3,w+T/3,A-R/3,S-T/3]}break;case 4:R=[A,S];r.olditem=r.item}r.setType(i,R)}}svgedit.path.path.endChanges(o)};svgedit.path.Path.prototype.selectPt=function(i,h){this.clearSelection();i==null&&this.eachSeg(function(o){if(this.prev)i=o});this.addPtsToSelection(i);if(h){this.dragctrl=h;d&&this.segs[i].setLinked(h)}};svgedit.path.Path.prototype.update=function(){var i=this.elem;if(svgedit.utilities.getRotationAngle(i)){this.matrix=
svgedit.math.getMatrix(i);this.imatrix=this.matrix.inverse()}else this.imatrix=this.matrix=null;this.eachSeg(function(h){this.item=i.pathSegList.getItem(h);this.update()});return this};svgedit.path.getPath_=function(i){var h=k[i.id];h||(h=k[i.id]=new svgedit.path.Path(i));return h};svgedit.path.removePath_=function(i){i in k&&delete k[i]};var v,z,N,B,f,m=function(i,h){var o=i-N,r=h-B,w=Math.sqrt(o*o+r*r);r=Math.atan2(r,o)+f;o=w*Math.cos(r)+N;r=w*Math.sin(r)+B;o-=v;r-=z;w=Math.sqrt(o*o+r*r);r=Math.atan2(r,
o)-f;return{x:w*Math.cos(r)+v,y:w*Math.sin(r)+z}};svgedit.path.recalcRotatedPath=function(){var i=svgedit.path.path.elem;if(f=svgedit.utilities.getRotationAngle(i,true)){var h=svgedit.utilities.getBBox(i),o=svgedit.path.path.oldbbox;N=o.x+o.width/2;B=o.y+o.height/2;v=h.x+h.width/2;z=h.y+h.height/2;o=v-N;var r=z-B;h=Math.sqrt(o*o+r*r);o=Math.atan2(r,o)+f;v=h*Math.cos(o)+N;z=h*Math.sin(o)+B;h=i.pathSegList;for(o=h.numberOfItems;o;){o-=1;var w=h.getItem(o);r=w.pathSegType;if(r!=1){var A=m(w.x,w.y);A=
[A.x,A.y];if(w.x1!=null&&w.x2!=null){var S=m(w.x1,w.y1);w=m(w.x2,w.y2);A.splice(A.length,0,S.x,S.y,w.x,w.y)}svgedit.path.replacePathSeg(r,o,A)}}svgedit.utilities.getBBox(i);h=svgroot.createSVGTransform();i=svgedit.transformlist.getTransformList(i);h.setRotate(f*180/Math.PI,v,z);i.replaceItem(h,0)}};svgedit.path.clearData=function(){k={}}})();(function(){if(!window.console){window.console={};window.console.log=function(){};window.console.dir=function(){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(){}}})();
$.SvgCanvas=function(a,t){function l(c){return c?c:new svgedit.history.HistoryRecordingService(z.undoMgr)}function b(){za();var c=[],n={feGaussianBlur:ub.exportNoBlur,foreignObject:ub.exportNoforeignObject,"[stroke-dasharray]":ub.exportNoDashArray},g=$(f);if(!("font"in $("<canvas>")[0].getContext("2d")))n.text=ub.exportNoText;$.each(n,function(u,s){g.find(u).length&&c.push(s)});return c}function d(c,n){var g,u=svgedit.utilities.getBBox(c);for(g=0;g<2;g++){var s=g===0?"fill":"stroke",F=c.getAttribute(s);
if(F&&F.indexOf("url(")===0){F=svgedit.utilities.getRefElem(F);if(F.tagName==="linearGradient"){var q=F.getAttribute("x1")||0,C=F.getAttribute("y1")||0,D=F.getAttribute("x2")||1,I=F.getAttribute("y2")||0;q=u.width*q+u.x;C=u.height*C+u.y;D=u.width*D+u.x;I=u.height*I+u.y;q=svgedit.math.transformPoint(q,C,n);I=svgedit.math.transformPoint(D,I,n);D={};D.x1=(q.x-u.x)/u.width;D.y1=(q.y-u.y)/u.height;D.x2=(I.x-u.x)/u.width;D.y2=(I.y-u.y)/u.height;F=F.cloneNode(true);$(F).attr(D);F.id=Ia();svgedit.utilities.findDefs().appendChild(F);
c.setAttribute(s,"url(#"+F.id+")")}}}}var k=svgedit.NS,e={show_outside_canvas:true,selectNew:true,dimensions:[640,480]};t&&$.extend(e,t);var v=e.dimensions,z=this,N=a.ownerDocument,B=N.importNode(svgedit.utilities.text2xml('<svg id="svgroot" xmlns="'+k.SVG+'" xlinkns="'+k.XLINK+'" width="'+v[0]+'" height="'+v[1]+'" x="'+v[0]+'" y="'+v[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,
true);a.appendChild(B);var f=N.createElementNS(k.SVG,"svg");(z.clearSvgContentElement=function(){for(;f.firstChild;)f.removeChild(f.firstChild);$(f).attr({id:"svgcontent",width:v[0],height:v[1],x:v[0],y:v[1],overflow:e.show_outside_canvas?"visible":"hidden",xmlns:k.SVG,"xmlns:se":k.SE,"xmlns:xlink":k.XLINK}).appendTo(B);var c=N.createComment(" Created with SVG-edit - https://github.com/SVG-Edit/svgedit");f.appendChild(c)})();var m="svg_";z.setIdPrefix=function(c){m=c};z.current_drawing_=new svgedit.draw.Drawing(f,
m);var i=z.getCurrentDrawing=function(){return z.current_drawing_},h=1,o=null,r={shape:{fill:(e.initFill.color=="none"?"":"#")+e.initFill.color,fill_paint:null,fill_opacity:e.initFill.opacity,stroke:"#"+e.initStroke.color,stroke_paint:null,stroke_opacity:e.initStroke.opacity,stroke_width:e.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:e.initOpacity}};r.text=$.extend(true,{},r.shape);$.extend(r.text,{fill:"#000000",stroke_width:e.text.stroke_width,font_size:e.text.font_size,
font_family:e.text.font_family});var w=r.shape,A=[],S=this.addSvgElementFromJson=function(c){if(typeof c=="string")return N.createTextNode(c);var n=svgedit.utilities.getElem(c.attr.id),g=i().getCurrentLayer();if(n&&c.element!=n.tagName){g.removeChild(n);n=null}if(!n){n=N.createElementNS(k.SVG,c.element);if(g)(o||g).appendChild(n)}c.curStyles&&svgedit.utilities.assignAttributes(n,{fill:w.fill,stroke:w.stroke,"stroke-width":w.stroke_width,"stroke-dasharray":w.stroke_dasharray,"stroke-linejoin":w.stroke_linejoin,
"stroke-linecap":w.stroke_linecap,"stroke-opacity":w.stroke_opacity,"fill-opacity":w.fill_opacity,opacity:w.opacity/2,style:"pointer-events:inherit"},100);svgedit.utilities.assignAttributes(n,c.attr,100);svgedit.utilities.cleanupElement(n);c.children&&c.children.forEach(function(u){n.appendChild(S(u))});return n};z.getTransformList=svgedit.transformlist.getTransformList;var W=svgedit.math.transformPoint,R=z.matrixMultiply=svgedit.math.matrixMultiply,T=z.hasMatrixTransform=svgedit.math.hasMatrixTransform,
ba=z.transformListToTransform=svgedit.math.transformListToTransform;svgedit.units.init({getBaseUnit:function(){return e.baseUnit},getElement:svgedit.utilities.getElem,getHeight:function(){return f.getAttribute("height")/h},getWidth:function(){return f.getAttribute("width")/h},getRoundDigits:function(){return hb.round_digits}});z.convertToNum=svgedit.units.convertToNum;svgedit.utilities.init({getDOMDocument:function(){return N},getDOMContainer:function(){return a},getSVGRoot:function(){return B},getSelectedElements:function(){return A},
getSVGContent:function(){return f},getBaseUnit:function(){return e.baseUnit},getSnappingStep:function(){return e.snappingStep}});var ya=z.findDefs=svgedit.utilities.findDefs,ta=z.getUrlFromAttr=svgedit.utilities.getUrlFromAttr,Ta=z.getHref=svgedit.utilities.getHref,Xa=z.setHref=svgedit.utilities.setHref,Oa=svgedit.utilities.getPathBBox;z.getBBox=svgedit.utilities.getBBox;z.getRotationAngle=svgedit.utilities.getRotationAngle;var db=z.getElem=svgedit.utilities.getElem;z.getRefElem=svgedit.utilities.getRefElem;
var wa=z.assignAttributes=svgedit.utilities.assignAttributes,Ib=this.cleanupElement=svgedit.utilities.cleanupElement;svgedit.coords.init({getDrawing:function(){return i()},getGridSnapping:function(){return e.gridSnapping}});var Jb=this.remapElement=svgedit.coords.remapElement;svgedit.recalculate.init({getSVGRoot:function(){return B},getStartTransform:function(){return vb},setStartTransform:function(c){vb=c}});var Kb=this.recalculateDimensions=svgedit.recalculate.recalculateDimensions,eb=svgedit.getReverseNS(),
Lb=z.sanitizeSvg=svgedit.sanitize.sanitizeSvg,ib=svgedit.history.MoveElementCommand,ab=svgedit.history.InsertElementCommand,jb=svgedit.history.RemoveElementCommand,Sb=svgedit.history.ChangeElementCommand,ja=svgedit.history.BatchCommand,la;z.undoMgr=new svgedit.history.UndoManager({handleHistoryEvent:function(c,n){var g=svgedit.history.HistoryEventTypes;if(c==g.BEFORE_UNAPPLY||c==g.BEFORE_APPLY)z.clearSelection();else if(c==g.AFTER_APPLY||c==g.AFTER_UNAPPLY){var u=n.elements();z.pathActions.clear();
la("changed",u);u=n.type();g=c==g.AFTER_APPLY;if(u==ib.type())(g?n.newParent:n.oldParent)==f&&z.identifyLayers();else if(u==ab.type()||u==jb.type()){n.parent==f&&z.identifyLayers();if(u==ab.type())g&&pb(n.elem);else g||pb(n.elem);n.elem.tagName==="use"&&Mb(n.elem)}else if(u==Sb.type()){n.elem.tagName=="title"&&n.elem.parentNode.parentNode==f&&z.identifyLayers();g=g?n.newValues:n.oldValues;g.stdDeviation&&z.setBlurOffsets(n.elem.parentNode,g.stdDeviation)}}}});var pa=function(c){z.undoMgr.addCommandToHistory(c)};
svgedit.select.init(e,{createSVGElement:function(c){return z.addSvgElementFromJson(c)},svgRoot:function(){return B},svgContent:function(){return f},currentZoom:function(){return h},getStrokedBBox:function(c){return z.getStrokedBBox([c])}});var ua=this.selectorManager=svgedit.select.getSelectorManager();svgedit.path.init({getCurrentZoom:function(){return h},getSVGRoot:function(){return B}});var ub={exportNoBlur:"Blurred elements will appear as un-blurred",exportNoforeignObject:"foreignObject elements will not appear",
exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},Ab=["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],wb=$.data,Pa=document.createElementNS(k.SVG,"animate");$(Pa).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(B);var pb=function(c){var n,g=$(c).attr(Ab);for(n in g){var u=g[n];if(u&&u.indexOf("url(")===0){u=svgedit.utilities.getUrlFromAttr(u).substr(1);if(!db(u)){svgedit.utilities.findDefs().appendChild(Tb[u]);
delete Tb[u]}}}g=c.getElementsByTagName("*");if(g.length){c=0;for(n=g.length;c<n;c++)pb(g[c])}},oa={},Ua=e.imgPath+"logo.png",mb=[],hb={round_digits:5},Ba=false,vb=null,xa="select",bb="none",xb={},Ca=r.text,Va=w,Ub=null,Aa=null,Ja=[],Bb={},Cb=null,Tb={};z.clipBoard=[];var Ya=this.runExtensions=function(c,n,g){var u=g?[]:false;$.each(Bb,function(s,F){if(F&&c in F)if(g)u.push(F[c](n));else u=F[c](n)});return u};this.addExtension=function(c,n){var g;if(c in Bb)console.log('Cannot add extension "'+c+
'", an extension by that name already exists.');else{g=$.isFunction(n)?n($.extend(z.getPrivateMethods(),{svgroot:B,svgcontent:f,nonce:i().getNonce(),selectorManager:ua})):n;Bb[c]=g;la("extension_added",g)}};var qb=this.round=function(c){return parseInt(c*h,10)/h},Za=this.getIntersectionList=function(c){if(Aa==null)return null;var n=o||i().getCurrentLayer(),g;if(c){g=f.createSVGRect();g.x=c.x;g.y=c.y;g.width=c.width;g.height=c.height}else{g=Aa.getBBox();var u;c=f.createSVGRect();for(u in g)c[u]=g[u]/
h;g=c}u=null;if(!svgedit.browser.isIE)if(typeof B.getIntersectionList=="function"){g.x+=parseInt(f.getAttribute("x"),10);g.y+=parseInt(f.getAttribute("y"),10);u=B.getIntersectionList(g,n)}if(u==null||typeof u.item!="function"){u=[];Ja.length||(Ja=Vb(n));for(n=Ja.length;n--;)g.width&&svgedit.math.rectsIntersect(g,Ja[n].bbox)&&u.push(Ja[n].elem)}return u},fb=this.getStrokedBBox=function(c){c||(c=yb());return svgedit.utilities.getStrokedBBox(c,S,qa)},yb=this.getVisibleElements=function(c){c||(c=$(f).children());
var n=[];$(c).children().each(function(g,u){u.getBBox&&n.push(u)});return n.reverse()},Vb=this.getVisibleElementsAndBBoxes=function(c){c||(c=$(f).children());var n=[];$(c).children().each(function(g,u){u.getBBox&&n.push({elem:u,bbox:fb([u])})});return n.reverse()},Nb=this.groupSvgElem=function(c){var n=document.createElementNS(k.SVG,"g");c.parentNode.replaceChild(n,c);$(n).append(c).data("gsvg",c)[0].id=Ia()},gb,Ia,Na,qa;(function(c){var n={};gb=c.getId=function(){return i().getId()};Ia=c.getNextId=
function(){return i().getNextId()};la=c.call=function(g,u){if(n[g])return n[g](this,u)};c.bind=function(g,u){var s=n[g];n[g]=u;return s}})(z);this.prepareSvg=function(c){this.sanitizeSvg(c.documentElement);var n,g,u=c.getElementsByTagNameNS(k.SVG,"path");c=0;for(g=u.length;c<g;++c){n=u[c];n.setAttribute("d",qa.convertPath(n));qa.fixEnd(n)}};var Ob=function(c){if(!svgedit.browser.isGecko())return c;var n=c.cloneNode(true);c.parentNode.insertBefore(n,c);c.parentNode.removeChild(c);ua.releaseSelector(c);
A[0]=n;ua.requestSelector(n).showGrips(true);return n};this.setRotationAngle=function(c,n){c=parseFloat(c);var g=A[0],u=g.getAttribute("transform"),s=svgedit.utilities.getBBox(g),F=s.x+s.width/2,q=s.y+s.height/2;s=svgedit.transformlist.getTransformList(g);s.numberOfItems>0&&s.getItem(0).type==4&&s.removeItem(0);if(c!=0){F=svgedit.math.transformPoint(F,q,svgedit.math.transformListToTransform(s).matrix);q=B.createSVGTransform();q.setRotate(c,F.x,F.y);s.numberOfItems?s.insertItemBefore(q,0):s.appendItem(q)}else s.numberOfItems==
0&&g.removeAttribute("transform");if(!n){s=g.getAttribute("transform");g.setAttribute("transform",u);Wa("transform",s,A);la("changed",A)}svgedit.utilities.getElem("pathpointgrip_container");g=ua.requestSelector(A[0]);g.resize();g.updateGripCursors(c)};var Wb=this.recalculateAllSelectedDimensions=function(){for(var c=new svgedit.history.BatchCommand(bb=="none"?"position":"size"),n=A.length;n--;){var g=svgedit.recalculate.recalculateDimensions(A[n]);g&&c.addSubCommand(g)}if(!c.isEmpty()){pa(c);la("changed",
A)}},Xb=function(c){console.log([c.a,c.b,c.c,c.d,c.e,c.f])},kb=null,za=this.clearSelection=function(c){if(A[0]!=null){var n,g,u=A.length;for(n=0;n<u;++n){g=A[n];if(g==null)break;ua.releaseSelector(g);A[n]=null}}c||la("selected",A)},nb=this.addToSelection=function(c,n){if(c.length!=0){for(var g=0;g<A.length;){if(A[g]==null)break;++g}for(var u=c.length;u--;){var s=c[u];if(s){var F=svgedit.utilities.getBBox(s);if(F){if(s.tagName==="a"&&s.childNodes.length===1)s=s.firstChild;if(A.indexOf(s)==-1){A[g]=
s;g++;s=ua.requestSelector(s,F);A.length>1&&s.showGrips(false)}}}}la("selected",A);n||A.length==1?ua.requestSelector(A[0]).showGrips(true):ua.requestSelector(A[0]).showGrips(false);for(A.sort(function(q,C){if(q&&C&&q.compareDocumentPosition)return 3-(C.compareDocumentPosition(q)&6);if(q==null)return 1});A[0]==null;)A.shift(0)}},cb=this.selectOnly=function(c,n){za(true);nb(c,n)};this.removeFromSelection=function(c){if(A[0]!=null)if(c.length!=0){var n,g=0,u=[],s=A.length;u.length=s;for(n=0;n<s;++n){var F=
A[n];if(F)if(c.indexOf(F)==-1){u[g]=F;g++}else ua.releaseSelector(F)}A=u}};this.selectAllInCurrentLayer=function(){var c=i().getCurrentLayer();if(c){xa="select";cb($(o||c).children())}};var Db=this.getMouseTarget=function(c){if(c==null)return null;c=c.target;if(c.correspondingUseElement)c=c.correspondingUseElement;if([k.MATH,k.HTML].indexOf(c.namespaceURI)>=0&&c.id!="svgcanvas")for(;c.nodeName!="foreignObject";){c=c.parentNode;if(!c)return B}var n=i().getCurrentLayer();if([B,a,f,n].indexOf(c)>=0)return B;
if($(c).closest("#selectorParentGroup").length)return ua.selectorParentGroup;for(;c.parentNode!==(o||n);)c=c.parentNode;return c};(function(){var c=null,n=null,g=null,u=null,s=null,F={},q={minx:null,miny:null,maxx:null,maxy:null},C=0,D={x:0,y:0},I={x:0,y:0},J={x:0,y:0},P={x:0,y:0},Z,Y,da={x:0,y:0},ga={x:0,y:0},ma=function(U){var M={x:0,y:0},H=D,K=I,O=J,aa=P,ia=1/6,ra=U*U,Ga=ra*U,ca=[[-1,3,-3,1],[3,-6,3,0],[-3,0,3,0],[1,4,1,0]];M.x=ia*((H.x*ca[0][0]+K.x*ca[0][1]+O.x*ca[0][2]+aa.x*ca[0][3])*Ga+(H.x*
ca[1][0]+K.x*ca[1][1]+O.x*ca[1][2]+aa.x*ca[1][3])*ra+(H.x*ca[2][0]+K.x*ca[2][1]+O.x*ca[2][2]+aa.x*ca[2][3])*U+(H.x*ca[3][0]+K.x*ca[3][1]+O.x*ca[3][2]+aa.x*ca[3][3]));M.y=ia*((H.y*ca[0][0]+K.y*ca[0][1]+O.y*ca[0][2]+aa.y*ca[0][3])*Ga+(H.y*ca[1][0]+K.y*ca[1][1]+O.y*ca[1][2]+aa.y*ca[1][3])*ra+(H.y*ca[2][0]+K.y*ca[2][1]+O.y*ca[2][2]+aa.y*ca[2][3])*U+(H.y*ca[3][0]+K.y*ca[3][1]+O.y*ca[3][2]+aa.y*ca[3][3]));return{x:M.x,y:M.y}};$(a).mousedown(function(U){if(!(z.spaceKey||U.button===1)){var M=U.button===2;
U.altKey&&svgCanvas.cloneSelectedElements(0,0);kb=$("#svgcontent g")[0].getScreenCTM().inverse();var H=svgedit.math.transformPoint(U.pageX,U.pageY,kb),K=H.x*h,O=H.y*h;U.preventDefault();if(M){xa="select";Cb=H}H=K/h;O=O/h;var aa=Db(U);if(aa.tagName==="a"&&aa.childNodes.length===1)aa=aa.firstChild;u=n=K=H;var ia=O;s=g=O;if(e.gridSnapping){H=svgedit.utilities.snapToGrid(H);O=svgedit.utilities.snapToGrid(O);n=svgedit.utilities.snapToGrid(n);g=svgedit.utilities.snapToGrid(g)}if(aa==ua.selectorParentGroup&&
A[0]!=null){aa=U.target;var ra=wb(aa,"type");if(ra=="rotate")xa="rotate";else if(ra=="resize"){xa="resize";bb=wb(aa,"dir")}aa=A[0]}vb=aa.getAttribute("transform");var Ga;ra=svgedit.transformlist.getTransformList(aa);switch(xa){case "select":Ba=true;bb="none";if(M)Ba=false;if(aa!=B){if(A.indexOf(aa)==-1){U.shiftKey||za(true);nb([aa]);Ub=aa;qa.clear()}if(!M)for(M=0;M<A.length;++M)if(A[M]!=null){Ga=svgedit.transformlist.getTransformList(A[M]);Ga.numberOfItems?Ga.insertItemBefore(B.createSVGTransform(),
0):Ga.appendItem(B.createSVGTransform())}}else if(!M){za();xa="multiselect";if(Aa==null)Aa=ua.getRubberBandBox();u*=h;s*=h;svgedit.utilities.assignAttributes(Aa,{x:u,y:s,width:0,height:0,display:"inline"},100)}break;case "zoom":Ba=true;if(Aa==null)Aa=ua.getRubberBandBox();svgedit.utilities.assignAttributes(Aa,{x:K*h,y:K*h,width:0,height:0,display:"inline"},100);break;case "resize":Ba=true;n=H;g=O;F=svgedit.utilities.getBBox($("#selectedBox0")[0]);var ca={};$.each(F,function(Ea,Da){ca[Ea]=Da/h});F=
ca;M=svgedit.utilities.getRotationAngle(aa)?1:0;if(svgedit.math.hasMatrixTransform(ra)){ra.insertItemBefore(B.createSVGTransform(),M);ra.insertItemBefore(B.createSVGTransform(),M);ra.insertItemBefore(B.createSVGTransform(),M)}else{ra.appendItem(B.createSVGTransform());ra.appendItem(B.createSVGTransform());ra.appendItem(B.createSVGTransform());if(svgedit.browser.supportsNonScalingStroke()){if(H=svgedit.browser.isWebkit())Ga=function(Ea){var Da=Ea.getAttributeNS(null,"stroke");Ea.removeAttributeNS(null,
"stroke");Da!==null&&setTimeout(function(){Ea.setAttributeNS(null,"stroke",Da)},0)};aa.style.vectorEffect="non-scaling-stroke";H&&Ga(aa);O=aa.getElementsByTagName("*");K=O.length;for(M=0;M<K;M++){O[M].style.vectorEffect="non-scaling-stroke";H&&Ga(O[M])}}}break;case "fhellipse":case "fhrect":case "fhpath":J.x=K;J.y=ia;Ba=true;c=K+","+ia+" ";Ga=w.stroke_width==0?1:w.stroke_width;S({element:"polyline",curStyles:true,attr:{points:c,id:Ia(),fill:"none",opacity:w.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});
q.minx=K;q.maxx=K;q.miny=ia;q.maxy=ia;break;case "image":Ba=true;Ga=S({element:"image",attr:{x:H,y:O,width:0,height:0,id:Ia(),opacity:w.opacity/2,style:"pointer-events:inherit"}});Xa(Ga,Ua);svgedit.utilities.preventClickDefault(Ga);break;case "square":case "rect":Ba=true;n=H;g=O;S({element:"rect",curStyles:true,attr:{x:H,y:O,width:0,height:0,id:Ia(),opacity:w.opacity/2}});break;case "line":Ba=true;Ga=w.stroke_width==0?1:w.stroke_width;S({element:"line",curStyles:true,attr:{x1:H,y1:O,x2:H,y2:O,id:Ia(),
stroke:w.stroke,"stroke-width":Ga,"stroke-dasharray":w.stroke_dasharray,"stroke-linejoin":w.stroke_linejoin,"stroke-linecap":w.stroke_linecap,"stroke-opacity":w.stroke_opacity,fill:"none",opacity:w.opacity/2,style:"pointer-events:none"}});break;case "circle":Ba=true;S({element:"circle",curStyles:true,attr:{cx:H,cy:O,r:0,id:Ia(),opacity:w.opacity/2}});break;case "ellipse":Ba=true;S({element:"ellipse",curStyles:true,attr:{cx:H,cy:O,rx:0,ry:0,id:Ia(),opacity:w.opacity/2}});break;case "text":Ba=true;
S({element:"text",curStyles:true,attr:{x:H,y:O,id:Ia(),fill:Ca.fill,"stroke-width":Ca.stroke_width,"font-size":Ca.font_size,"font-family":Ca.font_family,"text-anchor":"middle","xml:space":"preserve",opacity:w.opacity}});break;case "path":case "pathedit":n*=h;g*=h;qa.mouseDown(U,aa,n,g);Ba=true;break;case "textedit":n*=h;g*=h;Na.mouseDown(U,aa,n,g);Ba=true;break;case "rotate":Ba=true;z.undoMgr.beginUndoableChange("transform",A)}U=Ya("mouseDown",{event:U,start_x:n,start_y:g,selectedElements:A},true);
$.each(U,function(Ea,Da){if(Da&&Da.started)Ba=true})}}).mousemove(function(U){if(Ba)if(!(U.button===1||z.spaceKey)){var M,H,K,O,aa,ia=A[0],ra=svgedit.math.transformPoint(U.pageX,U.pageY,kb),Ga=ra.x*h;ra=ra.y*h;var ca=svgedit.utilities.getElem(gb());x=H=Ga/h;y=O=ra/h;if(e.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}U.preventDefault();switch(xa){case "select":if(A[0]!==null){H=x-n;K=y-g;if(e.gridSnapping){H=svgedit.utilities.snapToGrid(H);K=svgedit.utilities.snapToGrid(K)}if(U.shiftKey){M=
svgedit.math.snapToAngle(n,g,x,y);x=M.x;y=M.y}if(H!=0||K!=0){O=A.length;for(M=0;M<O;++M){ia=A[M];if(ia==null)break;var Ea=B.createSVGTransform();ca=svgedit.transformlist.getTransformList(ia);Ea.setTranslate(H,K);ca.numberOfItems?ca.replaceItem(Ea,0):ca.appendItem(Ea);ua.requestSelector(ia).resize()}la("transition",A)}}break;case "multiselect":H*=h;O*=h;svgedit.utilities.assignAttributes(Aa,{x:Math.min(u,H),y:Math.min(s,O),width:Math.abs(H-u),height:Math.abs(O-s)},100);ca=A.slice();H=[];Ea=Za();O=
Ea.length;for(M=0;M<O;++M){K=Ea[M];A.indexOf(K)==-1&&H.push(K);K=ca.indexOf(K);K!=-1&&ca.splice(K,1)}ca.length>0&&z.removeFromSelection(ca);H.length>0&&z.addToSelection(H);break;case "resize":ca=svgedit.transformlist.getTransformList(ia);K=(M=svgedit.math.hasMatrixTransform(ca))?F:svgedit.utilities.getBBox(ia);O=K.x;Ea=K.y;var Da=K.width,lb=K.height;H=x-n;K=y-g;if(e.gridSnapping){H=svgedit.utilities.snapToGrid(H);K=svgedit.utilities.snapToGrid(K);lb=svgedit.utilities.snapToGrid(lb);Da=svgedit.utilities.snapToGrid(Da)}if(aa=
svgedit.utilities.getRotationAngle(ia)){var ob=Math.sqrt(H*H+K*K);K=Math.atan2(K,H)-aa*Math.PI/180;H=ob*Math.cos(K);K=ob*Math.sin(K)}if(bb.indexOf("n")==-1&&bb.indexOf("s")==-1)K=0;if(bb.indexOf("e")==-1&&bb.indexOf("w")==-1)H=0;var Eb=ob=0,Pb=lb?(lb+K)/lb:1,Fb=Da?(Da+H)/Da:1;if(bb.indexOf("n")>=0){Pb=lb?(lb-K)/lb:1;Eb=lb}if(bb.indexOf("w")>=0){Fb=Da?(Da-H)/Da:1;ob=Da}H=B.createSVGTransform();K=B.createSVGTransform();Da=B.createSVGTransform();if(e.gridSnapping){O=svgedit.utilities.snapToGrid(O);ob=
svgedit.utilities.snapToGrid(ob);Ea=svgedit.utilities.snapToGrid(Ea);Eb=svgedit.utilities.snapToGrid(Eb)}H.setTranslate(-(O+ob),-(Ea+Eb));if(U.shiftKey)if(Fb==1)Fb=Pb;else Pb=Fb;K.setScale(Fb,Pb);Da.setTranslate(O+ob,Ea+Eb);if(M){M=aa?1:0;ca.replaceItem(H,2+M);ca.replaceItem(K,1+M);ca.replaceItem(Da,Number(M))}else{M=ca.numberOfItems;ca.replaceItem(Da,M-3);ca.replaceItem(K,M-2);ca.replaceItem(H,M-1)}ua.requestSelector(ia).resize();la("transition",A);break;case "zoom":H*=h;O*=h;svgedit.utilities.assignAttributes(Aa,
{x:Math.min(u*h,H),y:Math.min(s*h,O),width:Math.abs(H-u*h),height:Math.abs(O-s*h)},100);break;case "text":svgedit.utilities.assignAttributes(ca,{x:x,y:y},1E3);break;case "line":if(e.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y)}H=x;M=y;if(U.shiftKey){M=svgedit.math.snapToAngle(n,g,H,M);H=M.x;M=M.y}ca.setAttributeNS(null,"x2",H);ca.setAttributeNS(null,"y2",M);break;case "foreignObject":case "square":case "rect":case "image":H=Math.abs(x-n);M=Math.abs(y-g);if(xa==
"square"||U.shiftKey){H=M=Math.max(H,M);O=n<x?n:n-H;Ea=g<y?g:g-M}else{O=Math.min(n,x);Ea=Math.min(g,y)}if(e.gridSnapping){H=svgedit.utilities.snapToGrid(H);M=svgedit.utilities.snapToGrid(M);O=svgedit.utilities.snapToGrid(O);Ea=svgedit.utilities.snapToGrid(Ea)}svgedit.utilities.assignAttributes(ca,{width:H,height:M,x:O,y:Ea},1E3);break;case "circle":M=$(ca).attr(["cx","cy"]);H=M.cx;M=M.cy;H=Math.sqrt((x-H)*(x-H)+(y-M)*(y-M));if(e.gridSnapping)H=svgedit.utilities.snapToGrid(H);ca.setAttributeNS(null,
"r",H);break;case "ellipse":M=$(ca).attr(["cx","cy"]);H=M.cx;M=M.cy;if(e.gridSnapping){x=svgedit.utilities.snapToGrid(x);H=svgedit.utilities.snapToGrid(H);y=svgedit.utilities.snapToGrid(y);M=svgedit.utilities.snapToGrid(M)}ca.setAttributeNS(null,"rx",Math.abs(x-H));ca.setAttributeNS(null,"ry",Math.abs(U.shiftKey?x-H:y-M));break;case "fhellipse":case "fhrect":q.minx=Math.min(H,q.minx);q.maxx=Math.max(H,q.maxx);q.miny=Math.min(O,q.miny);q.maxy=Math.max(O,q.maxy);case "fhpath":P.x=H;P.y=O;if(D.x&&D.y)for(M=
0;M<9;M++){Z=M/10;Y=(M+1)/10;ga=da=ma(Y);da=ma(Z);C+=Math.sqrt((ga.x-da.x)*(ga.x-da.x)+(ga.y-da.y)*(ga.y-da.y));if(C>0.8){c+=+da.x+","+da.y+" ";ca.setAttributeNS(null,"points",c);C-=0.8}}D={x:I.x,y:I.y};I={x:J.x,y:J.y};J={x:P.x,y:P.y};break;case "path":case "pathedit":x*=h;y*=h;if(e.gridSnapping){x=svgedit.utilities.snapToGrid(x);y=svgedit.utilities.snapToGrid(y);n=svgedit.utilities.snapToGrid(n);g=svgedit.utilities.snapToGrid(g)}if(U.shiftKey){if(M=svgedit.path.path){ca=M.dragging?M.dragging[0]:
n;M=M.dragging?M.dragging[1]:g}else{ca=n;M=g}M=svgedit.math.snapToAngle(ca,M,x,y);x=M.x;y=M.y}if(Aa&&Aa.getAttribute("display")!=="none"){H*=h;O*=h;svgedit.utilities.assignAttributes(Aa,{x:Math.min(u*h,H),y:Math.min(s*h,O),width:Math.abs(H-u*h),height:Math.abs(O-s*h)},100)}qa.mouseMove(x,y);break;case "textedit":x*=h;y*=h;Na.mouseMove(Ga,ra);break;case "rotate":K=svgedit.utilities.getBBox(ia);H=K.x+K.width/2;M=K.y+K.height/2;ca=svgedit.math.getMatrix(ia);ca=svgedit.math.transformPoint(H,M,ca);H=ca.x;
M=ca.y;aa=(Math.atan2(M-y,H-x)*(180/Math.PI)-90)%360;if(e.gridSnapping)aa=svgedit.utilities.snapToGrid(aa);if(U.shiftKey)aa=Math.round(aa/45)*45;z.setRotationAngle(aa<-180?360+aa:aa,true);la("transition",A)}Ya("mouseMove",{event:U,mouse_x:Ga,mouse_y:ra,selected:ia})}}).click(function(U){U.preventDefault();return false}).dblclick(function(U){var M=U.target.parentNode;if(M!==o){var H=Db(U),K=H.tagName;if(K==="text"&&xa!=="textedit"){U=svgedit.math.transformPoint(U.pageX,U.pageY,kb);Na.select(H,U.x,
U.y)}if((K==="g"||K==="a")&&svgedit.utilities.getRotationAngle(H)){rb(H);H=A[0];za(true)}o&&sb();M.tagName!=="g"&&M.tagName!=="a"||M===i().getCurrentLayer()||H===ua.selectorParentGroup||gc(H)}}).mouseup(function(U){if(U.button!==2){var M=Ub;Ub=null;if(Ba){var H=svgedit.math.transformPoint(U.pageX,U.pageY,kb),K=H.x*h;H=H.y*h;var O=K/h,aa=H/h,ia=svgedit.utilities.getElem(gb()),ra=false;Ba=false;switch(xa){case "resize":case "multiselect":if(Aa!=null){Aa.setAttribute("display","none");Ja=[]}xa="select";
case "select":if(A[0]!=null){if(A[1]==null){K=A[0];switch(K.tagName){case "g":case "use":case "image":case "foreignObject":break;default:Va.fill=K.getAttribute("fill");Va.fill_opacity=K.getAttribute("fill-opacity");Va.stroke=K.getAttribute("stroke");Va.stroke_opacity=K.getAttribute("stroke-opacity");Va.stroke_width=K.getAttribute("stroke-width");Va.stroke_dasharray=K.getAttribute("stroke-dasharray");Va.stroke_linejoin=K.getAttribute("stroke-linejoin");Va.stroke_linecap=K.getAttribute("stroke-linecap")}if(K.tagName==
"text"){Ca.font_size=K.getAttribute("font-size");Ca.font_family=K.getAttribute("font-family")}ua.requestSelector(K).showGrips(true)}Wb();if(O!=u||aa!=s){K=A.length;for(U=0;U<K;++U){if(A[U]==null)break;A[U].firstChild||ua.requestSelector(A[U]).resize()}}else{K=U.target;if(A[0].nodeName==="path"&&A[1]==null)qa.select(A[0]);else U.shiftKey&&M!=K&&z.removeFromSelection([K])}if(svgedit.browser.supportsNonScalingStroke())if(U=A[0]){U.removeAttribute("style");svgedit.utilities.walkTree(U,function(Ea){Ea.removeAttribute("style")})}}return;
case "zoom":Aa!=null&&Aa.setAttribute("display","none");la("zoomed",{x:Math.min(u,O),y:Math.min(s,aa),width:Math.abs(O-u),height:Math.abs(aa-s),factor:U.shiftKey?0.5:2});return;case "fhpath":C=0;D={x:0,y:0};I={x:0,y:0};J={x:0,y:0};P={x:0,y:0};M=ia.getAttribute("points");O=M.indexOf(",");if(ra=O>=0?M.indexOf(",",O+1)>=0:M.indexOf(" ",M.indexOf(" ")+1)>=0)ia=qa.smoothPolylineIntoPath(ia);break;case "line":M=$(ia).attr(["x1","x2","y1","y2"]);ra=M.x1!=M.x2||M.y1!=M.y2;break;case "foreignObject":case "square":case "rect":case "image":M=
$(ia).attr(["width","height"]);ra=M.width!=0||M.height!=0||xa==="image";break;case "circle":ra=ia.getAttribute("r")!=0;break;case "ellipse":M=$(ia).attr(["rx","ry"]);ra=M.rx!=null||M.ry!=null;break;case "fhellipse":if(q.maxx-q.minx>0&&q.maxy-q.miny>0){ia=S({element:"ellipse",curStyles:true,attr:{cx:(q.minx+q.maxx)/2,cy:(q.miny+q.maxy)/2,rx:(q.maxx-q.minx)/2,ry:(q.maxy-q.miny)/2,id:gb()}});la("changed",[ia]);ra=true}break;case "fhrect":if(q.maxx-q.minx>0&&q.maxy-q.miny>0){ia=S({element:"rect",curStyles:true,
attr:{x:q.minx,y:q.miny,width:q.maxx-q.minx,height:q.maxy-q.miny,id:gb()}});la("changed",[ia]);ra=true}break;case "text":ra=true;cb([ia]);Na.start(ia);break;case "path":ia=null;Ba=true;M=qa.mouseUp(U,ia,K,H);ia=M.element;ra=M.keep;break;case "pathedit":ra=true;ia=null;qa.mouseUp(U);break;case "textedit":ra=false;ia=null;Na.mouseUp(U,K,H);break;case "rotate":ra=true;ia=null;xa="select";M=z.undoMgr.finishUndoableChange();M.isEmpty()||pa(M);Wb();la("changed",A)}K=Ya("mouseUp",{event:U,mouse_x:K,mouse_y:H},
true);$.each(K,function(Ea,Da){if(Da){ra=Da.keep||ra;ia=Da.element;Ba=Da.started||Ba}});if(!ra&&ia!=null){i().releaseId(gb());ia.parentNode.removeChild(ia);ia=null;for(K=U.target;K.parentNode.parentNode.tagName=="g";)K=K.parentNode;if((xa!="path"||!drawn_path)&&K.parentNode.id!="selectorParentGroup"&&K.id!="svgcanvas"&&K.id!="svgroot"){z.setMode("select");cb([K],true)}}else if(ia!=null){z.addedNew=true;U=0.2;var Ga;if(Pa.beginElement&&ia.getAttribute("opacity")!=w.opacity){Ga=$(Pa).clone().attr({to:w.opacity,
dur:U}).appendTo(ia);try{Ga[0].beginElement()}catch(ca){}}else U=0;setTimeout(function(){Ga&&Ga.remove();ia.setAttribute("opacity",w.opacity);ia.setAttribute("style","pointer-events:inherit");Ib(ia);if(xa==="path")qa.toEditMode(ia);else e.selectNew&&cb([ia],true);pa(new svgedit.history.InsertElementCommand(ia));la("changed",[ia])},U*1E3)}vb=null}}});$(a).bind("mousewheel DOMMouseScroll",function(U){U.preventDefault();U=U.originalEvent;kb=$("#svgcontent g")[0].getScreenCTM().inverse();var M=svgedit.math.transformPoint(U.pageX,
U.pageY,kb);M={x:M.x,y:M.y,width:0,height:0};if(U=U.wheelDelta?U.wheelDelta:U.detail?-U.detail:0){M.factor=Math.max(0.75,Math.min(4/3,U));la("zoomed",M)}})})();Na=z.textActions=function(){function c(H){var K=I.value==="";$(I).focus();if(!arguments.length)if(K)H=0;else{if(I.selectionEnd!==I.selectionStart)return;H=I.selectionEnd}var O;O=Y[H];K||I.setSelectionRange(H,H);J=svgedit.utilities.getElem("text_cursor");if(!J){J=document.createElementNS(k.SVG,"line");svgedit.utilities.assignAttributes(J,{id:"text_cursor",
stroke:"#333","stroke-width":1});J=svgedit.utilities.getElem("selectorParentGroup").appendChild(J)}Z||(Z=setInterval(function(){var aa=J.getAttribute("display")==="none";J.setAttribute("display",aa?"inline":"none")},600));K=F(O.x,da.y);O=F(O.x,da.y+da.height);svgedit.utilities.assignAttributes(J,{x1:K.x,y1:K.y,x2:O.x,y2:O.y,visibility:"visible",display:"inline"});P&&P.setAttribute("d","")}function n(H,K,O){if(H===K)c(K);else{O||I.setSelectionRange(H,K);P=svgedit.utilities.getElem("text_selectblock");
if(!P){P=document.createElementNS(k.SVG,"path");svgedit.utilities.assignAttributes(P,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});svgedit.utilities.getElem("selectorParentGroup").appendChild(P)}H=Y[H];var aa=Y[K];J.setAttribute("visibility","hidden");K=F(H.x,da.y);O=F(H.x+(aa.x-H.x),da.y);var ia=F(H.x,da.y+da.height);H=F(H.x+(aa.x-H.x),da.y+da.height);svgedit.utilities.assignAttributes(P,{d:"M"+K.x+","+K.y+" L"+O.x+","+O.y+" "+H.x+","+H.y+" "+ia.x+","+ia.y+"z",display:"inline"})}}
function g(H,K){var O=B.createSVGPoint();O.x=H;O.y=K;if(Y.length==1)return 0;O=D.getCharNumAtPosition(O);if(O<0){O=Y.length-2;if(H<=Y[0].x)O=0}else if(O>=Y.length-2)O=Y.length-2;var aa=Y[O];H>aa.x+aa.width/2&&O++;return O}function u(H,K,O){var aa=I.selectionStart;H=g(H,K);n(Math.min(aa,H),Math.max(aa,H),!O)}function s(H,K){var O={x:H,y:K};O.x/=h;O.y/=h;if(ga){var aa=svgedit.math.transformPoint(O.x,O.y,ga.inverse());O.x=aa.x;O.y=aa.y}return O}function F(H,K){var O={x:H,y:K};if(ga){var aa=svgedit.math.transformPoint(O.x,
O.y,ga);O.x=aa.x;O.y=aa.y}O.x*=h;O.y*=h;return O}function q(H){n(0,D.textContent.length);$(this).unbind(H)}function C(H){if(M&&D){var K=svgedit.math.transformPoint(H.pageX,H.pageY,kb);K=s(K.x*h,K.y*h);K=g(K.x,K.y);var O=D.textContent,aa=O.substr(0,K).replace(/[a-z0-9]+$/i,"").length;O=O.substr(K).match(/^[a-z0-9]+/i);n(aa,(O?O[0].length:0)+K);$(H.target).click(q);setTimeout(function(){$(H.target).unbind("click",q)},300)}}var D,I,J,P,Z,Y=[],da,ga,ma,U,M;return{select:function(H,K,O){D=H;Na.toEditMode(K,
O)},start:function(H){D=H;Na.toEditMode()},mouseDown:function(H,K,O,aa){H=s(O,aa);I.focus();c(g(H.x,H.y));ma=O;U=aa},mouseMove:function(H,K){var O=s(H,K);u(O.x,O.y)},mouseUp:function(H,K,O){var aa=s(K,O);u(aa.x,aa.y,true);H.target!==D&&K<ma+2&&K>ma-2&&O<U+2&&O>U-2&&Na.toSelectMode(true)},setCursor:c,toEditMode:function(H,K){M=false;xa="textedit";ua.requestSelector(D).showGrips(false);ua.requestSelector(D);Na.init();$(D).css("cursor","text");if(arguments.length){var O=s(H,K);c(g(O.x,O.y))}else c();
setTimeout(function(){M=true},300)},toSelectMode:function(H){xa="select";clearInterval(Z);Z=null;P&&$(P).attr("display","none");J&&$(J).attr("visibility","hidden");$(D).css("cursor","move");if(H){za();$(D).css("cursor","move");la("selected",[D]);nb([D],true)}D&&!D.textContent.length&&z.deleteSelectedElements();$(I).blur();D=false},setInputElem:function(H){I=H},clear:function(){xa=="textedit"&&Na.toSelectMode()},init:function(){if(D){var H,K;if(!D.parentNode){D=A[0];ua.requestSelector(D).showGrips(false)}var O=
D.textContent.length;H=D.getAttribute("transform");da=svgedit.utilities.getBBox(D);ga=H?svgedit.math.getMatrix(D):null;Y=[];Y.length=O;I.focus();$(D).unbind("dblclick",C).dblclick(C);O||(K={x:da.x+da.width/2,width:0});for(H=0;H<O;H++){var aa=D.getStartPositionOfChar(H);K=D.getEndPositionOfChar(H);if(!svgedit.browser.supportsGoodTextCharPos()){var ia=z.contentW*h;aa.x-=ia;K.x-=ia;aa.x/=h;K.x/=h}Y[H]={x:aa.x,y:da.y,width:K.x-aa.x,height:da.height}}Y.push({x:K.x,width:0});n(I.selectionStart,I.selectionEnd,
true)}}}}();qa=z.pathActions=function(){var c=false,n,g,u;svgedit.path.Path.prototype.endChanges=function(q){if(svgedit.browser.isWebkit()){var C=this.elem;C.setAttribute("d",qa.convertPath(C))}q=new svgedit.history.ChangeElementCommand(this.elem,{d:this.last_d},q);pa(q);la("changed",[this.elem])};svgedit.path.Path.prototype.addPtsToSelection=function(q){var C,D;$.isArray(q)||(q=[q]);for(C=0;C<q.length;C++){var I=q[C];D=this.segs[I];D.ptgrip&&this.selected_pts.indexOf(I)==-1&&I>=0&&this.selected_pts.push(I)}this.selected_pts.sort();
C=this.selected_pts.length;q=[];for(q.length=C;C--;){D=this.segs[this.selected_pts[C]];D.select(true);q[C]=D.ptgrip}qa.canDeleteNodes=true;qa.closed_subpath=this.subpathIsClosed(this.selected_pts[0]);la("selected",q)};var s=n=null,F=false;return{mouseDown:function(q,C,D,I){var J;if(xa==="path"){mouse_x=D;mouse_y=I;I=mouse_x/h;C=mouse_y/h;D=svgedit.utilities.getElem("path_stretch_line");g=[I,C];if(e.gridSnapping){I=svgedit.utilities.snapToGrid(I);C=svgedit.utilities.snapToGrid(C);mouse_x=svgedit.utilities.snapToGrid(mouse_x);
mouse_y=svgedit.utilities.snapToGrid(mouse_y)}if(!D){D=document.createElementNS(k.SVG,"path");svgedit.utilities.assignAttributes(D,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5",fill:"none"});D=svgedit.utilities.getElem("selectorParentGroup").appendChild(D)}D.setAttribute("display","inline");var P=null;if(s){P=s.pathSegList;var Z=P.numberOfItems;J=6/h;for(var Y=false;Z;){Z--;var da=P.getItem(Z),ga=da.x;da=da.y;if(I>=ga-J&&I<=ga+J&&C>=da-J&&C<=da+J){Y=true;break}}J=gb();svgedit.path.removePath_(J);
J=svgedit.utilities.getElem(J);ga=P.numberOfItems;if(Y){if(Z<=1&&ga>=2){I=P.getItem(0).x;C=P.getItem(0).y;q=D.pathSegList.getItem(1);q=q.pathSegType===4?s.createSVGPathSegLinetoAbs(I,C):s.createSVGPathSegCurvetoCubicAbs(I,C,q.x1/h,q.y1/h,I,C);I=s.createSVGPathSegClosePath();P.appendItem(q);P.appendItem(I)}else if(ga<3)return P=false;$(D).remove();element=J;s=null;Ba=false;if(c){svgedit.path.path.matrix&&svgedit.coords.remapElement(J,{},svgedit.path.path.matrix.inverse());D=J.getAttribute("d");q=$(svgedit.path.path.elem).attr("d");
$(svgedit.path.path.elem).attr("d",q+D);$(J).remove();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();svgedit.path.path.init();qa.toEditMode(svgedit.path.path.elem);svgedit.path.path.selectPt();return false}}else{if(!$.contains(a,Db(q))){console.log("Clicked outside canvas");return false}P=s.pathSegList.numberOfItems;Z=s.pathSegList.getItem(P-1);J=Z.x;Z=Z.y;if(q.shiftKey){q=svgedit.math.snapToAngle(J,Z,I,C);I=q.x;C=q.y}q=D.pathSegList.getItem(1);q=q.pathSegType===4?s.createSVGPathSegLinetoAbs(qb(I),
qb(C)):s.createSVGPathSegCurvetoCubicAbs(qb(I),qb(C),q.x1/h,q.y1/h,q.x2/h,q.y2/h);s.pathSegList.appendItem(q);I*=h;C*=h;D.setAttribute("d",["M",I,C,I,C].join(" "));D=P;if(c)D+=svgedit.path.path.segs.length;svgedit.path.addPointGrip(D,I,C)}}else{d_attr="M"+I+","+C+" ";s=S({element:"path",curStyles:true,attr:{d:d_attr,id:Ia(),opacity:w.opacity/2}});D.setAttribute("d",["M",mouse_x,mouse_y,mouse_x,mouse_y].join(" "));D=c?svgedit.path.path.segs.length:0;svgedit.path.addPointGrip(D,mouse_x,mouse_y)}}else if(svgedit.path.path){svgedit.path.path.storeD();
J=q.target.id;if(J.substr(0,14)=="pathpointgrip_"){C=svgedit.path.path.cur_pt=parseInt(J.substr(14));svgedit.path.path.dragging=[D,I];P=svgedit.path.path.segs[C];if(q.shiftKey)P.selected?svgedit.path.path.removePtFromSelection(C):svgedit.path.path.addPtsToSelection(C);else{if(svgedit.path.path.selected_pts.length<=1||!P.selected)svgedit.path.path.clearSelection();svgedit.path.path.addPtsToSelection(C)}}else if(J.indexOf("ctrlpointgrip_")==0){svgedit.path.path.dragging=[D,I];q=J.split("_")[1].split("c");
C=Number(q[0]);svgedit.path.path.selectPt(C,Number(q[1]))}if(!svgedit.path.path.dragging){if(Aa==null)Aa=ua.getRubberBandBox();svgedit.utilities.assignAttributes(Aa,{x:D*h,y:I*h,width:0,height:0,display:"inline"},100)}}},mouseMove:function(q,C){F=true;if(xa==="path"){if(s){var D=s.pathSegList,I=D.numberOfItems-1;if(g){var J=svgedit.path.addCtrlGrip("1c1"),P=svgedit.path.addCtrlGrip("0c2");J.setAttribute("cx",q);J.setAttribute("cy",C);J.setAttribute("display","inline");J=g[0];var Z=g[1];D.getItem(I);
var Y=J+(J-q/h),da=Z+(Z-C/h);P.setAttribute("cx",Y*h);P.setAttribute("cy",da*h);P.setAttribute("display","inline");P=svgedit.path.getCtrlLine(1);svgedit.utilities.assignAttributes(P,{x1:q,y1:C,x2:Y*h,y2:da*h,display:"inline"});if(I===0)u=[q,C];else{D=D.getItem(I-1);P=D.x;var ga=D.y;if(D.pathSegType===6){P+=P-D.x2;ga+=ga-D.y2}else if(u){P=u[0]/h;ga=u[1]/h}svgedit.path.replacePathSeg(6,I,[J,Z,P,ga,Y,da],s)}}else if(J=svgedit.utilities.getElem("path_stretch_line")){I=D.getItem(I);if(I.pathSegType===
6)svgedit.path.replacePathSeg(6,1,[q,C,(I.x+(I.x-I.x2))*h,(I.y+(I.y-I.y2))*h,q,C],J);else u?svgedit.path.replacePathSeg(6,1,[q,C,u[0],u[1],q,C],J):svgedit.path.replacePathSeg(4,1,[q,C],J)}}}else if(svgedit.path.path.dragging){J=svgedit.path.getPointFromGrip({x:svgedit.path.path.dragging[0],y:svgedit.path.path.dragging[1]},svgedit.path.path);Z=svgedit.path.getPointFromGrip({x:q,y:C},svgedit.path.path);I=Z.x-J.x;J=Z.y-J.y;svgedit.path.path.dragging=[q,C];svgedit.path.path.dragctrl?svgedit.path.path.moveCtrl(I,
J):svgedit.path.path.movePts(I,J)}else{svgedit.path.path.selected_pts=[];svgedit.path.path.eachSeg(function(){if(this.next||this.prev){var ma=Aa.getBBox(),U=svgedit.path.getGripPt(this);ma=svgedit.math.rectsIntersect(ma,{x:U.x,y:U.y,width:0,height:0});this.select(ma);ma&&svgedit.path.path.selected_pts.push(this.index)}})}},mouseUp:function(q,C){if(xa==="path"){g=null;if(!s){C=svgedit.utilities.getElem(gb());Ba=false;u=null}return{keep:true,element:C}}if(svgedit.path.path.dragging){var D=svgedit.path.path.cur_pt;
svgedit.path.path.dragging=false;svgedit.path.path.dragctrl=false;svgedit.path.path.update();F&&svgedit.path.path.endChanges("Move path point(s)");!q.shiftKey&&!F&&svgedit.path.path.selectPt(D)}else if(Aa&&Aa.getAttribute("display")!="none"){Aa.setAttribute("display","none");Aa.getAttribute("width")<=2&&Aa.getAttribute("height")<=2&&qa.toSelectMode(q.target)}else qa.toSelectMode(q.target);F=false},toEditMode:function(q){svgedit.path.path=svgedit.path.getPath_(q);xa="pathedit";za();svgedit.path.path.show(true).update();
svgedit.path.path.oldbbox=svgedit.utilities.getBBox(svgedit.path.path.elem);c=false},toSelectMode:function(q){var C=q==svgedit.path.path.elem;xa="select";svgedit.path.path.show(false);n=false;za();svgedit.path.path.matrix&&svgedit.path.recalcRotatedPath();if(C){la("selected",[q]);nb([q],true)}},addSubPath:function(q){if(q){xa="path";c=true}else{qa.clear(true);qa.toEditMode(svgedit.path.path.elem)}},select:function(q){if(n===q){qa.toEditMode(q);xa="pathedit"}else n=q},reorient:function(){var q=A[0];
if(q)if(svgedit.utilities.getRotationAngle(q)!=0){var C=new svgedit.history.BatchCommand("Reorient path"),D={d:q.getAttribute("d"),transform:q.getAttribute("transform")};C.addSubCommand(new svgedit.history.ChangeElementCommand(q,D));za();this.resetOrientation(q);pa(C);svgedit.path.getPath_(q).show(false).matrix=null;this.clear();nb([q],true);la("changed",A)}},clear:function(){n=null;if(s){var q=svgedit.utilities.getElem(gb());$(svgedit.utilities.getElem("path_stretch_line")).remove();$(q).remove();
$(svgedit.utilities.getElem("pathpointgrip_container")).find("*").attr("display","none");s=u=null;Ba=false}else xa=="pathedit"&&this.toSelectMode();svgedit.path.path&&svgedit.path.path.init().show(false)},resetOrientation:function(q){if(q==null||q.nodeName!="path")return false;var C=svgedit.transformlist.getTransformList(q),D=svgedit.math.transformListToTransform(C).matrix;C.clear();q.removeAttribute("transform");C=q.pathSegList;var I=C.numberOfItems,J;for(J=0;J<I;++J){var P=C.getItem(J),Z=P.pathSegType;
if(Z!=1){var Y=[];$.each(["",1,2],function(da,ga){var ma=P["x"+ga],U=P["y"+ga];if(ma!==undefined&&U!==undefined){ma=svgedit.math.transformPoint(ma,U,D);Y.splice(Y.length,0,ma.x,ma.y)}});svgedit.path.replacePathSeg(Z,J,Y,q)}}d(q,D)},zoomChange:function(){xa=="pathedit"&&svgedit.path.path.update()},getNodePoint:function(){var q=svgedit.path.path.segs[svgedit.path.path.selected_pts.length?svgedit.path.path.selected_pts[0]:1];return{x:q.item.x,y:q.item.y,type:q.type}},linkControlPoints:function(q){svgedit.path.setLinkControlPoints(q)},
clonePathNode:function(){svgedit.path.path.storeD();for(var q=svgedit.path.path.selected_pts,C=q.length,D=[];C--;){var I=q[C];svgedit.path.path.addSeg(I);D.push(I+C);D.push(I+C+1)}svgedit.path.path.init().addPtsToSelection(D);svgedit.path.path.endChanges("Clone path node(s)")},opencloseSubPath:function(){var q=svgedit.path.path.selected_pts;if(q.length===1){var C=svgedit.path.path.elem,D=C.pathSegList,I=q[0],J=null,P=null;svgedit.path.path.eachSeg(function(ga){if(this.type===2&&ga<=I)P=this.item;
if(ga<=I)return true;if(this.type===2){J=ga;return false}if(this.type===1)return J=false});if(J==null)J=svgedit.path.path.segs.length-1;if(J!==false){var Z=C.createSVGPathSegLinetoAbs(P.x,P.y),Y=C.createSVGPathSegClosePath();if(J==svgedit.path.path.segs.length-1){D.appendItem(Z);D.appendItem(Y)}else{svgedit.path.insertItemBefore(C,Y,J);svgedit.path.insertItemBefore(C,Z,J)}svgedit.path.path.init().selectPt(J+1)}else if(svgedit.path.path.segs[I].mate){D.removeItem(I);D.removeItem(I);svgedit.path.path.init().selectPt(I-
1)}else{for(q=0;q<D.numberOfItems;q++){var da=D.getItem(q);if(da.pathSegType===2)Z=q;else if(q===I)D.removeItem(Z);else if(da.pathSegType===1&&I<q){Y=q-1;D.removeItem(q);break}}for(q=I-Z-1;q--;)svgedit.path.insertItemBefore(C,D.getItem(Z),Y);C=D.getItem(Z);svgedit.path.replacePathSeg(2,Z,[C.x,C.y]);q=I;svgedit.path.path.init().selectPt(0)}}},deletePathNode:function(){if(qa.canDeleteNodes){svgedit.path.path.storeD();for(var q=svgedit.path.path.selected_pts,C=q.length;C--;)svgedit.path.path.deleteSeg(q[C]);
var D=function(){var I=svgedit.path.path.elem.pathSegList,J=I.numberOfItems,P=function(da,ga){for(;ga--;)I.removeItem(da)};if(J<=1)return true;for(;J--;){var Z=I.getItem(J);if(Z.pathSegType===1){Z=I.getItem(J-1);var Y=I.getItem(J-2);if(Z.pathSegType===2){P(J-1,2);D();break}else if(Y.pathSegType===2){P(J-2,3);D();break}}else if(Z.pathSegType===2)if(J>0){Z=I.getItem(J-1).pathSegType;if(Z===2){P(J-1,1);D();break}else if(Z===1&&I.numberOfItems-1===J){P(J,1);D();break}}}return false};D();if(svgedit.path.path.elem.pathSegList.numberOfItems<=
1){qa.toSelectMode(svgedit.path.path.elem);z.deleteSelectedElements()}else{svgedit.path.path.init();svgedit.path.path.clearSelection();if(window.opera){q=$(svgedit.path.path.elem);q.attr("d",q.attr("d"))}svgedit.path.path.endChanges("Delete path node(s)")}}},smoothPolylineIntoPath:function(q){var C=q.points,D=C.numberOfItems;if(D>=4){var I=C.getItem(0),J=null,P=[];P.push(["M",I.x,",",I.y," C"].join(""));for(q=1;q<=D-4;q+=3){var Z=C.getItem(q),Y=C.getItem(q+1),da=C.getItem(q+2);if(J)if((I=svgedit.path.smoothControlPoints(J,
Z,I))&&I.length==2){Z=P[P.length-1].split(",");Z[2]=I[0].x;Z[3]=I[0].y;P[P.length-1]=Z.join(",");Z=I[1]}P.push([Z.x,Z.y,Y.x,Y.y,da.x,da.y].join(","));I=da;J=Y}for(P.push("L");q<D;){Y=C.getItem(q);P.push([Y.x,Y.y].join(","));q++}P=P.join(" ");q=S({element:"path",curStyles:true,attr:{id:gb(),d:P,fill:"none"}})}return q},setSegType:function(q){svgedit.path.path.setSegType(q)},moveNode:function(q,C){var D=svgedit.path.path.selected_pts;if(D.length){svgedit.path.path.storeD();D=svgedit.path.path.segs[D[0]];
var I={x:0,y:0};I[q]=C-D.item[q];D.move(I.x,I.y);svgedit.path.path.endChanges("Move path point")}},fixEnd:function(q){var C=q.pathSegList,D=C.numberOfItems,I,J;for(I=0;I<D;++I){var P=C.getItem(I);if(P.pathSegType===2)J=P;if(P.pathSegType===1){P=C.getItem(I-1);if(P.x!=J.x||P.y!=J.y){C=q.createSVGPathSegLinetoAbs(J.x,J.y);svgedit.path.insertItemBefore(q,C,I);qa.fixEnd(q);break}}}svgedit.browser.isWebkit()&&q.setAttribute("d",qa.convertPath(q))},convertPath:svgedit.utilities.convertPath}}();var Qb=this.removeUnusedDefElems=
function(){var c=f.getElementsByTagNameNS(k.SVG,"defs");if(!c||!c.length)return 0;var n=[],g=0,u=["fill","stroke","filter","marker-start","marker-mid","marker-end"],s=u.length,F=f.getElementsByTagNameNS(k.SVG,"*"),q=F.length,C,D;for(C=0;C<q;C++){var I=F[C];for(D=0;D<s;D++){var J=svgedit.utilities.getUrlFromAttr(I.getAttribute(u[D]));J&&n.push(J.substr(1))}(D=Ta(I))&&D.indexOf("#")===0&&n.push(D.substr(1))}c=$(c).find("linearGradient, radialGradient, filter, marker, svg, symbol");for(C=c.length;C--;){u=
c[C];s=u.id;if(n.indexOf(s)<0){Tb[s]=u;u.parentNode.removeChild(u);g++}}return g};this.svgCanvasToString=function(){for(;Qb()>0;);qa.clear(true);$.each(f.childNodes,function(g,u){g&&u.nodeType===8&&u.data.indexOf("Created with")>=0&&f.insertBefore(u,f.firstChild)});if(o){sb();cb([o])}var c=[];$(f).find("g:data(gsvg)").each(function(){var g=this.attributes,u=g.length,s;for(s=0;s<u;s++)if(g[s].nodeName=="id"||g[s].nodeName=="style")u--;if(u<=0){g=this.firstChild;c.push(g);$(this).replaceWith(g)}});
var n=this.svgToString(f,0);c.length&&$(c).each(function(){Nb(this)});return n};this.svgToString=function(c,n){var g=[],u=svgedit.utilities.toXml,s=e.baseUnit,F=RegExp("^-?[\\d\\.]+"+s+"$");if(c){Ib(c);var q=c.attributes,C,D,I=c.childNodes;for(D=0;D<n;D++)g.push(" ");g.push("<");g.push(c.nodeName);if(c.id==="svgcontent"){D=tb();if(s!=="px"){D.w=svgedit.units.convertUnit(D.w,s)+s;D.h=svgedit.units.convertUnit(D.h,s)+s}g.push(' width="'+D.w+'" height="'+D.h+'" xmlns="'+k.SVG+'"');var J={};$(c).find("*").andSelf().each(function(){var da=
this.namespaceURI;if(da&&!J[da]&&eb[da]&&eb[da]!=="xmlns"&&eb[da]!=="xml"){J[da]=true;g.push(" xmlns:"+eb[da]+'="'+da+'"')}$.each(this.attributes,function(ga,ma){var U=ma.namespaceURI;if(U&&!J[U]&&eb[U]!=="xmlns"&&eb[U]!=="xml"){J[U]=true;g.push(" xmlns:"+eb[U]+'="'+U+'"')}})});D=q.length;for(s=["width","height","xmlns","x","y","viewBox","id","overflow"];D--;){C=q.item(D);var P=u(C.value);if(C.nodeName.indexOf("xmlns:")!==0)if(P!=""&&s.indexOf(C.localName)==-1)if(!C.namespaceURI||eb[C.namespaceURI]){g.push(" ");
g.push(C.nodeName);g.push('="');g.push(P);g.push('"')}}}else{if(c.nodeName==="defs"&&!c.firstChild)return;var Z=["-moz-math-font-style","_moz-math-font-style"];for(D=q.length-1;D>=0;D--){C=q.item(D);P=u(C.value);if(!(Z.indexOf(C.localName)>=0))if(P!="")if(P.indexOf("pointer-events")!==0)if(!(C.localName==="class"&&P.indexOf("se_")===0)){g.push(" ");if(C.localName==="d")P=qa.convertPath(c,true);if(isNaN(P)){if(F.test(P))P=svgedit.units.shortFloat(P)+s}else P=svgedit.units.shortFloat(P);if(hb.apply&&
c.nodeName==="image"&&C.localName==="href"&&hb.images&&hb.images==="embed"){var Y=oa[P];if(Y)P=Y}if(!C.namespaceURI||C.namespaceURI==k.SVG||eb[C.namespaceURI]){g.push(C.nodeName);g.push('="');g.push(P);g.push('"')}}}}if(c.hasChildNodes()){g.push(">");n++;q=false;for(D=0;D<I.length;D++){s=I.item(D);switch(s.nodeType){case 1:g.push("\n");g.push(this.svgToString(I.item(D),n));break;case 3:s=s.nodeValue.replace(/^\s+|\s+$/g,"");if(s!=""){q=true;g.push(String(u(s)))}break;case 4:g.push("\n");g.push(Array(n+
1).join(" "));g.push("<![CDATA[");g.push(s.nodeValue);g.push("]]\>");break;case 8:g.push("\n");g.push(Array(n+1).join(" "));g.push("<!--");g.push(s.data);g.push("--\>")}}n--;if(!q){g.push("\n");for(D=0;D<n;D++)g.push(" ")}g.push("</");g.push(c.nodeName);g.push(">")}else g.push("/>")}return g.join("")};this.embedImage=function(c,n){$(new Image).load(function(){var g=document.createElement("canvas");g.width=this.width;g.height=this.height;g.getContext("2d").drawImage(this,0,0);try{var u=";svgedit_url="+
encodeURIComponent(c);u=g.toDataURL().replace(";base64",u+";base64");oa[c]=u}catch(s){oa[c]=false}Ua=c;n&&n(oa[c])}).attr("src",c)};this.setGoodImage=function(c){Ua=c};this.open=function(){};this.save=function(c){za();c&&$.extend(hb,c);hb.apply=true;c=this.svgCanvasToString();la("saved",c)};this.rasterExport=function(c,n,g){var u="image/"+c.toLowerCase(),s=b(),F=this.svgCanvasToString();svgedit.utilities.buildCanvgCallback(function(){var q=c||"PNG";$("#export_canvas").length||$("<canvas>",{id:"export_canvas"}).hide().appendTo("body");
var C=$("#export_canvas")[0];C.width=svgCanvas.contentW;C.height=svgCanvas.contentH;canvg(C,F,{renderCallback:function(){var D=(q==="ICO"?"BMP":q).toLowerCase();D=n?C.toDataURL("image/"+D,n):C.toDataURL("image/"+D);la("exported",{datauri:D,svg:F,issues:s,type:c,mimeType:u,quality:n,exportWindowName:g})}})})()};this.exportPDF=function(c,n){var g=this;svgedit.utilities.buildJSPDFCallback(function(){var u=tb();u=jsPDF({orientation:u.w>u.h?"landscape":"portrait",unit:"pt",format:[u.w,u.h]});var s=hc();
u.setProperties({title:s});s=b();var F=g.svgCanvasToString();u.addSVG(F,0,0);s={svg:F,issues:s,exportWindowName:c};F=n||"dataurlstring";s[F]=u.output(F);la("exportedPDF",s)})()};this.getSvgString=function(){hb.apply=false;return this.svgCanvasToString()};this.randomizeIds=function(c){arguments.length>0&&c==false?svgedit.draw.randomizeIds(false,i()):svgedit.draw.randomizeIds(true,i())};var Gb=this.uniquifyElems=function(c){var n={},g=["filter","linearGradient","pattern","radialGradient","symbol","textPath",
"use"];svgedit.utilities.walkTree(c,function(C){if(C.nodeType==1){if(C.id){C.id in n||(n[C.id]={elem:null,attrs:[],hrefs:[]});n[C.id].elem=C}$.each(Ab,function(I,J){var P=C.getAttributeNode(J);if(P){var Z=svgedit.utilities.getUrlFromAttr(P.value);if(Z=Z?Z.substr(1):null){Z in n||(n[Z]={elem:null,attrs:[],hrefs:[]});n[Z].attrs.push(P)}}});var D=svgedit.utilities.getHref(C);if(D&&g.indexOf(C.nodeName)>=0)if(D=D.substr(1)){D in n||(n[D]={elem:null,attrs:[],hrefs:[]});n[D].hrefs.push(C)}}});for(var u in n)if(u){var s=
n[u].elem;if(s){c=Ia();s.id=c;s=n[u].attrs;for(var F=s.length;F--;){var q=s[F];q.ownerElement.setAttribute(q.name,"url(#"+c+")")}s=n[u].hrefs;for(F=s.length;F--;)svgedit.utilities.setHref(s[F],"#"+c)}}},Mb=this.setUseData=function(c){var n=$(c);if(c.tagName!=="use")n=n.find("use");n.each(function(){var g=Ta(this).substr(1);if(g=svgedit.utilities.getElem(g)){$(this).data("ref",g);if(g.tagName=="symbol"||g.tagName=="svg")$(this).data("symbol",g).data("ref",g)}})},Hb=this.convertGradients=function(c){var n=
$(c).find("linearGradient, radialGradient");if(!n.length&&svgedit.browser.isWebkit())n=$(c).find("*").filter(function(){return this.tagName.indexOf("Gradient")>=0});n.each(function(){if($(this).attr("gradientUnits")==="userSpaceOnUse"){var g=$(f).find('[fill="url(#'+this.id+')"],[stroke="url(#'+this.id+')"]');if(g.length)if(g=svgedit.utilities.getBBox(g[0]))if(this.tagName==="linearGradient"){var u=$(this).attr(["x1","y1","x2","y2"]),s=this.gradientTransform.baseVal;if(s&&s.numberOfItems>0){var F=
svgedit.math.transformListToTransform(s).matrix;s=svgedit.math.transformPoint(u.x1,u.y1,F);F=svgedit.math.transformPoint(u.x2,u.y2,F);u.x1=s.x;u.y1=s.y;u.x2=F.x;u.y2=F.y;this.removeAttribute("gradientTransform")}$(this).attr({x1:(u.x1-g.x)/g.width,y1:(u.y1-g.y)/g.height,x2:(u.x2-g.x)/g.width,y2:(u.y2-g.y)/g.height});this.removeAttribute("gradientUnits")}}})},Yb=this.convertToGroup=function(c){c||(c=A[0]);var n=$(c),g=new svgedit.history.BatchCommand,u;if(n.data("gsvg")){g=$(c.firstChild).attr(["x",
"y"]);$(c.firstChild.firstChild).unwrap();$(c).removeData("gsvg");u=svgedit.transformlist.getTransformList(c);var s=B.createSVGTransform();s.setTranslate(g.x,g.y);u.appendItem(s);svgedit.recalculate.recalculateDimensions(c);la("selected",[c])}else if(n.data("symbol")){c=n.data("symbol");u=n.attr("transform");s=n.attr(["x","y"]);var F=c.getAttribute("viewBox");if(F){F=F.split(" ");s.x-=+F[0];s.y-=+F[1]}u+=" translate("+(s.x||0)+","+(s.y||0)+")";s=n.prev();g.addSubCommand(new svgedit.history.RemoveElementCommand(n[0],
n[0].nextSibling,n[0].parentNode));n.remove();F=$(f).find("use:data(symbol)").length;n=N.createElementNS(k.SVG,"g");var q=c.childNodes,C;for(C=0;C<q.length;C++)n.appendChild(q[C].cloneNode(true));if(svgedit.browser.isGecko()){q=$(svgedit.utilities.findDefs()).children("linearGradient,radialGradient,pattern").clone();$(n).append(q)}u&&n.setAttribute("transform",u);u=c.parentNode;Gb(n);svgedit.browser.isGecko()&&$(ya()).append($(n).find("linearGradient,radialGradient,pattern"));n.id=Ia();s.after(n);
if(u){if(!F){s=c.nextSibling;u.removeChild(c);g.addSubCommand(new svgedit.history.RemoveElementCommand(c,s,u))}g.addSubCommand(new svgedit.history.InsertElementCommand(n))}Mb(n);svgedit.browser.isGecko()?Hb(svgedit.utilities.findDefs()):Hb(n);svgedit.utilities.walkTreePost(n,function(D){try{svgedit.recalculate.recalculateDimensions(D)}catch(I){console.log(I)}});$(n).find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=
Ia()});cb([n]);(c=rb(n,true))&&g.addSubCommand(c);pa(g)}else console.log("Unexpected element to ungroup:",c)};this.setSvgString=function(c){try{var n=svgedit.utilities.text2xml(c);this.prepareSvg(n);var g=new svgedit.history.BatchCommand("Change Source"),u=f.nextSibling,s=B.removeChild(f);g.addSubCommand(new svgedit.history.RemoveElementCommand(s,u,B));f=N.adoptNode?N.adoptNode(n.documentElement):N.importNode(n.documentElement,true);B.appendChild(f);var F=$(f);z.current_drawing_=new svgedit.draw.Drawing(f,
m);var q=i().getNonce();q?la("setnonce",q):la("unsetnonce");F.find("image").each(function(){var Y=this;svgedit.utilities.preventClickDefault(Y);var da=Ta(this);if(da){if(da.indexOf("data:")===0){var ga=da.match(/svgedit_url=(.*?);/);if(ga){var ma=decodeURIComponent(ga[1]);$(new Image).load(function(){Y.setAttributeNS(k.XLINK,"xlink:href",ma)}).attr("src",ma)}}z.embedImage(da)}});F.find("svg").each(function(){if(!$(this).closest("defs").length){Gb(this);var Y=this.parentNode;if(Y.childNodes.length===
1&&Y.nodeName==="g"){$(Y).data("gsvg",this);Y.id=Y.id||Ia()}else Nb(this)}});svgedit.browser.isGecko()&&F.find("linearGradient, radialGradient, pattern").appendTo(svgedit.utilities.findDefs());Mb(F);Hb(F[0]);var C={id:"svgcontent",overflow:e.show_outside_canvas?"visible":"hidden"},D=false;if(F.attr("viewBox")){var I=F.attr("viewBox").split(" ");C.width=I[2];C.height=I[3]}else $.each(["width","height"],function(Y,da){var ga=F.attr(da);ga||(ga="100%");if(String(ga).substr(-1)==="%")D=true;else C[da]=
svgedit.units.convertToNum(da,ga)});Zb();F.children().find("a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use").each(function(){if(!this.id)this.id=Ia()});if(D){var J=fb();C.width=J.width+J.x;C.height=J.height+J.y}if(C.width<=0)C.width=100;if(C.height<=0)C.height=100;F.attr(C);this.contentW=C.width;this.contentH=C.height;g.addSubCommand(new svgedit.history.InsertElementCommand(f));var P=F.attr(["width","height"]);g.addSubCommand(new svgedit.history.ChangeElementCommand(B,
P));h=1;svgedit.transformlist.resetListMap();za();svgedit.path.clearData();B.appendChild(ua.selectorParentGroup);pa(g);la("changed",[f])}catch(Z){console.log(Z);return false}return true};this.importSvgString=function(c){var n,g;try{var u=svgedit.utilities.encode64(c.length+c).substr(0,32),s=false;if(xb[u])if($(xb[u].symbol).parents("#svgroot").length)s=true;var F=new svgedit.history.BatchCommand("Import Image"),q;if(s){q=xb[u].symbol;g=xb[u].xform}else{var C=svgedit.utilities.text2xml(c);this.prepareSvg(C);
var D;D=N.adoptNode?N.adoptNode(C.documentElement):N.importNode(C.documentElement,true);Gb(D);var I=svgedit.units.convertToNum("width",D.getAttribute("width")),J=svgedit.units.convertToNum("height",D.getAttribute("height")),P=D.getAttribute("viewBox"),Z=P?P.split(" "):[0,0,I,J];for(n=0;n<4;++n)Z[n]=+Z[n];f.getAttribute("width");var Y=+f.getAttribute("height");g=J>I?"scale("+Y/3/Z[3]+")":"scale("+Y/3/Z[2]+")";g="translate(0) "+g+" translate(0)";q=N.createElementNS(k.SVG,"symbol");var da=svgedit.utilities.findDefs();
for(svgedit.browser.isGecko()&&$(D).find("linearGradient, radialGradient, pattern").appendTo(da);D.firstChild;)q.appendChild(D.firstChild);var ga=D.attributes,ma;for(ma=0;ma<ga.length;ma++){var U=ga[ma];q.setAttribute(U.nodeName,U.value)}q.id=Ia();xb[u]={symbol:q,xform:g};svgedit.utilities.findDefs().appendChild(q);F.addSubCommand(new svgedit.history.InsertElementCommand(q))}var M=N.createElementNS(k.SVG,"use");M.id=Ia();Xa(M,"#"+q.id);(o||i().getCurrentLayer()).appendChild(M);F.addSubCommand(new svgedit.history.InsertElementCommand(M));
za();M.setAttribute("transform",g);svgedit.recalculate.recalculateDimensions(M);$(M).data("symbol",q).data("ref",q);nb([M]);pa(F);la("changed",[f])}catch(H){console.log(H);return null}return M};var Zb=z.identifyLayers=function(){sb();i().identifyLayers()};this.createLayer=function(c,n){var g=i().createLayer(c,l(n));za();la("changed",[g])};this.cloneLayer=function(c,n){var g=i().cloneLayer(c,l(n));za();sb();la("changed",[g])};this.deleteCurrentLayer=function(){var c=i().getCurrentLayer(),n=c.nextSibling,
g=c.parentNode;if(c=i().deleteCurrentLayer()){var u=new svgedit.history.BatchCommand("Delete Layer");u.addSubCommand(new svgedit.history.RemoveElementCommand(c,n,g));pa(u);za();la("changed",[g]);return true}return false};this.setCurrentLayer=function(c){(c=i().setCurrentLayer(svgedit.utilities.toXml(c)))&&za();return c};this.renameCurrentLayer=function(c){var n=i(),g=n.getCurrentLayer();if(g)if(n.setCurrentLayerName(c,l())){la("changed",[g]);return true}return false};this.setCurrentLayerPosition=
function(c){if(c=i().setCurrentLayerPosition(c)){pa(new svgedit.history.MoveElementCommand(c.currentGroup,c.oldNextSibling,f));return true}return false};this.setLayerVisibility=function(c,n){var g=i(),u=g.getLayerVisibility(c),s=g.setLayerVisibility(c,n);if(s)pa(new svgedit.history.ChangeElementCommand(s,{display:u?"inline":"none"},"Layer Visibility"));else return false;if(s==g.getCurrentLayer()){za();qa.clear()}return true};this.moveSelectedToLayer=function(c){var n=i().getLayerByName(c);if(!n)return false;
var g=new svgedit.history.BatchCommand("Move Elements to Layer"),u=A;for(c=u.length;c--;){var s=u[c];if(s){var F=s.nextSibling,q=s.parentNode;n.appendChild(s);g.addSubCommand(new svgedit.history.MoveElementCommand(s,F,q))}}pa(g);return true};this.mergeLayer=function(c){i().mergeLayer(l(c));za();sb();la("changed",[f])};this.mergeAllLayers=function(c){i().mergeAllLayers(l(c));za();sb();la("changed",[f])};var sb=this.leaveContext=function(){var c,n=mb.length;if(n){for(c=0;c<n;c++){var g=mb[c],u=wb(g,
"orig_opac");u!==1?g.setAttribute("opacity",u):g.removeAttribute("opacity");g.setAttribute("style","pointer-events: inherit")}mb=[];za(true);la("contextset",null)}o=null},gc=this.setContext=function(c){sb();if(typeof c==="string")c=svgedit.utilities.getElem(c);o=c;$(c).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var n=this.getAttribute("opacity")||1;wb(this,"orig_opac",n);this.setAttribute("opacity",n*0.33);this.setAttribute("style","pointer-events: none");mb.push(this)});za();
la("contextset",o)};this.clear=function(){qa.clear();za();z.clearSvgContentElement();z.current_drawing_=new svgedit.draw.Drawing(f);z.createLayer("Layer 1");z.undoMgr.resetUndoStack();ua.initGroup();Aa=ua.getRubberBandBox();la("cleared")};this.linkControlPoints=qa.linkControlPoints;this.getContentElem=function(){return f};this.getRootElem=function(){return B};this.getSelectedElems=function(){return A};var tb=this.getResolution=function(){var c=f.getAttribute("width")/h,n=f.getAttribute("height")/
h;return{w:c,h:n,zoom:h}};this.getZoom=function(){return h};this.getSnapToGrid=function(){return e.gridSnapping};this.getVersion=function(){return"svgcanvas.js ($Rev$)"};this.setUiStrings=function(c){$.extend(ub,c.notification)};this.setConfig=function(c){$.extend(e,c)};this.getTitle=function(c){if(c=c||A[0]){c=$(c).data("gsvg")||$(c).data("symbol")||c;var n=c.childNodes;for(c=0;c<n.length;c++)if(n[c].nodeName=="title")return n[c].textContent;return""}};this.setGroupTitle=function(c){var n=A[0];n=
$(n).data("gsvg")||n;var g=$(n).children("title"),u=new svgedit.history.BatchCommand("Set Label");if(c.length)if(g.length){g=g[0];u.addSubCommand(new svgedit.history.ChangeElementCommand(g,{"#text":g.textContent}));g.textContent=c}else{g=N.createElementNS(k.SVG,"title");g.textContent=c;$(n).prepend(g);u.addSubCommand(new svgedit.history.InsertElementCommand(g))}else{u.addSubCommand(new svgedit.history.RemoveElementCommand(g[0],g.nextSibling,n));g.remove()}pa(u)};var hc=this.getDocumentTitle=function(){return z.getTitle(f)};
this.setDocumentTitle=function(c){var n,g=f.childNodes,u=false,s="",F=new svgedit.history.BatchCommand("Change Image Title");for(n=0;n<g.length;n++)if(g[n].nodeName=="title"){u=g[n];s=u.textContent;break}if(!u){u=N.createElementNS(k.SVG,"title");f.insertBefore(u,f.firstChild)}if(c.length)u.textContent=c;else u.parentNode.removeChild(u);F.addSubCommand(new svgedit.history.ChangeElementCommand(u,{"#text":s}));pa(F)};this.getEditorNS=function(c){c&&f.setAttribute("xmlns:se",k.SE);return k.SE};this.setResolution=
function(c,n){var g=tb(),u=g.w;g=g.h;var s;if(c=="fit"){var F=fb();if(F){s=new svgedit.history.BatchCommand("Fit Canvas to Content");var q=yb();nb(q);var C=[],D=[];$.each(q,function(){C.push(F.x*-1);D.push(F.y*-1)});q=z.moveSelectedElements(C,D,true);s.addSubCommand(q);za();c=Math.round(F.width);n=Math.round(F.height)}else return false}if(c!=u||n!=g){s||(s=new svgedit.history.BatchCommand("Change Image Dimensions"));c=svgedit.units.convertToNum("width",c);n=svgedit.units.convertToNum("height",n);
f.setAttribute("width",c);f.setAttribute("height",n);this.contentW=c;this.contentH=n;s.addSubCommand(new svgedit.history.ChangeElementCommand(f,{width:u,height:g}));f.setAttribute("viewBox",[0,0,c/h,n/h].join(" "));s.addSubCommand(new svgedit.history.ChangeElementCommand(f,{viewBox:["0 0",u,g].join(" ")}));pa(s);la("changed",[f])}return true};this.getOffset=function(){return $(f).attr(["x","y"])};this.setBBoxZoom=function(c,n,g){var u=0.85,s=function(F){if(!F)return false;var q=Math.min(Math.round(n/
F.width*100*u)/100,Math.round(g/F.height*100*u)/100);z.setZoom(q);return{zoom:q,bbox:F}};if(typeof c=="object"){c=c;if(c.width==0||c.height==0){z.setZoom(c.zoom?c.zoom:h*c.factor);return{zoom:h,bbox:c}}return s(c)}switch(c){case "selection":if(!A[0])return;c=$.map(A,function(F){if(F)return F});c=fb(c);break;case "canvas":c=tb();u=0.95;c={width:c.w,height:c.h,x:0,y:0};break;case "content":c=fb();break;case "layer":c=fb(yb(i().getCurrentLayer()));break;default:return}return s(c)};this.setZoom=function(c){var n=
tb();f.setAttribute("viewBox","0 0 "+n.w/c+" "+n.h/c);h=c;$.each(A,function(g,u){u&&ua.requestSelector(u).resize()});qa.zoomChange();Ya("zoomChanged",c)};this.getMode=function(){return xa};this.setMode=function(c){qa.clear(true);Na.clear();Va=A[0]&&A[0].nodeName=="text"?Ca:w;xa=c};this.getColor=function(c){return Va[c]};this.setColor=function(c,n,g){function u(C){C.nodeName!="g"&&s.push(C)}w[c]=n;Va[c+"_paint"]={type:"solidColor"};for(var s=[],F=A.length;F--;){var q=A[F];if(q)if(q.tagName=="g")svgedit.utilities.walkTree(q,
u);else if(c=="fill")q.tagName!="polyline"&&q.tagName!="line"&&s.push(q);else s.push(q)}if(s.length>0)if(g)zb(c,n,s);else{Wa(c,n,s);la("changed",s)}};var ac=this.setGradient=function(c){if(!(!Va[c+"_paint"]||Va[c+"_paint"].type=="solidColor")){var n=z[c+"Grad"],g=$b(n),u=svgedit.utilities.findDefs();if(g)n=g;else{n=u.appendChild(N.importNode(n,true));n.id=Ia()}z.setColor(c,"url(#"+n.id+")")}},$b=function(c){var n=svgedit.utilities.findDefs();n=$(n).find("linearGradient, radialGradient");for(var g=
n.length,u=["r","cx","cy","fx","fy"];g--;){var s=n[g];if(c.tagName=="linearGradient"){if(c.getAttribute("x1")!=s.getAttribute("x1")||c.getAttribute("y1")!=s.getAttribute("y1")||c.getAttribute("x2")!=s.getAttribute("x2")||c.getAttribute("y2")!=s.getAttribute("y2"))continue}else{var F=$(c).attr(u),q=$(s).attr(u),C=false;$.each(u,function(Y,da){if(F[da]!=q[da])C=true});if(C)continue}var D=c.getElementsByTagNameNS(k.SVG,"stop"),I=s.getElementsByTagNameNS(k.SVG,"stop");if(D.length==I.length){for(var J=
D.length;J--;){var P=D[J],Z=I[J];if(P.getAttribute("offset")!=Z.getAttribute("offset")||P.getAttribute("stop-opacity")!=Z.getAttribute("stop-opacity")||P.getAttribute("stop-color")!=Z.getAttribute("stop-color"))break}if(J==-1)return s}}return null};this.setPaint=function(c,n){var g=new $.jGraduate.Paint(n);this.setPaintOpacity(c,g.alpha/100,true);Va[c+"_paint"]=g;switch(g.type){case "solidColor":this.setColor(c,g.solidColor!="none"?"#"+g.solidColor:"none");break;case "linearGradient":case "radialGradient":z[c+
"Grad"]=g[g.type];ac(c)}};this.setStrokePaint=function(c){this.setPaint("stroke",c)};this.setFillPaint=function(c){this.setPaint("fill",c)};this.getStrokeWidth=function(){return Va.stroke_width};this.setStrokeWidth=function(c){function n(F){F.nodeName!="g"&&g.push(F)}if(c==0&&["line","path"].indexOf(xa)>=0)z.setStrokeWidth(1);else{Va.stroke_width=c;for(var g=[],u=A.length;u--;){var s=A[u];if(s)s.tagName=="g"?svgedit.utilities.walkTree(s,n):g.push(s)}if(g.length>0){Wa("stroke-width",c,g);la("changed",
A)}}};this.setStrokeAttr=function(c,n){w[c.replace("-","_")]=n;for(var g=[],u=A.length;u--;){var s=A[u];if(s)s.tagName=="g"?svgedit.utilities.walkTree(s,function(F){F.nodeName!="g"&&g.push(F)}):g.push(s)}if(g.length>0){Wa(c,n,g);la("changed",A)}};this.getStyle=function(){return w};this.getOpacity=function(){return w.opacity};this.setOpacity=function(c){w.opacity=c;Wa("opacity",c)};this.getFillOpacity=function(){return w.fill_opacity};this.getStrokeOpacity=function(){return w.stroke_opacity};this.setPaintOpacity=
function(c,n,g){w[c+"_opacity"]=n;g?zb(c+"-opacity",n):Wa(c+"-opacity",n)};this.getPaintOpacity=function(c){return c==="fill"?this.getFillOpacity():this.getStrokeOpacity()};this.getBlur=function(c){var n=0;if(c)if(c.getAttribute("filter"))if(c=svgedit.utilities.getElem(c.id+"_blur"))n=c.firstChild.getAttribute("stdDeviation");return n};(function(){function c(){var s=z.undoMgr.finishUndoableChange();n.addSubCommand(s);pa(n);g=n=null}var n=null,g=null,u=false;z.setBlurNoUndo=function(s){if(g)if(s===
0){zb("filter","");u=true}else{var F=A[0];u&&zb("filter","url(#"+F.id+"_blur)");if(svgedit.browser.isWebkit()){console.log("e",F);F.removeAttribute("filter");F.setAttribute("filter","url(#"+F.id+"_blur)")}zb("stdDeviation",s,[g.firstChild]);z.setBlurOffsets(g,s)}else z.setBlur(s)};z.setBlurOffsets=function(s,F){if(F>3)svgedit.utilities.assignAttributes(s,{x:"-50%",y:"-50%",width:"200%",height:"200%"},100);else if(!svgedit.browser.isWebkit()){s.removeAttribute("x");s.removeAttribute("y");s.removeAttribute("width");
s.removeAttribute("height")}};z.setBlur=function(s,F){if(n)c();else{var q=A[0],C=q.id;g=svgedit.utilities.getElem(C+"_blur");s-=0;var D=new svgedit.history.BatchCommand;if(g){if(s===0)g=null}else{var I=S({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:s}});g=S({element:"filter",attr:{id:C+"_blur"}});g.appendChild(I);svgedit.utilities.findDefs().appendChild(g);D.addSubCommand(new svgedit.history.InsertElementCommand(g))}I={filter:q.getAttribute("filter")};if(s===0){q.removeAttribute("filter");
D.addSubCommand(new svgedit.history.ChangeElementCommand(q,I))}else{Wa("filter","url(#"+C+"_blur)");D.addSubCommand(new svgedit.history.ChangeElementCommand(q,I));z.setBlurOffsets(g,s);n=D;z.undoMgr.beginUndoableChange("stdDeviation",[g?g.firstChild:null]);if(F){z.setBlurNoUndo(s);c()}}}}})();this.getBold=function(){var c=A[0];if(c!=null&&c.tagName=="text"&&A[1]==null)return c.getAttribute("font-weight")=="bold";return false};this.setBold=function(c){var n=A[0];if(n!=null&&n.tagName=="text"&&A[1]==
null)Wa("font-weight",c?"bold":"normal");A[0].textContent||Na.setCursor()};this.getItalic=function(){var c=A[0];if(c!=null&&c.tagName=="text"&&A[1]==null)return c.getAttribute("font-style")=="italic";return false};this.setItalic=function(c){var n=A[0];if(n!=null&&n.tagName=="text"&&A[1]==null)Wa("font-style",c?"italic":"normal");A[0].textContent||Na.setCursor()};this.getFontFamily=function(){return Ca.font_family};this.setFontFamily=function(c){Ca.font_family=c;Wa("font-family",c);A[0]&&!A[0].textContent&&
Na.setCursor()};this.setFontColor=function(c){Ca.fill=c;Wa("fill",c)};this.getFontColor=function(){return Ca.fill};this.getFontSize=function(){return Ca.font_size};this.setFontSize=function(c){Ca.font_size=c;Wa("font-size",c);A[0].textContent||Na.setCursor()};this.getText=function(){var c=A[0];if(c==null)return"";return c.textContent};this.setTextContent=function(c){Wa("#text",c);Na.init(c);Na.setCursor()};this.setImageURL=function(c){var n=A[0];if(n){var g=$(n).attr(["width","height"]);g=!g.width||
!g.height;var u=Ta(n);if(u!==c)g=true;else if(!g)return;var s=new svgedit.history.BatchCommand("Change Image URL");Xa(n,c);s.addSubCommand(new svgedit.history.ChangeElementCommand(n,{"#href":u}));g?$(new Image).load(function(){var F=$(n).attr(["width","height"]);$(n).attr({width:this.width,height:this.height});ua.requestSelector(n).resize();s.addSubCommand(new svgedit.history.ChangeElementCommand(n,F));pa(s);la("changed",[n])}).attr("src",c):pa(s)}};this.setLinkURL=function(c){var n=A[0];if(n){if(n.tagName!==
"a"){n=$(n).parents("a");if(n.length)n=n[0];else return}var g=Ta(n);if(g!==c){var u=new svgedit.history.BatchCommand("Change Link URL");Xa(n,c);u.addSubCommand(new svgedit.history.ChangeElementCommand(n,{"#href":g}));pa(u)}}};this.setRectRadius=function(c){var n=A[0];if(n!=null&&n.tagName=="rect"){var g=n.getAttribute("rx");if(g!=c){n.setAttribute("rx",c);n.setAttribute("ry",c);pa(new svgedit.history.ChangeElementCommand(n,{rx:g,ry:g},"Radius"));la("changed",[n])}}};this.makeHyperlink=function(c){z.groupSelectedElements("a",
c)};this.removeHyperlink=function(){z.ungroupSelectedElement()};this.setSegType=function(c){qa.setSegType(c)};this.convertToPath=function(c,n){if(c==null)$.each(A,function(g,u){u&&z.convertToPath(u)});else return n?svgedit.utilities.getBBoxOfElementAsPath(c,S,qa):svgedit.utilities.convertToPath(c,{fill:w.fill,"fill-opacity":w.fill_opacity,stroke:w.stroke,"stroke-width":w.stroke_width,"stroke-dasharray":w.stroke_dasharray,"stroke-linejoin":w.stroke_linejoin,"stroke-linecap":w.stroke_linecap,"stroke-opacity":w.stroke_opacity,
opacity:w.opacity,visibility:"hidden"},S,qa,za,nb,svgedit.history,pa)};var zb=function(c,n,g){xa=="pathedit"&&qa.moveNode(c,n);g=g||A;for(var u=g.length,s=["g","polyline","path"],F=["transform","opacity","filter"];u--;){var q=g[u];if(q!=null)if((c==="x"||c==="y")&&s.indexOf(q.tagName)>=0){var C=fb([q]);z.moveSelectedElements((c==="x"?n-C.x:0)*h,(c==="y"?n-C.y:0)*h,true)}else{q.tagName==="g"&&F.indexOf(c);C=c==="#text"?q.textContent:q.getAttribute(c);if(C==null)C="";if(C!==String(n)){if(c=="#text"){svgedit.utilities.getBBox(q);
q.textContent=n;if(/rotate/.test(q.getAttribute("transform")))q=Ob(q)}else c=="#href"?Xa(q,n):q.setAttribute(c,n);xa==="textedit"&&c!=="#text"&&q.textContent.length&&Na.toSelectMode(q);if(svgedit.browser.isGecko()&&q.nodeName==="text"&&/rotate/.test(q.getAttribute("transform")))if(String(n).indexOf("url")===0||["font-size","font-family","x","y"].indexOf(c)>=0&&q.textContent)q=Ob(q);A.indexOf(q)>=0&&setTimeout(function(){q.parentNode&&ua.requestSelector(q).resize()},0);C=svgedit.utilities.getRotationAngle(q);
if(C!=0&&c!="transform")for(var D=svgedit.transformlist.getTransformList(q),I=D.numberOfItems;I--;)if(D.getItem(I).type==4){D.removeItem(I);var J=svgedit.utilities.getBBox(q),P=svgedit.math.transformPoint(J.x+J.width/2,J.y+J.height/2,svgedit.math.transformListToTransform(D).matrix);J=P.x;P=P.y;var Z=B.createSVGTransform();Z.setRotate(C,J,P);D.insertItemBefore(Z,I);break}}}}},Wa=this.changeSelectedAttribute=function(c,n,g){g=g||A;z.undoMgr.beginUndoableChange(c,g);zb(c,n,g);c=z.undoMgr.finishUndoableChange();
c.isEmpty()||pa(c)};this.deleteSelectedElements=function(){var c,n=new svgedit.history.BatchCommand("Delete Elements"),g=A.length,u=[];for(c=0;c<g;++c){var s=A[c];if(s==null)break;var F=s.parentNode,q=s;ua.releaseSelector(q);svgedit.path.removePath_(q.id);if(F.tagName==="a"&&F.childNodes.length===1){q=F;F=F.parentNode}var C=q.nextSibling;q=F.removeChild(q);u.push(s);A[c]=null;n.addSubCommand(new jb(q,C,F))}n.isEmpty()||pa(n);la("changed",u);za()};this.cutSelectedElements=function(){var c,n=new svgedit.history.BatchCommand("Cut Elements"),
g=A.length,u=[];for(c=0;c<g;++c){var s=A[c];if(s==null)break;var F=s.parentNode,q=s;ua.releaseSelector(q);svgedit.path.removePath_(q.id);var C=q.nextSibling;q=F.removeChild(q);u.push(s);A[c]=null;n.addSubCommand(new jb(q,C,F))}n.isEmpty()||pa(n);la("changed",u);za();z.clipBoard=u};this.copySelectedElements=function(){z.clipBoard=$.merge([],A)};this.pasteElements=function(c,n,g){var u=z.clipBoard,s=u.length;if(s){for(var F=[],q=new svgedit.history.BatchCommand("Paste elements"),C=i();s--;){var D=u[s];
if(D){var I=C.copyElem(D);if(!svgedit.utilities.getElem(D.id))I.id=D.id;F.push(I);(o||C.getCurrentLayer()).appendChild(I);q.addSubCommand(new svgedit.history.InsertElementCommand(I));pb(I)}}cb(F);if(c!=="in_place"){var J,P;if(c){if(c==="point"){J=n;P=g}}else{J=Cb.x;P=Cb.y}c=fb(F);var Z=J-(c.x+c.width/2),Y=P-(c.y+c.height/2),da=[],ga=[];$.each(F,function(){da.push(Z);ga.push(Y)});J=z.moveSelectedElements(da,ga,false);q.addSubCommand(J)}pa(q);la("changed",F)}};this.groupSelectedElements=function(c,
n){c||(c="g");var g="";switch(c){case "a":g="Make hyperlink";var u="";if(arguments.length>1)u=n;break;default:c="g";g="Group Elements"}g=new svgedit.history.BatchCommand(g);var s=S({element:c,attr:{id:Ia()}});c==="a"&&Xa(s,u);g.addSubCommand(new svgedit.history.InsertElementCommand(s));for(u=A.length;u--;){var F=A[u];if(F!=null){if(F.parentNode.tagName==="a"&&F.parentNode.childNodes.length===1)F=F.parentNode;var q=F.nextSibling,C=F.parentNode;s.appendChild(F);g.addSubCommand(new svgedit.history.MoveElementCommand(F,
q,C))}}g.isEmpty()||pa(g);cb([s],true)};var rb=this.pushGroupProperties=function(c,n){var g=c.childNodes,u=g.length,s=c.getAttribute("transform"),F=svgedit.transformlist.getTransformList(c),q=svgedit.math.transformListToTransform(F).matrix,C=new svgedit.history.BatchCommand("Push group properties"),D=0,I=svgedit.utilities.getRotationAngle(c),J=$(c).attr(["filter","opacity"]),P,Z,Y,da=i();for(D=0;D<u;D++){var ga=g[D];if(ga.nodeType===1){if(J.opacity!==null&&J.opacity!==1){ga.getAttribute("opacity");
var ma=Math.round((ga.getAttribute("opacity")||1)*J.opacity*100)/100;Wa("opacity",ma,[ga])}if(J.filter){Y=ma=this.getBlur(ga);Z||(Z=this.getBlur(c));if(ma)ma=Number(Z)+Number(ma);else if(ma===0)ma=Z;if(Y)P=svgedit.utilities.getRefElem(ga.getAttribute("filter"));else if(P){P=da.copyElem(P);svgedit.utilities.findDefs().appendChild(P)}else P=svgedit.utilities.getRefElem(J.filter);P.id=ga.id+"_"+(P.firstChild.tagName==="feGaussianBlur"?"blur":"filter");Wa("filter","url(#"+P.id+")",[ga]);if(ma){Wa("stdDeviation",
ma,[P.firstChild]);z.setBlurOffsets(P,ma)}}ma=svgedit.transformlist.getTransformList(ga);if(~ga.tagName.indexOf("Gradient"))ma=null;if(ma)if(ga.tagName!=="defs")if(F.numberOfItems){if(I&&F.numberOfItems==1){var U=F.getItem(0).matrix,M=B.createSVGMatrix();if(Y=svgedit.utilities.getRotationAngle(ga))M=ma.getItem(0).matrix;var H=svgedit.utilities.getBBox(ga),K=svgedit.math.transformListToTransform(ma).matrix,O=svgedit.math.transformPoint(H.x+H.width/2,H.y+H.height/2,K);H=I+Y;K=B.createSVGTransform();
K.setRotate(H,O.x,O.y);U=svgedit.math.matrixMultiply(U,M,K.matrix.inverse());Y&&ma.removeItem(0);if(H)ma.numberOfItems?ma.insertItemBefore(K,0):ma.appendItem(K);if(U.e||U.f){Y=B.createSVGTransform();Y.setTranslate(U.e,U.f);ma.numberOfItems?ma.insertItemBefore(Y,0):ma.appendItem(Y)}}else{U=ga.getAttribute("transform");Y={};Y.transform=U||"";Y=B.createSVGTransform();U=svgedit.math.transformListToTransform(ma).matrix;M=U.inverse();U=svgedit.math.matrixMultiply(M,q,U);Y.setMatrix(U);ma.appendItem(Y)}(ga=
svgedit.recalculate.recalculateDimensions(ga))&&C.addSubCommand(ga)}}}if(s){Y={};Y.transform=s;c.setAttribute("transform","");c.removeAttribute("transform");C.addSubCommand(new svgedit.history.ChangeElementCommand(c,Y))}if(n&&!C.isEmpty())return C};this.ungroupSelectedElement=function(){var c=A[0];if(c)if($(c).data("gsvg")||$(c).data("symbol"))Yb(c);else if(c.tagName==="use"){var n=svgedit.utilities.getElem(Ta(c).substr(1));$(c).data("symbol",n).data("ref",n);Yb(c)}else{n=$(c).parents("a");if(n.length)c=
n[0];if(c.tagName==="g"||c.tagName==="a"){n=new svgedit.history.BatchCommand("Ungroup Elements");var g=rb(c,true);g&&n.addSubCommand(g);g=c.parentNode;for(var u=c.nextSibling,s=Array(c.childNodes.length),F=0;c.firstChild;){var q=c.firstChild,C=q.nextSibling,D=q.parentNode;if(q.tagName==="title"){n.addSubCommand(new svgedit.history.RemoveElementCommand(q,q.nextSibling,D));D.removeChild(q)}else{s[F++]=q=g.insertBefore(q,u);n.addSubCommand(new svgedit.history.MoveElementCommand(q,C,D))}}za();u=c.nextSibling;
c=g.removeChild(c);n.addSubCommand(new svgedit.history.RemoveElementCommand(c,u,g));n.isEmpty()||pa(n);nb(s)}}};this.moveToTopSelectedElement=function(){var c=A[0];if(c!=null){c=c;var n=c.parentNode,g=c.nextSibling;c=c.parentNode.appendChild(c);if(g!=c.nextSibling){pa(new svgedit.history.MoveElementCommand(c,g,n,"top"));la("changed",[c])}}};this.moveToBottomSelectedElement=function(){var c=A[0];if(c!=null){c=c;var n=c.parentNode,g=c.nextSibling,u=c.parentNode.firstChild;if(u.tagName=="title")u=u.nextSibling;
if(u.tagName=="defs")u=u.nextSibling;c=c.parentNode.insertBefore(c,u);if(g!=c.nextSibling){pa(new svgedit.history.MoveElementCommand(c,g,n,"bottom"));la("changed",[c])}}};this.moveUpDownSelected=function(c){var n=A[0];if(n){Ja=[];var g,u,s=$(Za(fb([n]))).toArray();c=="Down"&&s.reverse();$.each(s,function(){if(u){g=this;return false}else if(this==n)u=true});if(g){s=n.parentNode;var F=n.nextSibling;$(g)[c=="Down"?"before":"after"](n);if(F!=n.nextSibling){pa(new svgedit.history.MoveElementCommand(n,
F,s,"Move "+c));la("changed",[n])}}}};this.moveSelectedElements=function(c,n,g){if(c.constructor!=Array){c/=h;n/=h}g=g||true;for(var u=new svgedit.history.BatchCommand("position"),s=A.length;s--;){var F=A[s];if(F!=null){var q=B.createSVGTransform(),C=svgedit.transformlist.getTransformList(F);c.constructor==Array?q.setTranslate(c[s],n[s]):q.setTranslate(c,n);C.numberOfItems?C.insertItemBefore(q,0):C.appendItem(q);(q=svgedit.recalculate.recalculateDimensions(F))&&u.addSubCommand(q);ua.requestSelector(F).resize()}}if(!u.isEmpty()){g&&
pa(u);la("changed",A);return u}};this.cloneSelectedElements=function(c,n){var g,u,s=new svgedit.history.BatchCommand("Clone Elements"),F=A.length;A.sort(function(C,D){return $(D).index()-$(C).index()});for(g=0;g<F;++g){u=A[g];if(u==null)break}F=A.slice(0,g);this.clearSelection(true);var q=i();for(g=F.length;g--;){u=F[g]=q.copyElem(F[g]);(o||q.getCurrentLayer()).appendChild(u);s.addSubCommand(new svgedit.history.InsertElementCommand(u))}if(!s.isEmpty()){nb(F.reverse());this.moveSelectedElements(c,
n,false);pa(s)}};this.alignSelectedElements=function(c,n){var g,u,s=[],F=Number.MAX_VALUE,q=Number.MIN_VALUE,C=Number.MAX_VALUE,D=Number.MIN_VALUE,I=Number.MIN_VALUE,J=Number.MIN_VALUE,P=A.length;if(P){for(g=0;g<P;++g){if(A[g]==null)break;u=A[g];s[g]=fb([u]);switch(n){case "smallest":if((c=="l"||c=="c"||c=="r")&&(I==Number.MIN_VALUE||I>s[g].width)||(c=="t"||c=="m"||c=="b")&&(J==Number.MIN_VALUE||J>s[g].height)){F=s[g].x;C=s[g].y;q=s[g].x+s[g].width;D=s[g].y+s[g].height;I=s[g].width;J=s[g].height}break;
case "largest":if((c=="l"||c=="c"||c=="r")&&(I==Number.MIN_VALUE||I<s[g].width)||(c=="t"||c=="m"||c=="b")&&(J==Number.MIN_VALUE||J<s[g].height)){F=s[g].x;C=s[g].y;q=s[g].x+s[g].width;D=s[g].y+s[g].height;I=s[g].width;J=s[g].height}break;default:if(s[g].x<F)F=s[g].x;if(s[g].y<C)C=s[g].y;if(s[g].x+s[g].width>q)q=s[g].x+s[g].width;if(s[g].y+s[g].height>D)D=s[g].y+s[g].height}}if(n=="page"){C=F=0;q=z.contentW;D=z.contentH}u=Array(P);I=Array(P);for(g=0;g<P;++g){if(A[g]==null)break;J=s[g];u[g]=0;I[g]=0;
switch(c){case "l":u[g]=F-J.x;break;case "c":u[g]=(F+q)/2-(J.x+J.width/2);break;case "r":u[g]=q-(J.x+J.width);break;case "t":I[g]=C-J.y;break;case "m":I[g]=(C+D)/2-(J.y+J.height/2);break;case "b":I[g]=D-(J.y+J.height)}}this.moveSelectedElements(u,I)}};this.contentW=tb().w;this.contentH=tb().h;this.updateCanvas=function(c,n){B.setAttribute("width",c);B.setAttribute("height",n);var g=$("#canvasBackground")[0],u=f.getAttribute("x"),s=f.getAttribute("y"),F=c/2-this.contentW*h/2,q=n/2-this.contentH*h/
2;svgedit.utilities.assignAttributes(f,{width:this.contentW*h,height:this.contentH*h,x:F,y:q,viewBox:"0 0 "+this.contentW+" "+this.contentH});svgedit.utilities.assignAttributes(g,{width:f.getAttribute("width"),height:f.getAttribute("height"),x:F,y:q});(g=svgedit.utilities.getElem("background_image"))&&svgedit.utilities.assignAttributes(g,{width:"100%",height:"100%"});ua.selectorParentGroup.setAttribute("transform","translate("+F+","+q+")");Ya("canvasUpdated",{new_x:F,new_y:q,old_x:u,old_y:s,d_x:F-
u,d_y:q-s});return{x:F,y:q,old_x:u,old_y:s,d_x:F-u,d_y:q-s}};this.setBackground=function(c,n){var g=svgedit.utilities.getElem("canvasBackground"),u=$(g).find("rect")[0],s=svgedit.utilities.getElem("background_image");u.setAttribute("fill",c);if(n){if(!s){s=N.createElementNS(k.SVG,"image");svgedit.utilities.assignAttributes(s,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}Xa(s,n);g.appendChild(s)}else s&&s.parentNode.removeChild(s)};this.cycleElement=
function(c){var n=A[0],g=false,u=yb(o||i().getCurrentLayer());if(u.length){if(n==null){c=c?u.length-1:0;g=u[c]}else for(var s=u.length;s--;)if(u[s]==n){c=c?s-1:s+1;if(c>=u.length)c=0;else if(c<0)c=u.length-1;g=u[c];break}cb([g],true);la("selected",A)}};this.clear();this.getPrivateMethods=function(){return{addCommandToHistory:pa,setGradient:ac,addSvgElementFromJson:S,assignAttributes:wa,BatchCommand:ja,call:la,ChangeElementCommand:Sb,copyElem:function(c){return i().copyElem(c)},ffClone:Ob,findDefs:ya,
findDuplicateGradient:$b,getElem:db,getId:gb,getIntersectionList:Za,getMouseTarget:Db,getNextId:Ia,getPathBBox:Oa,getUrlFromAttr:ta,hasMatrixTransform:T,identifyLayers:Zb,InsertElementCommand:ab,isIdentity:svgedit.math.isIdentity,logMatrix:Xb,matrixMultiply:R,MoveElementCommand:ib,preventClickDefault:svgedit.utilities.preventClickDefault,recalculateAllSelectedDimensions:Wb,recalculateDimensions:Kb,remapElement:Jb,RemoveElementCommand:jb,removeUnusedDefElems:Qb,round:qb,runExtensions:Ya,sanitizeSvg:Lb,
SVGEditTransformList:svgedit.transformlist.SVGTransformList,toString:toString,transformBox:svgedit.math.transformBox,transformListToTransform:ba,transformPoint:W,walkTree:svgedit.utilities.walkTree}}};(function(){if(!window.svgEditor){window.svgEditor=function(a){function t(r,w){var A=b.setSvgString(r)!==false;w=w||a.noop;A?w(true):a.alert(o.notification.errorLoadingSVG,function(){w(false)})}var l={};l.tool_scale=1;l.exportWindowCt=0;l.langChanged=false;l.showSaveWarning=false;l.storagePromptClosed=false;var b,d,k=svgedit.utilities,e=false,v=false,z=false,N=[],B={lang:"",iconsize:"",bkgd_color:"#FFF",bkgd_url:"",img_save:"embed",save_notice_done:false,export_notice_done:false},f={},m={extensions:[],
allowedOrigins:[]},i=["ext-overview_window.js","ext-markers.js","ext-connector.js","ext-eyedropper.js","ext-shapes.js","ext-imagelib.js","ext-grid.js","ext-polygon.js","ext-star.js","ext-panning.js","ext-storage.js"],h={canvasName:"default",canvas_expansion:3,initFill:{color:"FF0000",opacity:1},initStroke:{width:5,color:"000000",opacity:1},text:{stroke_width:0,font_size:24,font_family:"serif"},initOpacity:1,colorPickerCSS:null,initTool:"select",exportWindowType:"new",wireframe:false,showlayers:false,
no_save_warning:false,imgPath:"images/",langPath:"locale/",extPath:"extensions/",jGraduatePath:"jgraduate/images/",dimensions:[640,480],gridSnapping:false,gridColor:"#000",baseUnit:"px",snappingStep:10,showRulers:true,preventAllURLConfig:false,preventURLContentLoading:false,lockExtensions:false,noDefaultExtensions:false,showGrid:false,noStorageOnLoad:false,forceStorage:false,emptyStorageOnDecline:false},o=l.uiStrings={common:{ok:"OK",cancel:"Cancel",key_up:"Up",key_down:"Down",key_backspace:"Backspace",
key_del:"Del"},layers:{layer:"Layer"},notification:{invalidAttrValGiven:"Invalid value given",noContentToFitTo:"No content to fit to",dupeLayerName:"There is already a layer named that!",enterUniqueLayerName:"Please enter a unique layer name",enterNewLayerName:"Please enter the new layer name",layerHasThatName:"Layer already has that name",QmoveElemsToLayer:"Move selected elements to layer '%s'?",QwantToClear:"Do you want to clear the drawing?\nThis will also erase your undo history!",QwantToOpen:"Do you want to open a new file?\nThis will also erase your undo history!",
QerrorsRevertToSource:"There were parsing errors in your SVG source.\nRevert back to original SVG source?",QignoreSourceChanges:"Ignore changes made to SVG source?",featNotSupported:"Feature not supported",enterNewImgURL:"Enter the new image URL",defsFailOnSave:"NOTE: Due to a bug in your browser, this image may appear wrong (missing gradients or elements). It will however appear correct once actually saved.",loadingImage:"Loading image, please wait...",saveFromBrowser:"Select 'Save As...' in your browser to save this image as a %s file.",
noteTheseIssues:"Also note the following issues: ",unsavedChanges:"There are unsaved changes.",enterNewLinkURL:"Enter the new hyperlink URL",errorLoadingSVG:"Error: Unable to load SVG data",URLloadFail:"Unable to load from URL",retrieving:"Retrieving '%s' ..."}};a.pref=function(r,w){if(w){f[r]=w;l.curPrefs=f}else return r in f?f[r]:B[r]};l.loadContentAndPrefs=function(){if(!(!m.forceStorage&&(m.noStorageOnLoad||!document.cookie.match(/(?:^|;\s*)store=(?:prefsAndContent|prefsOnly)/)))){if(l.storage&&
(m.forceStorage||!m.noStorageOnLoad&&document.cookie.match(/(?:^|;\s*)store=prefsAndContent/))){var r=l.storage.getItem("svgedit-"+m.canvasName);r&&l.loadFromString(r)}for(var w in B)if(B.hasOwnProperty(w)){r="svg-edit-"+w;if(l.storage){if(r=l.storage.getItem(r))B[w]=String(r)}else if(window.widget)B[w]=widget.preferenceForKey(r);else{r=document.cookie.match(RegExp("(?:^|;\\s*)"+k.preg_quote(encodeURIComponent(r))+"=([^;]+)"));B[w]=r?decodeURIComponent(r[1]):""}}}};l.setConfig=function(r,w){function A(S,
W,R){if(S[W]&&typeof S[W]==="object")a.extend(true,S[W],R);else S[W]=R}w=w||{};a.each(r,function(S,W){if(r.hasOwnProperty(S))if(B.hasOwnProperty(S)){if(!(w.overwrite===false&&(m.preventAllURLConfig||f.hasOwnProperty(S))))if(w.allowInitialUserOverride===true)B[S]=W;else a.pref(S,W)}else if(["extensions","allowedOrigins"].indexOf(S)>-1)w.overwrite===false&&(m.preventAllURLConfig||S==="allowedOrigins"||S==="extensions"&&m.lockExtensions)||(m[S]=m[S].concat(W));else if(h.hasOwnProperty(S))if(!(w.overwrite===
false&&(m.preventAllURLConfig||m.hasOwnProperty(S))))if(m.hasOwnProperty(S))w.overwrite!==false&&A(m,S,W);else if(w.allowInitialUserOverride===true)A(h,S,W);else if(h[S]&&typeof h[S]==="object"){m[S]={};a.extend(true,m[S],W)}else m[S]=W});l.curConfig=m};l.setCustomHandlers=function(r){l.ready(function(){if(r.open){a('#tool_open > input[type="file"]').remove();a("#tool_open").show();b.open=r.open}if(r.save){l.showSaveWarning=false;b.bind("saved",r.save)}if(r.exportImage){v=r.exportImage;b.bind("exported",
v)}if(r.exportPDF){z=r.exportPDF;b.bind("exportedPDF",z)}})};l.randomizeIds=function(){b.randomizeIds(arguments)};l.init=function(){function r(){m=a.extend(true,{},h,m);if(!m.noDefaultExtensions)m.extensions=m.extensions.concat(i);a.each(["extensions","allowedOrigins"],function(j,p){m[p]=a.grep(m[p],function(E,G){return G===m[p].indexOf(E)})});l.curConfig=m}function w(j,p){var E=j.id,G=E.split("_"),L=G[0];G=G[1];p&&b.setStrokeAttr("stroke-"+L,G);Aa();db("#cur_"+L,E,20);a(j).addClass("current").siblings().removeClass("current")}
function A(j,p){a.pref("bkgd_color",j);a.pref("bkgd_url",p);b.setBackground(j,p)}function S(){var j=b.getHref(oa);j=j.indexOf("data:")===0?"":j;a.prompt(o.notification.enterNewImgURL,j,function(p){p&&Cb(p)})}function W(j,p){p||(p=b.getZoom());j||(j=a("#svgcanvas"));var E,G,L=b.getContentElem(),Q=svgedit.units.getTypeMap()[m.baseUnit];for(E=0;E<2;E++){var X=E===0,ea=X?"x":"y",ha=X?"width":"height",ka=Number(L.getAttribute(ea));ea=a("#ruler_"+ea+" canvas:first");var fa=ea.clone();ea.replaceWith(fa);
var na=fa[0];var sa=ea=j[ha]();na.parentNode.style[ha]=sa+"px";var Ka=0,V=na.getContext("2d"),Fa,va,La;V.fillStyle="rgb(200,0,0)";V.fillRect(0,0,na.width,na.height);fa.siblings().remove();if(ea>=3E4){La=parseInt(ea/3E4,10)+1;Fa=[];Fa[0]=V;var Ra;for(G=1;G<La;G++){na[ha]=3E4;Ra=na.cloneNode(true);na.parentNode.appendChild(Ra);Fa[G]=Ra.getContext("2d")}Ra[ha]=ea%3E4;ea=3E4}na[ha]=ea;ha=Q*p;na=50/ha;fa=1;for(G=0;G<bb.length;G++){fa=va=bb[G];if(na<=va)break}na=fa*ha;V.font="9px sans-serif";for(var Ha=
ka/ha%fa*ha,Sa=Ha-na;Ha<sa;){Sa+=na;G=Math.round(Ha)+0.5;if(X){V.moveTo(G,15);V.lineTo(G,0)}else{V.moveTo(15,G);V.lineTo(0,G)}va=(Sa-ka)/ha;if(fa>=1)G=Math.round(va);else{G=String(fa).split(".")[1].length;G=va.toFixed(G)}if(G!==0&&G!==1E3&&G%1E3===0)G=G/1E3+"K";if(X)V.fillText(G,Ha+2,8);else{va=String(G).split("");for(G=0;G<va.length;G++)V.fillText(va[G],1,Ha+9+G*9)}va=na/10;for(G=1;G<10;G++){var Qa=Math.round(Ha+va*G)+0.5;if(Fa&&Qa>ea){Ka++;V.stroke();if(Ka>=La){G=10;Ha=sa;continue}V=Fa[Ka];Ha-=
3E4;Qa=Math.round(Ha+va*G)+0.5}var Ma=G%2?12:10;if(X){V.moveTo(Qa,15);V.lineTo(Qa,Ma)}else{V.moveTo(15,Qa);V.lineTo(Ma,Qa)}}Ha+=na}V.strokeStyle="#000";V.stroke()}}function R(){if(b.deleteCurrentLayer()){Za();Ca();a("#layerlist tr.layer").removeClass("layersel");a("#layerlist tr.layer:first").addClass("layersel")}}function T(){var j=b.getCurrentDrawing().getCurrentLayerName()+" copy";a.prompt(o.notification.enterUniqueLayerName,j,function(p){if(p)if(b.getCurrentDrawing().hasLayer(p))a.alert(o.notification.dupeLayerName);
else{b.cloneLayer(p);Za();Ca()}})}function ba(j){var p=a("#layerlist tr.layersel").index(),E=b.getCurrentDrawing().getNumLayers();if(p>0||p<E-1){p+=j;b.setCurrentLayerPosition(E-p-1);Ca()}}function ya(j){j.stopPropagation();j.preventDefault()}function ta(j){j.stopPropagation();j.preventDefault()}function Ta(j){j.stopPropagation();j.preventDefault()}try{if("localStorage"in window)l.storage=localStorage}catch(Xa){}var Oa=[];a("#lang_select option").each(function(){Oa.push(this.value)});(function(){var j,
p;d=a.deparam.querystring(true);if(a.isEmptyObject(d)){r();l.loadContentAndPrefs()}else{if(d.dimensions)d.dimensions=d.dimensions.split(",");if(d.bkgd_color)d.bkgd_color="#"+d.bkgd_color;if(d.extensions)d.extensions=d.extensions.match(/[:\/\\]/)?"":d.extensions.split(",");a.each(["extPath","imgPath","langPath","jGraduatePath"],function(E){d[E]&&delete d[E]});l.setConfig(d,{overwrite:false});r();if(!m.preventURLContentLoading){j=d.source;p=a.param.querystring();if(!j)if(p.indexOf("source=data:")>=
0)j=p.match(/source=(data:[^&]*)/)[1];if(j){j.indexOf("data:")===0?l.loadFromDataURI(j):l.loadFromString(j);return}if(d.url){l.loadFromURL(d.url);return}}if(!d.noStorageOnLoad||m.forceStorage)l.loadContentAndPrefs()}f=a.extend(true,{},B,f);l.curPrefs=f})();var db=l.setIcon=function(j,p){var E=typeof p==="string"?a.getSvgIcon(p,true):p.clone();E?a(j).empty().append(E):console.log("NOTE: Icon image missing: "+p)},wa=function(){a.each(m.extensions,function(){var j=this;j.match(/^ext-.*\.js/)&&a.getScript(m.extPath+
j,function(p){if(!p){p=document.createElement("script");p.src=m.extPath+j;document.querySelector("head").appendChild(p)}}).fail(function(p,E,G){console.log(G)})});l.putLocale(null,Oa)};document.location.protocol==="file:"?setTimeout(wa,100):wa();a.svgIcons(m.imgPath+"svg_edit_icons.svg",{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback_path:m.imgPath,fallback:{new_image:"clear.png",save:"save.png",open:"open.png",source:"source.png",docprops:"document-properties.png",wireframe:"wireframe.png",
undo:"undo.png",redo:"redo.png",select:"select.png",select_node:"select_node.png",pencil:"fhpath.png",pen:"line.png",square:"square.png",rect:"rect.png",fh_rect:"freehand-square.png",circle:"circle.png",ellipse:"ellipse.png",fh_ellipse:"freehand-circle.png",path:"path.png",text:"text.png",image:"image.png",zoom:"zoom.png",clone:"clone.png",node_clone:"node_clone.png","delete":"delete.png",node_delete:"node_delete.png",group:"shape_group_elements.png",ungroup:"shape_ungroup.png",move_top:"move_top.png",
move_bottom:"move_bottom.png",to_path:"to_path.png",link_controls:"link_controls.png",reorient:"reorient.png",align_left:"align-left.png",align_center:"align-center.png",align_right:"align-right.png",align_top:"align-top.png",align_middle:"align-middle.png",align_bottom:"align-bottom.png",go_up:"go-up.png",go_down:"go-down.png",ok:"save.png",cancel:"cancel.png",arrow_right:"flyouth.png",arrow_down:"dropdown.gif"},placement:{"#logo":"logo","#tool_clear div,#layer_new":"new_image","#tool_save div":"save",
"#tool_export div":"export","#tool_open div div":"open","#tool_import div div":"import","#tool_source":"source","#tool_docprops > div":"docprops","#tool_wireframe":"wireframe","#tool_undo":"undo","#tool_redo":"redo","#tool_select":"select","#tool_fhpath":"pencil","#tool_line":"pen","#tool_rect,#tools_rect_show":"rect","#tool_square":"square","#tool_fhrect":"fh_rect","#tool_ellipse,#tools_ellipse_show":"ellipse","#tool_circle":"circle","#tool_fhellipse":"fh_ellipse","#tool_path":"path","#tool_text,#layer_rename":"text",
"#tool_image":"image","#tool_zoom":"zoom","#tool_clone,#tool_clone_multi":"clone","#tool_node_clone":"node_clone","#layer_delete,#tool_delete,#tool_delete_multi":"delete","#tool_node_delete":"node_delete","#tool_add_subpath":"add_subpath","#tool_openclose_path":"open_path","#tool_move_top":"move_top","#tool_move_bottom":"move_bottom","#tool_topath":"to_path","#tool_node_link":"link_controls","#tool_reorient":"reorient","#tool_group_elements":"group_elements","#tool_ungroup":"ungroup","#tool_unlink_use":"unlink_use",
"#tool_alignleft, #tool_posleft":"align_left","#tool_aligncenter, #tool_poscenter":"align_center","#tool_alignright, #tool_posright":"align_right","#tool_aligntop, #tool_postop":"align_top","#tool_alignmiddle, #tool_posmiddle":"align_middle","#tool_alignbottom, #tool_posbottom":"align_bottom","#cur_position":"align","#linecap_butt,#cur_linecap":"linecap_butt","#linecap_round":"linecap_round","#linecap_square":"linecap_square","#linejoin_miter,#cur_linejoin":"linejoin_miter","#linejoin_round":"linejoin_round",
"#linejoin_bevel":"linejoin_bevel","#url_notice":"warning","#layer_up":"go_up","#layer_down":"go_down","#layer_moreopts":"context_menu","#layerlist td.layervis":"eye","#tool_source_save,#tool_docprops_save,#tool_prefs_save":"ok","#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel":"cancel","#rwidthLabel, #iwidthLabel":"width","#rheightLabel, #iheightLabel":"height","#cornerRadiusLabel span":"c_radius","#angleLabel":"angle","#linkLabel,#tool_make_link,#tool_make_link_multi":"globe_link",
"#zoomLabel":"zoom","#tool_fill label":"fill","#tool_stroke .icon_label":"stroke","#group_opacityLabel":"opacity","#blurLabel":"blur","#font_sizeLabel":"fontsize",".flyout_arrow_horiz":"arrow_right",".dropdown button, #main_button .dropdown":"arrow_down","#palette .palette_item:first, #fill_bg, #stroke_bg":"no_color"},resize:{"#logo .svg_icon":28,".flyout_arrow_horiz .svg_icon":5,".layer_button .svg_icon, #layerlist td.layervis .svg_icon":14,".dropdown button .svg_icon":7,"#main_button .dropdown .svg_icon":9,
".palette_item:first .svg_icon":15,"#fill_bg .svg_icon, #stroke_bg .svg_icon":16,".toolbar_button button .svg_icon":16,".stroke_tool div div .svg_icon":20,"#tools_bottom label .svg_icon":18},callback:function(){a(".toolbar_button button > svg, .toolbar_button button > img").each(function(){a(this).parent().prepend(this)});var j,p=a("#tools_left");if(p.length!==0)j=p.offset().top+p.outerHeight();p=a.pref("iconsize");l.setIconSize(p||(a(window).height()<j?"s":"m"));a(".tools_flyout").each(function(){var E=
a("#"+this.id+"_show"),G=E.attr("data-curopt");if(!E.children("svg, img").length){G=a(G).children().clone();if(G.length){G[0].removeAttribute("style");E.append(G)}}});l.runCallbacks();setTimeout(function(){a(".flyout_arrow_horiz:empty").each(function(){a(this).append(a.getSvgIcon("arrow_right").width(5).height(5))})},1)}});l.canvas=b=new a.SvgCanvas(document.getElementById("svgcanvas"),m);var Ib,Jb,Kb,eb,Lb,ib=svgedit.browser.isMac()?"meta+":"ctrl+",ab=b.pathActions,jb=b.undoMgr,Sb=m.imgPath+"logo.png",
ja=a("#workarea"),la=a("#cmenu_canvas"),pa=null,ua="crosshair",ub="crosshair",Ab="toolbars",wb="",Pa={fill:null,stroke:null};(function(){var j,p=window.opener||window.parent;if(p)try{j=p.document.createEvent("Event");j.initEvent("svgEditorReady",true,true);p.document.documentElement.dispatchEvent(j)}catch(E){}})();(function(){a("#dialog_container").draggable({cancel:"#dialog_content, #dialog_buttons *",containment:"window"});var j=a("#dialog_box"),p=a("#dialog_buttons"),E=a("#dialog_content"),G=function(L,
Q,X,ea,ha,ka,fa){var na,sa,Ka;E.html("<p>"+Q.replace(/\n/g,"</p><p>")+"</p>").toggleClass("prompt",L=="prompt");p.empty();na=a('<input type="button" value="'+o.common.ok+'">').appendTo(p);L!=="alert"&&a('<input type="button" value="'+o.common.cancel+'">').appendTo(p).click(function(){j.hide();X&&X(false)});if(L==="prompt"){sa=a('<input type="text">').prependTo(p);sa.val(ea||"");sa.bind("keydown","return",function(){na.click()})}else if(L==="select"){Q=a('<div style="text-align:center;">');sa=a("<select>").appendTo(Q);
if(fa){var V=a("<label>").text(fa.label);Ka=a('<input type="checkbox">').appendTo(V);Ka.val(fa.value);fa.tooltip&&V.attr("title",fa.tooltip);Ka.prop("checked",!!fa.checked);Q.append(a("<div>").append(V))}a.each(ha||[],function(Fa,va){typeof va==="object"?sa.append(a("<option>").val(va.value).html(va.text)):sa.append(a("<option>").html(va))});E.append(Q);ea&&sa.val(ea);ka&&sa.bind("change","return",ka);sa.bind("keydown","return",function(){na.click()})}else L==="process"&&na.hide();j.show();na.click(function(){j.hide();
var Fa=L==="prompt"||L==="select"?sa.val():true;if(X)Ka?X(Fa,Ka.prop("checked")):X(Fa)}).focus();if(L==="prompt"||L==="select")sa.focus()};a.alert=function(L,Q){G("alert",L,Q)};a.confirm=function(L,Q){G("confirm",L,Q)};a.process_cancel=function(L,Q){G("process",L,Q)};a.prompt=function(L,Q,X){G("prompt",L,X,Q)};a.select=function(L,Q,X,ea,ha,ka){G("select",L,X,ha,Q,ea,ka)}})();var pb=function(){var j=a(".tool_button_current");if(j.length&&j[0].id!=="tool_select"){j.removeClass("tool_button_current").addClass("tool_button");
a("#tool_select").addClass("tool_button_current").removeClass("tool_button");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}")}b.setMode("select");ja.css("cursor","auto")},oa=null,Ua=false,mb=false,hb=false,Ba=false,vb="",xa=a("title:first").text(),bb=[];for(wa=0.1;wa<1E5;wa*=10){bb.push(wa);bb.push(2*wa);bb.push(5*wa)}var xb=function(j){var p,E=[],G=b.getCurrentDrawing().getNumLayers();for(p=0;p<G;p++)E[p]=b.getCurrentDrawing().getLayerName(p);
if(j)for(p=0;p<G;++p)E[p]!=j&&b.getCurrentDrawing().setLayerOpacity(E[p],0.5);else for(p=0;p<G;++p)b.getCurrentDrawing().setLayerOpacity(E[p],1)},Ca=function(){b.clearSelection();for(var j=a("#layerlist tbody").empty(),p=a("#selLayerNames").empty(),E=b.getCurrentDrawing(),G=E.getCurrentLayerName(),L=b.getCurrentDrawing().getNumLayers(),Q=a.getSvgIcon("eye");L--;){var X=E.getLayerName(L),ea=a('<tr class="layer">').toggleClass("layersel",X===G),ha=a('<td class="layervis">').toggleClass("layerinvis",
!E.getLayerVisibility(X)),ka=a('<td class="layername">'+X+"</td>");j.append(ea.append(ha,ka));p.append('<option value="'+X+'">'+X+"</option>")}if(Q!==undefined){p=Q.clone();a("td.layervis",j).append(p);a.resizeSvgIcons({"td.layervis .svg_icon":14})}a("#layerlist td.layername").mouseup(function(fa){a("#layerlist tr.layer").removeClass("layersel");a(this.parentNode).addClass("layersel");b.setCurrentLayer(this.textContent);fa.preventDefault()}).mouseover(function(){xb(this.textContent)}).mouseout(function(){xb()});
a("#layerlist td.layervis").click(function(){var fa=a(this.parentNode).prevAll().length;fa=a("#layerlist tr.layer:eq("+fa+") td.layername").text();var na=a(this).hasClass("layerinvis");b.setLayerVisibility(fa,na);a(this).toggleClass("layerinvis")});for(p=5-a("#layerlist tr.layer").size();p-- >0;)j.append('<tr><td style="color:white">_</td><td/></tr>')},Va=function(j,p){if(!mb){mb=true;wb=b.getSvgString();a("#save_output_btns").toggle(!!p);a("#tool_source_back").toggle(!p);a("#svg_source_textarea").val(wb);
a("#svg_source_editor").fadeIn();a("#svg_source_textarea").focus()}},Ub=function(j,p){a("#path_node_panel").toggle(j);a("#tools_bottom_2,#tools_bottom_3").toggle(!j);if(j){a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a("#tool_select").addClass("tool_button_current").removeClass("tool_button");db("#tool_select","select_node");Ua=false;if(p.length)oa=p[0]}else setTimeout(function(){db("#tool_select","select")},1E3)},Aa=function(){window.opera&&a("<p/>").hide().appendTo("body").remove()},
Ja=l.toolButtonClick=function(j,p){if(a(j).hasClass("disabled"))return false;if(a(j).parent().hasClass("tools_flyout"))return true;p||a(".tools_flyout").fadeOut("normal");a("#styleoverrides").text("");ja.css("cursor","auto");a(".tool_button_current").removeClass("tool_button_current").addClass("tool_button");a(j).addClass("tool_button_current").removeClass("tool_button");return true},Bb=l.clickSelect=function(){if(Ja("#tool_select")){b.setMode("select");a("#styleoverrides").text("#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}")}},
Cb=l.setImageURL=function(j){j||(j=Sb);b.setImageURL(j);a("#image_url").val(j);if(j.indexOf("data:")===0){a("#image_url").hide();a("#change_image_url").show()}else{b.embedImage(j,function(p){a("#url_notice").toggle(!p);Sb=j});a("#image_url").show();a("#change_image_url").hide()}},Tb=function(j){var p=Math.min(Math.max(12+j.value.length*6,50),300);a(j).width(p)},Ya=l.updateCanvas=function(j,p){var E=ja.width(),G=ja.height(),L=E,Q=G,X=b.getZoom(),ea=a("#svgcanvas"),ha={x:ja[0].scrollLeft+L/2,y:ja[0].scrollTop+
Q/2},ka=m.canvas_expansion;E=Math.max(L,b.contentW*X*ka);G=Math.max(Q,b.contentH*X*ka);E==L&&G==Q?ja.css("overflow","hidden"):ja.css("overflow","scroll");ka=ea.height()/2;var fa=ea.width()/2;ea.width(E).height(G);var na=G/2,sa=E/2,Ka=b.updateCanvas(E,G),V=sa/fa;E=E/2-L/2;G=G/2-Q/2;if(p){p.x+=Ka.x;p.y+=Ka.y}else p={x:sa+(ha.x-fa)*V,y:na+(ha.y-ka)*V};if(j)if(b.contentW>ja.width()){ja[0].scrollLeft=Ka.x-10;ja[0].scrollTop=Ka.y-10}else{ja[0].scrollLeft=E;ja[0].scrollTop=G}else{ja[0].scrollLeft=p.x-L/
2;ja[0].scrollTop=p.y-Q/2}if(m.showRulers){W(ea,X);ja.scroll()}d.storagePrompt!==true&&!l.storagePromptClosed&&a("#dialog_box").hide()},qb=function(){var j,p,E=b.getColor("fill")=="none",G=b.getColor("stroke")=="none",L=["#tool_fhpath","#tool_line"],Q=["#tools_rect .tool_button","#tools_ellipse .tool_button","#tool_text","#tool_path"];if(G)for(j in L){p=L[j];a(p).hasClass("tool_button_current")&&Bb();a(p).addClass("disabled")}else for(j in L){p=L[j];a(p).removeClass("disabled")}if(G&&E)for(j in Q){p=
Q[j];a(p).hasClass("tool_button_current")&&Bb();a(p).addClass("disabled")}else for(j in Q){p=Q[j];a(p).removeClass("disabled")}b.runExtensions("toolButtonStateUpdate",{nofill:E,nostroke:G});a(".tools_flyout").each(function(){var X=a("#"+this.id+"_show"),ea=false;a(this).children().each(function(){a(this).hasClass("disabled")||(ea=true)});X.toggleClass("disabled",!ea)});Aa()},Za=function(){var j=oa;if(j!=null&&!j.parentNode)j=null;var p=b.getCurrentDrawing().getCurrentLayerName(),E=b.getMode(),G=m.baseUnit!==
"px"?m.baseUnit:null,L=E=="pathedit",Q=a("#cmenu_canvas li");a("#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel, #use_panel, #a_panel").hide();if(j!=null){var X=j.nodeName,ea=b.getRotationAngle(j);a("#angle").val(ea);var ha=b.getBlur(j);a("#blur").val(ha);a("#blur_slider").slider("option","value",ha);b.addedNew&&X==="image"&&b.getMode()==="image"&&b.getHref(j).indexOf("data:")!==0&&S();if(!L&&E!="pathedit"){a("#selected_panel").show();
if(["line","circle","ellipse"].indexOf(X)>=0)a("#xy_panel").hide();else{var ka,fa;if(["g","polyline","path"].indexOf(X)>=0){if(E=b.getStrokedBBox([j])){ka=E.x;fa=E.y}}else{ka=j.getAttribute("x");fa=j.getAttribute("y")}if(G){ka=svgedit.units.convertUnit(ka);fa=svgedit.units.convertUnit(fa)}a("#selected_x").val(ka||0);a("#selected_y").val(fa||0);a("#xy_panel").show()}G=["image","text","path","g","use"].indexOf(X)==-1;a("#tool_topath").toggle(G);a("#tool_reorient").toggle(X==="path");a("#tool_reorient").toggleClass("disabled",
ea===0)}else{p=ab.getNodePoint();a("#tool_add_subpath").removeClass("push_button_pressed").addClass("tool_button");a("#tool_node_delete").toggleClass("disabled",!ab.canDeleteNodes);db("#tool_openclose_path",ab.closed_subpath?"open_path":"close_path");if(p){L=a("#seg_type");if(G){p.x=svgedit.units.convertUnit(p.x);p.y=svgedit.units.convertUnit(p.y)}a("#path_node_x").val(p.x);a("#path_node_y").val(p.y);p.type?L.val(p.type).removeAttr("disabled"):L.val(4).attr("disabled","disabled")}return}G={g:[],a:[],
rect:["rx","width","height"],image:["width","height"],circle:["cx","cy","r"],ellipse:["cx","cy","rx","ry"],line:["x1","y1","x2","y2"],text:[],use:[]};var na=j.tagName;X=null;if(na==="a"){X=b.getHref(j);a("#g_panel").show()}if(j.parentNode.tagName==="a")if(!a(j).siblings().length){a("#a_panel").show();X=b.getHref(j.parentNode)}a("#tool_make_link, #tool_make_link").toggle(!X);X&&a("#link_url").val(X);if(G[na]){G=G[na];a("#"+na+"_panel").show();a.each(G,function(sa,Ka){var V=j.getAttribute(Ka);if(m.baseUnit!==
"px"&&j[Ka])V=svgedit.units.convertUnit(j[Ka].baseVal.value);a("#"+na+"_"+Ka).val(V||0)});if(na=="text"){a("#text_panel").css("display","inline");a("#tool_font_size").css("display","inline");b.getItalic()?a("#tool_italic").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_italic").removeClass("push_button_pressed").addClass("tool_button");b.getBold()?a("#tool_bold").addClass("push_button_pressed").removeClass("tool_button"):a("#tool_bold").removeClass("push_button_pressed").addClass("tool_button");
a("#font_family").val(j.getAttribute("font-family"));a("#font_size").val(j.getAttribute("font-size"));a("#text").val(j.textContent);b.addedNew&&setTimeout(function(){a("#text").focus().select()},100)}else if(na=="image"&&b.getMode()=="image")Cb(b.getHref(j));else if(na==="g"||na==="use"){a("#container_panel").show();G=b.getTitle();X=a("#g_title")[0];X.value=G;Tb(X);a("#g_title").prop("disabled",na=="use")}}Q[(na==="g"?"en":"dis")+"ableContextMenuItems"]("#ungroup");Q[(na==="g"||!Ua?"dis":"en")+"ableContextMenuItems"]("#group")}else if(Ua){a("#multiselected_panel").show();
Q.enableContextMenuItems("#group").disableContextMenuItems("#ungroup")}else Q.disableContextMenuItems("#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back");a("#tool_undo").toggleClass("disabled",jb.getUndoStackSize()===0);a("#tool_redo").toggleClass("disabled",jb.getRedoStackSize()===0);b.addedNew=false;if(j&&!L||Ua){a("#selLayerNames").removeAttr("disabled").val(p);la.enableContextMenuItems("#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back")}else a("#selLayerNames").attr("disabled",
"disabled")},fb=function(){if(!Ib){var j="#workarea.wireframe #svgcontent * { stroke-width: "+1/b.getZoom()+"px; }";a("#wireframe_rules").text(ja.hasClass("wireframe")?j:"")}},yb=function(j){j=j||b.getDocumentTitle();j=xa+(j?": "+j:"");a("title:first").text(j)},Vb=b.zoomChanged=function(j,p,E){if(p=b.setBBoxZoom(p,ja.width()-15,ja.height()-15)){j=p.zoom;p=p.bbox;if(j<0.001)Kb({value:0.1});else{a("#zoom").val((j*100).toFixed(1));E?Ya():Ya(false,{x:p.x*j+p.width*j/2,y:p.y*j+p.height*j/2});b.getMode()==
"zoom"&&p.width&&pb();fb()}}};Kb=function(j){var p=j.value/100;if(p<0.001)j.value=0.1;else{j=b.getZoom();Vb(window,{width:0,height:0,x:(ja[0].scrollLeft+ja.width()/2)/j,y:(ja[0].scrollTop+ja.height()/2)/j,zoom:p},true)}};a("#cur_context_panel").delegate("a","click",function(){var j=a(this);j.attr("data-root")?b.leaveContext():b.setContext(j.text());b.clearSelection();return false});var Nb={},gb=function(){a(".tools_flyout").each(function(){var j=a("#"+this.id+"_show");if(!j.data("isLibrary")){var p=
[];a(this).children().each(function(){p.push(this.title)});j[0].title=p.join(" / ")}})},Ia=function(){a(".tools_flyout").each(function(){var j=a("#"+this.id+"_show"),p=j.offset();j=j.outerWidth();a(this).css({left:(p.left+j)*l.tool_scale,top:p.top})})},Na=function(j){a.each(j,function(p,E){var G=a(p).children(),L=p+"_show",Q=a(L),X=false;G.addClass("tool_button").unbind("click mousedown mouseup").each(function(ka){var fa=E[ka];Nb[fa.sel]=fa.fn;if(fa.isDefault)X=ka;ka=function(na){var sa=fa;if(na.type===
"keydown"){var Ka=a(sa.parent+"_show").hasClass("tool_button_current"),V=a(sa.parent+"_show").attr("data-curopt");a.each(j[fa.parent],function(va,La){if(La.sel==V)sa=!na.shiftKey||!Ka?La:j[fa.parent][va+1]||j[fa.parent][0]})}if(a(this).hasClass("disabled"))return false;Ja(L)&&sa.fn();var Fa;Fa=sa.icon?a.getSvgIcon(sa.icon,true):a(sa.sel).children().eq(0).clone();Fa[0].setAttribute("width",Q.width());Fa[0].setAttribute("height",Q.height());Q.children(":not(.flyout_arrow_horiz)").remove();Q.append(Fa).attr("data-curopt",
sa.sel)};a(this).mouseup(ka);fa.key&&a(document).bind("keydown",fa.key[0]+" shift+"+fa.key[0],ka)});if(X)Q.attr("data-curopt",E[X].sel);else Q.attr("data-curopt")||Q.attr("data-curopt",E[0].sel);var ea,ha=a(L).position();Q.mousedown(function(ka){if(Q.hasClass("disabled"))return false;var fa=a(p),na=ha.left+34,sa=fa.width()*-1,Ka=fa.data("shown_popop")?200:0;ea=setTimeout(function(){Q.data("isLibrary")?fa.css("left",na).show():fa.css("left",sa).show().animate({left:na},150);fa.data("shown_popop",true)},
Ka);ka.preventDefault()}).mouseup(function(){clearTimeout(ea);var ka=a(this).attr("data-curopt");if(Q.data("isLibrary")&&a(L.replace("_show","")).is(":visible"))Ja(L,true);else Ja(L)&&Nb[ka]&&Nb[ka]()})});gb();Ia()},qa=function(j,p){return a("<div>",{"class":"tools_flyout",id:j}).appendTo("#svg_editor").append(p)},Ob=function(){var j,p=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,E=document.getElementsByTagName("script")[0];for(j in E.style)if(p.test(j))return j.match(p)[0];if("WebkitOpacity"in E.style)return"Webkit";
if("KhtmlOpacity"in E.style)return"Khtml";return""}(),Wb=function(j,p){var E=["top","left","bottom","right"];j.each(function(){var G,L=a(this),Q=L.outerWidth()*(p-1),X=L.outerHeight()*(p-1);for(G=0;G<4;G++){var ea=E[G],ha=L.data("orig_margin-"+ea);if(ha==null){ha=parseInt(L.css("margin-"+ea),10);L.data("orig_margin-"+ea,ha)}ha=ha*p;if(ea==="right")ha+=Q;else if(ea==="bottom")ha+=X;L.css("margin-"+ea,ha)}})},Xb=l.setIconSize=function(j){var p=a("#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout"),
E=1;E=typeof j==="number"?j:{s:0.75,m:1,l:1.25,xl:1.5}[j];l.tool_scale=E;Ia();var G=p.parents(":hidden");G.css("visibility","hidden").show();Wb(p,E);G.css("visibility","visible").hide();a.pref("iconsize",j);a("#iconsize").val(j);G={"#tools_top":{left:50+a("#main_button").width(),height:72},"#tools_left":{width:31,top:74},"div#workarea":{left:38,top:74}};p=a("#tool_size_rules");if(p.length)p.empty();else p=a('<style id="tool_size_rules"></style>').appendTo("head");if(j!=="m"){var L="";a.each(G,function(Q,
X){Q="#svg_editor "+Q.replace(/,/g,", #svg_editor");L+=Q+"{";a.each(X,function(ea,ha){var ka;if(typeof ha==="number")ka=ha*E+"px";else if(ha[j]||ha.all)ka=ha[j]||ha.all;L+=ea+":"+ka+";"});L+="}"});G="-"+Ob.toLowerCase()+"-";L+="#tools_top .toolset, #editor_panel > *, #history_panel > *,\t\t\t\t#main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,\t\t\t\t#g_panel > *, #tool_font_size > *, .tools_flyout{"+G+"transform: scale("+E+");} #svg_editor div.toolset .toolset {"+G+"transform: scale(1); margin: 1px !important;} #svg_editor .ui-slider {"+
G+"transform: scale("+1/E+");}";p.text(L)}Ia()},kb=function(j,p,E,G){var L=a(j);p=a(p);var Q=false,X=G.dropUp;X&&a(j).addClass("dropup");p.find("li").bind("mouseup",function(){if(G.seticon){db("#cur_"+L[0].id,a(this).children());a(this).addClass("current").siblings().removeClass("current")}E.apply(this,arguments)});a(window).mouseup(function(){if(!Q){L.removeClass("down");p.hide();p.css({top:0,left:0})}Q=false});L.bind("mousedown",function(){var ea=L.offset();if(X){ea.top-=p.height();ea.left+=8}else ea.top+=
L.height();p.offset(ea);if(L.hasClass("down")){p.hide();p.css({top:0,left:0})}else{p.show();Q=true}L.toggleClass("down")}).hover(function(){Q=true}).mouseout(function(){Q=false});G.multiclick&&p.mousedown(function(){Q=true})},za=[],nb=function(j,p,E){p={alpha:p};if(j.indexOf("url(#")===0){j=(j=b.getRefElem(j))?j.cloneNode(true):a("#"+E+"_color defs *")[0];p[j.tagName]=j}else p.solidColor=j.indexOf("#")===0?j.substr(1):"none";return new a.jGraduate.Paint(p)};a("#text").focus(function(){});a("#text").blur(function(){});
b.bind("selected",function(j,p){var E=b.getMode();E==="select"&&pb();E=E=="pathedit";oa=p.length===1||p[1]==null?p[0]:null;Ua=p.length>=2&&p[1]!=null;if(oa!=null)if(!E){var G,L;if(oa!=null)switch(oa.tagName){case "use":case "image":case "foreignObject":break;case "g":case "a":var Q=null,X=oa.getElementsByTagName("*");G=0;for(L=X.length;G<L;G++){var ea=X[G].getAttribute("stroke-width");if(G===0)Q=ea;else if(Q!==ea)Q=null}a("#stroke_width").val(Q===null?"":Q);Pa.fill.update(true);Pa.stroke.update(true);
break;default:Pa.fill.update(true);Pa.stroke.update(true);a("#stroke_width").val(oa.getAttribute("stroke-width")||1);a("#stroke_style").val(oa.getAttribute("stroke-dasharray")||"none");G=oa.getAttribute("stroke-linejoin")||"miter";a("#linejoin_"+G).length!=0&&w(a("#linejoin_"+G)[0]);G=oa.getAttribute("stroke-linecap")||"butt";a("#linecap_"+G).length!=0&&w(a("#linecap_"+G)[0])}if(oa!=null){G=(oa.getAttribute("opacity")||1)*100;a("#group_opacity").val(G);a("#opac_slider").slider("option","value",G);
a("#elem_id").val(oa.id);a("#elem_class").val(oa.getAttribute("class"))}qb()}Ub(E,p);Za();b.runExtensions("selectedChanged",{elems:p,selectedElement:oa,multiselected:Ua})});b.bind("transition",function(j,p){var E=b.getMode(),G=p[0];if(G){Ua=p.length>=2&&p[1]!=null;if(!Ua)switch(E){case "rotate":E=b.getRotationAngle(G);a("#angle").val(E);a("#tool_reorient").toggleClass("disabled",E===0)}b.runExtensions("elementTransition",{elems:p})}});b.bind("changed",function(j,p){var E,G=b.getMode();G==="select"&&
pb();for(E=0;E<p.length;++E){var L=p[E],Q=L&&L.tagName==="svg";if(Q||L&&L.tagName==="g"&&svgedit.draw.Layer.CLASS_REGEX.test(L.getAttribute("class"))){Ca();Q&&Ya()}else if(L&&oa&&oa.parentNode==null)oa=L}l.showSaveWarning=true;Za();if(oa&&G==="select"){Pa.fill.update();Pa.stroke.update()}b.runExtensions("elementChanged",{elems:p})});b.bind("saved",function(j,p){l.showSaveWarning=false;p='<?xml version="1.0"?>\n'+p;if(svgedit.browser.isIE())Va(0,true);else{var E=document.createElement("a");E.href=
"data:image/svg+xml;base64,"+k.encode64(p);E.download="icon.svg";E.click();E=a.pref("save_notice_done");if(E!=="all"){var G=o.notification.saveFromBrowser.replace("%s","SVG");if(svgedit.browser.isGecko())if(p.indexOf("<defs")!==-1){G+="\n\n"+o.notification.defsFailOnSave;a.pref("save_notice_done","all");E="all"}else a.pref("save_notice_done","part");else a.pref("save_notice_done","all");E!=="part"&&win.alert(G)}}});b.bind("exported",function(j,p){var E=p.issues,G=p.exportWindowName;if(G)pa=window.open("",
G);pa.location.href=p.datauri;if(a.pref("export_notice_done")!=="all"){G=o.notification.saveFromBrowser.replace("%s",p.type);if(E.length)G+="\n\n"+o.notification.noteTheseIssues+"\n \u2022 "+E.join("\n \u2022 ");a.pref("export_notice_done","all");pa.alert(G)}});b.bind("exportedPDF",function(j,p){var E=p.exportWindowName;if(E)pa=window.open("",E);pa.location.href=p.dataurlstring});b.bind("zoomed",Vb);b.bind("contextset",function(j,p){var E="";if(p){var G="";E='<a href="#" data-root="y">'+b.getCurrentDrawing().getCurrentLayerName()+
"</a>";a(p).parentsUntil("#svgcontent > g").andSelf().each(function(){if(this.id){G+=" > "+this.id;E+=this!==p?' > <a href="#">'+this.id+"</a>":" > "+this.id}});vb=G}else vb=null;a("#cur_context_panel").toggle(!!p).html(E);yb()});b.bind("extension_added",function(j,p){function E(){if(Jb){clearTimeout(Jb);Jb=null}L||(Jb=setTimeout(function(){L=true;Xb(a.pref("iconsize"))},50))}if(p){var G=false,L=false,Q=true;if(p.langReady)if(l.langChanged){var X=a.pref("lang");p.langReady({lang:X,uiStrings:o})}else za.push(p);
var ea=function(){if(p.callback&&!G&&Q){G=true;p.callback()}},ha=[];p.context_tools&&a.each(p.context_tools,function(Ka,V){var Fa,va=V.container_id?' id="'+V.container_id+'"':"",La=a("#"+V.panel);La.length||(La=a("<div>",{id:V.panel}).appendTo("#tools_top"));switch(V.type){case "tool_button":Fa='<div class="tool_button">'+V.id+"</div>";var Ra=a(Fa).appendTo(La);V.events&&a.each(V.events,function(Qa,Ma){a(Ra).bind(Qa,Ma)});break;case "select":Fa="<label"+va+'><select id="'+V.id+'">';a.each(V.options,
function(Qa,Ma){Fa+='<option value="'+Qa+'"'+(Qa==V.defval?" selected":"")+">"+Ma+"</option>"});Fa+="</select></label>";var Ha=a(Fa).appendTo(La).find("select");a.each(V.events,function(Qa,Ma){a(Ha).bind(Qa,Ma)});break;case "button-select":Fa='<div id="'+V.id+'" class="dropdown toolset" title="'+V.title+'"><div id="cur_'+V.id+'" class="icon_label"></div><button></button></div>';va=a('<ul id="'+V.id+'_opts"></ul>').appendTo("#option_lists");V.colnum&&va.addClass("optcols"+V.colnum);a(Fa).appendTo(La).children();
ha.push({elem:"#"+V.id,list:"#"+V.id+"_opts",title:V.title,callback:V.events.change,cur:"#cur_"+V.id});break;case "input":Fa="<label"+va+'><span id="'+V.id+'_label">'+V.label+':</span><input id="'+V.id+'" title="'+V.title+'" size="'+(V.size||"4")+'" value="'+(V.defval||"")+'" type="text"/></label>';var Sa=a(Fa).appendTo(La).find("input");V.spindata&&Sa.SpinButton(V.spindata);V.events&&a.each(V.events,function(Qa,Ma){Sa.bind(Qa,Ma)})}});if(p.buttons){var ka={},fa={},na=p.svgicons,sa={};a.each(p.buttons,
function(Ka,V){var Fa,va,La,Ra=V.id;for(va=Ka;a("#"+Ra).length;)Ra=V.id+"_"+ ++va;if(na){ka[Ra]=V.icon;va=V.svgicon||V.id;if(V.type=="app_menu")fa["#"+Ra+" > div"]=va;else fa["#"+Ra]=va}else Fa=a('<img src="'+V.icon+'">');var Ha,Sa;switch(V.type){case "mode_flyout":case "mode":Ha="tool_button";Sa="#tools_left";break;case "context":Ha="tool_button";Sa="#"+V.panel;a(Sa).length||a("<div>",{id:V.panel}).appendTo("#tools_top");break;case "app_menu":Ha="";Sa="#main_menu ul"}var Qa,Ma,$a=a(V.list||V.type==
"app_menu"?"<li/>":"<div/>").attr("id",Ra).attr("title",V.title).addClass(Ha);if(!V.includeWith&&!V.list){if("position"in V)a(Sa).children().eq(V.position).length?a(Sa).children().eq(V.position).before($a):a(Sa).children().last().before($a);else $a.appendTo(Sa);if(V.type=="mode_flyout"){Ma=a($a);Ha=Ma.parent();if(!Ma.parent().hasClass("tools_flyout")){La=Ma[0].id.replace("tool_","tools_");va=Ma.clone().attr("id",La+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ma.before(va);Ha=qa(La,
Ma);Ha.data("isLibrary",true);va.data("isLibrary",true)}fa["#"+La+"_show"]=V.id;La=sa["#"+Ha[0].id]=[{sel:"#"+Ra,fn:V.events.click,icon:V.id,isDefault:true},Qa]}else V.type=="app_menu"&&$a.append("<div>").append(V.title)}else if(V.list){$a.addClass("push_button");a("#"+V.list+"_opts").append($a);if(V.isDefault){a("#cur_"+V.list).append($a.children().clone());va=V.svgicon||V.id;fa["#cur_"+V.list]=va}}else if(V.includeWith){Sa=V.includeWith;Ma=a(Sa.button);Ha=Ma.parent();if(!Ma.parent().hasClass("tools_flyout")){La=
Ma[0].id.replace("tool_","tools_");va=Ma.clone().attr("id",La+"_show").append(a("<div>",{"class":"flyout_arrow_horiz"}));Ma.before(va);Ha=qa(La,Ma)}Qa=eb.getButtonData(Sa.button);if(Sa.isDefault)fa["#"+La+"_show"]=V.id;La=sa["#"+Ha[0].id]=[{sel:"#"+Ra,fn:V.events.click,icon:V.id,key:V.key,isDefault:V.includeWith?V.includeWith.isDefault:0},Qa];Ra="position"in Sa?Sa.position:"last";Qa=Ha.children().length;if(!isNaN(Ra)&&Ra>=0&&Ra<Qa)Ha.children().eq(Ra).before($a);else{Ha.append($a);La.reverse()}}na||
$a.append(Fa);V.list||a.each(V.events,function(bc,cc){if(bc=="click"&&V.type=="mode"){V.includeWith?$a.bind(bc,cc):$a.bind(bc,function(){Ja($a)&&cc()});if(V.key){a(document).bind("keydown",V.key,cc);V.title&&$a.attr("title",V.title+" ["+V.key+"]")}}else $a.bind(bc,cc)});Na(sa)});a.each(ha,function(){kb(this.elem,this.list,this.callback,{seticon:true})});if(na)Q=false;a.svgIcons(na,{w:24,h:24,id_match:false,no_img:!svgedit.browser.isWebkit(),fallback:ka,placement:fa,callback:function(){a.pref("iconsize")!==
"m"&&E();Q=true;ea()}})}ea()}});b.textActions.setInputElem(a("#text")[0]);var cb='<div class="palette_item" data-rgb="none"></div>';a.each(["#000000","#3f3f3f","#7f7f7f","#bfbfbf","#ffffff","#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f","#7f0000","#7f3f00","#7f7f00","#3f7f00","#007f00","#007f3f","#007f7f","#003f7f","#00007f","#3f007f","#7f007f","#7f003f","#ffaaaa","#ffd4aa","#ffffaa","#d4ffaa","#aaffaa","#aaffd4","#aaffff","#aad4ff",
"#aaaaff","#d4aaff","#ffaaff","#ffaad4"],function(j,p){cb+='<div class="palette_item" style="background-color: '+p+';" data-rgb="'+p+'"></div>'});a("#palette").append(cb);cb="";a.each(["#FFF","#888","#000"],function(){cb+='<div class="color_block" style="background-color:'+this+';"></div>'});a("#bg_blocks").append(cb);var Db=a("#bg_blocks div");Db.each(function(){a(this).click(function(){Db.removeClass("cur_background");a(this).addClass("cur_background")})});A(a.pref("bkgd_color"),a.pref("bkgd_url"));
a("#image_save_opts input").val([a.pref("img_save")]);var Qb=function(j,p){if(p==null)p=j.value;a("#group_opacity").val(p);if(!j||!j.handle)a("#opac_slider").slider("option","value",p);b.setOpacity(p/100)},Gb=function(j,p,E){if(p==null)p=j.value;a("#blur").val(p);var G=false;if(!j||!j.handle){a("#blur_slider").slider("option","value",p);G=true}E?b.setBlurNoUndo(p):b.setBlur(p,G)};a("#stroke_style").change(function(){b.setStrokeAttr("stroke-dasharray",a(this).val());Aa()});a("#stroke_linejoin").change(function(){b.setStrokeAttr("stroke-linejoin",
a(this).val());Aa()});a("select").change(function(){a(this).blur()});var Mb=false;a("#selLayerNames").change(function(){var j=this.options[this.selectedIndex].value,p=o.notification.QmoveElemsToLayer.replace("%s",j),E=function(G){if(G){Mb=true;b.moveSelectedToLayer(j);b.clearSelection();Ca()}};if(j)Mb?E(true):a.confirm(p,E)});a("#font_family").change(function(){b.setFontFamily(this.value)});a("#seg_type").change(function(){b.setSegType(a(this).val())});a("#text").bind("keyup input",function(){b.setTextContent(this.value)});
a("#image_url").change(function(){Cb(this.value)});a("#link_url").change(function(){this.value.length?b.setLinkURL(this.value):b.removeHyperlink()});a("#g_title").change(function(){b.setGroupTitle(this.value)});a(".attr_changer").change(function(){var j=this.getAttribute("data-attr"),p=this.value;if(!svgedit.units.isValidUnit(j,p,oa)){a.alert(o.notification.invalidAttrValGiven);this.value=oa.getAttribute(j);return false}if(j!=="id"&&j!=="class")if(isNaN(p))p=b.convertToNum(j,p);else if(m.baseUnit!==
"px"){var E=svgedit.units.getTypeMap();if(oa[j]||b.getMode()==="pathedit"||j==="x"||j==="y")p*=E[m.baseUnit]}if(j==="id"){j=oa;b.clearSelection();j.id=p;b.addToSelection([j],true)}else b.changeSelectedAttribute(j,p);this.blur()});a("#palette").mouseover(function(){var j=a('<input type="hidden">');a(this).append(j);j.focus().remove()});a(".palette_item").mousedown(function(j){j=j.shiftKey||j.button===2?"stroke":"fill";var p=a(this).data("rgb"),E;if(p==="none"||p==="transparent"||p==="initial"){p="none";
E=new a.jGraduate.Paint}else E=new a.jGraduate.Paint({alpha:100,solidColor:p.substr(1)});Pa[j].setPaint(E);b.setColor(j,p);p!=="none"&&b.getPaintOpacity(j)!==1&&b.setPaintOpacity(j,1);qb()}).bind("contextmenu",function(j){j.preventDefault()});a("#toggle_stroke_tools").on("click",function(){a("#tools_bottom").toggleClass("expanded")});(function(){var j=null,p=null,E=ja[0],G=false,L=false;a("#svgcanvas").bind("mousemove mouseup",function(Q){if(G!==false){E.scrollLeft-=Q.clientX-j;E.scrollTop-=Q.clientY-
p;j=Q.clientX;p=Q.clientY;if(Q.type==="mouseup")G=false;return false}}).mousedown(function(Q){if(Q.button===1||L===true){G=true;j=Q.clientX;p=Q.clientY;return false}});a(window).mouseup(function(){G=false});a(document).bind("keydown","space",function(Q){b.spaceKey=L=true;Q.preventDefault()}).bind("keyup","space",function(Q){Q.preventDefault();b.spaceKey=L=false}).bind("keydown","shift",function(){b.getMode()==="zoom"&&ja.css("cursor",ub)}).bind("keyup","shift",function(){b.getMode()==="zoom"&&ja.css("cursor",
ua)});l.setPanning=function(Q){b.spaceKey=L=Q}})();(function(){var j=a("#main_icon"),p=a("#main_icon span"),E=a("#main_menu"),G=false,L=0,Q=true,X=false;a(window).mouseup(function(ha){if(!G){j.removeClass("buttondown");if(ha.target.tagName!="INPUT")E.fadeOut(200);else if(!X){X=true;a(ha.target).click(function(){E.css("margin-left","-9999px").show()})}}G=false}).mousedown(function(ha){a(ha.target).closest("div.tools_flyout, .contextMenu").length||a(".tools_flyout:visible,.contextMenu").fadeOut(250)});
p.bind("mousedown",function(){if(j.hasClass("buttondown"))E.fadeOut(200);else{E.css("margin-left",0).show();L||(L=E.height());E.css("height",0).animate({height:L},200);G=true}j.toggleClass("buttondown buttonup")}).hover(function(){G=true}).mouseout(function(){G=false});var ea=a("#main_menu li");ea.mouseover(function(){Q=a(this).css("background-color")=="rgba(0, 0, 0, 0)";ea.unbind("mouseover");Q&&ea.mouseover(function(){this.style.backgroundColor="#FFC"}).mouseout(function(){this.style.backgroundColor=
"transparent";return true})})})();l.addDropDown=function(j,p,E){if(a(j).length!=0){var G=a(j).find("button"),L=a(j).find("ul").attr("id",a(j)[0].id+"-list"),Q=false;E?a(j).addClass("dropup"):a("#option_lists").append(L);L.find("li").bind("mouseup",p);a(window).mouseup(function(){if(!Q){G.removeClass("down");L.hide()}Q=false});G.bind("mousedown",function(){if(G.hasClass("down"))L.hide();else{if(!E){var X=a(j).position();L.css({top:X.top+24,left:X.left-10})}L.show();Q=true}G.toggleClass("down")}).hover(function(){Q=
true}).mouseout(function(){Q=false})}};l.addDropDown("#font_family_dropdown",function(){a("#font_family").val(a(this).text()).change()});l.addDropDown("#opacity_dropdown",function(){if(!a(this).find("div").length){var j=parseInt(a(this).text().split("%")[0],10);Qb(false,j)}},true);a("#opac_slider").slider({start:function(){a("#opacity_dropdown li:not(.special)").hide()},stop:function(){a("#opacity_dropdown li").show();a(window).mouseup()},slide:function(j,p){Qb(p)}});l.addDropDown("#blur_dropdown",
a.noop);var Hb=false;a("#blur_slider").slider({max:10,step:0.1,stop:function(j,p){Hb=false;Gb(p);a("#blur_dropdown li").show();a(window).mouseup()},start:function(){Hb=true},slide:function(j,p){Gb(p,null,Hb)}});l.addDropDown("#zoom_dropdown",function(){var j=a(this),p=j.data("val");p?Vb(window,p):Kb({value:parseFloat(j.text())})},true);kb("#stroke_linecap","#linecap_opts",function(){w(this,true)},{dropUp:true});kb("#stroke_linejoin","#linejoin_opts",function(){w(this,true)},{dropUp:true});kb("#tool_position",
"#position_opts",function(){var j=this.id.replace("tool_pos","").charAt(0);b.alignSelectedElements(j,"page")},{multiclick:true});(function(){var j,p=function(){a(j).blur()};a("#svg_editor").find("button, select, input:not(#text)").focus(function(){j=this;Ab="toolbars";ja.mousedown(p)}).blur(function(){Ab="canvas";ja.unbind("mousedown",p);b.getMode()=="textedit"&&a("#text").focus()})})();var Yb=function(){Ja("#tool_fhpath")&&b.setMode("fhpath")},Zb=function(){Ja("#tool_line")&&b.setMode("line")},sb=
function(){Ja("#tool_square")&&b.setMode("square")},gc=function(){Ja("#tool_rect")&&b.setMode("rect")},tb=function(){Ja("#tool_fhrect")&&b.setMode("fhrect")},hc=function(){Ja("#tool_circle")&&b.setMode("circle")},ac=function(){Ja("#tool_ellipse")&&b.setMode("ellipse")},$b=function(){Ja("#tool_fhellipse")&&b.setMode("fhellipse")},zb=function(){Ja("#tool_image")&&b.setMode("image")},Wa=function(){if(Ja("#tool_zoom")){b.setMode("zoom");ja.css("cursor",ua)}},rb=function(j){var p=b.getResolution();j=j?
p.zoom*j:1;a("#zoom").val(j*100);b.setZoom(j);fb();Ya(true)},c=function(){if(Ja("#tool_zoom")){rb();pb()}},n=function(){Ja("#tool_text")&&b.setMode("text")},g=function(){Ja("#tool_path")&&b.setMode("path")},u=function(){if(oa!=null||Ua)b.deleteSelectedElements()},s=function(){if(oa!=null||Ua)b.cutSelectedElements()},F=function(){if(oa!=null||Ua)b.copySelectedElements()},q=function(){var j=b.getZoom(),p=(ja[0].scrollLeft+ja.width()/2)/j-b.contentW;j=(ja[0].scrollTop+ja.height()/2)/j-b.contentH;b.pasteElements("point",
p,j)},C=function(){oa!=null&&b.moveToTopSelectedElement()},D=function(){oa!=null&&b.moveToBottomSelectedElement()},I=function(j){oa!=null&&b.moveUpDownSelected(j)},J=function(){oa!=null&&b.convertToPath()},P=function(){oa!=null&&ab.reorient()},Z=function(){if(oa!=null||Ua)a.prompt(o.notification.enterNewLinkURL,"http://",function(j){j&&b.makeHyperlink(j)})},Y=function(j,p){if(oa!=null||Ua){if(m.gridSnapping){var E=b.getZoom()*m.snappingStep;j*=E;p*=E}b.moveSelectedElements(j,p)}},da=function(){a("#tool_node_link").toggleClass("push_button_pressed tool_button");
var j=a("#tool_node_link").hasClass("push_button_pressed");ab.linkControlPoints(j)},ga=function(){ab.getNodePoint()&&ab.clonePathNode()},ma=function(){ab.getNodePoint()&&ab.deletePathNode()},U=function(){var j=a("#tool_add_subpath"),p=!j.hasClass("push_button_pressed");j.toggleClass("push_button_pressed tool_button");ab.addSubPath(p)},M=function(){ab.opencloseSubPath()},H=function(){b.cycleElement(1)},K=function(){b.cycleElement(0)},O=function(j,p){if(!(oa==null||Ua)){j||(p*=-1);var E=parseFloat(a("#angle").val())+
p;b.setRotationAngle(E);Za()}},aa=function(){var j=m.dimensions;a.confirm(o.notification.QwantToClear,function(p){if(p){pb();b.clear();b.setResolution(j[0],j[1]);Ya(true);rb();Ca();Za();Pa.fill.prep();Pa.stroke.prep();b.runExtensions("onNewDocument")}})},ia=function(){b.setBold(!b.getBold());Za();return false},ra=function(){b.setItalic(!b.getItalic());Za();return false},Ga=function(){a.select("Select an image type for export: ",["PNG","JPEG","BMP","WEBP","PDF"],function(j){function p(){var L=o.notification.loadingImage;
m.exportWindowType==="new"&&l.exportWindowCt++;E=m.canvasName+l.exportWindowCt;pa=window.open("data:text/html;charset=utf-8,"+encodeURIComponent("<title>"+L+"</title><h1>"+L+"</h1>"),E)}if(j){var E;if(j==="PDF"){z||p();b.exportPDF(E)}else{v||p();var G=parseInt(a("#image-slider").val(),10)/100;b.rasterExport(j,G,E)}}},function(){var j=a(this);if(j.val()==="JPEG"||j.val()==="WEBP")a("#image-slider").length||a('<div><label>Quality: <input id="image-slider" type="range" min="1" max="100" value="92" /></label></div>').appendTo(j.parent());
else a("#image-slider").parent().remove()})},ca=function(){b.open()},Ea=function(){},Da=function(){if(jb.getUndoStackSize()>0){jb.undo();Ca()}},lb=function(){if(jb.getRedoStackSize()>0){jb.redo();Ca()}},ob=function(){if(Ua)b.groupSelectedElements();else oa&&b.ungroupSelectedElement()},Eb=function(){b.cloneSelectedElements(20,20)},Pb=function(){var j=this.id.replace("tool_align","").charAt(0);b.alignSelectedElements(j,a("#align_relative_to").val())},Fb=function(){a("#tool_wireframe").toggleClass("push_button_pressed tool_button");
ja.toggleClass("wireframe");if(!Ib){var j=a("#wireframe_rules");j.length?j.empty():a('<style id="wireframe_rules"></style>').appendTo("head");fb()}};a("#svg_docprops_container, #svg_prefs_container").draggable({cancel:"button,fieldset",containment:"window"});var wc=function(){if(!hb){hb=true;a("#image_save_opts input").val([a.pref("img_save")]);var j=b.getResolution();if(m.baseUnit!=="px"){j.w=svgedit.units.convertUnit(j.w)+m.baseUnit;j.h=svgedit.units.convertUnit(j.h)+m.baseUnit}a("#canvas_width").val(j.w);
a("#canvas_height").val(j.h);a("#canvas_title").val(b.getDocumentTitle());a("#svg_docprops").show()}},xc=function(){if(!Ba){Ba=true;a("#main_menu").hide();var j=a("#bg_blocks div"),p=f.bkgd_color,E=a.pref("bkgd_url");j.each(function(){var G=a(this),L=G.css("background-color")==p;G.toggleClass("cur_background",L);L&&a("#canvas_bg_url").removeClass("cur_background")});p||j.eq(0).addClass("cur_background");E&&a("#canvas_bg_url").val(E);a("#grid_snapping_on").prop("checked",m.gridSnapping);a("#grid_snapping_step").attr("value",
m.snappingStep);a("#grid_color").attr("value",m.gridColor);a("#svg_prefs").show()}},ic=function(){a("#svg_source_editor").hide();mb=false;a("#svg_source_textarea").blur()},nc=function(){if(mb){var j=function(){b.clearSelection();ic();rb();Ca();yb();Pa.fill.prep();Pa.stroke.prep()};b.setSvgString(a("#svg_source_textarea").val())?j():a.confirm(o.notification.QerrorsRevertToSource,function(p){if(!p)return false;j()});pb()}},oc=function(){a("#svg_docprops").hide();a("#canvas_width,#canvas_height").removeAttr("disabled");
a("#resolution")[0].selectedIndex=0;a("#image_save_opts input").val([a.pref("img_save")]);hb=false},pc=function(){a("#svg_prefs").hide();Ba=false},yc=function(){var j=a("#canvas_title").val();yb(j);b.setDocumentTitle(j);j=a("#canvas_width");var p=j.val(),E=a("#canvas_height"),G=E.val();if(p!="fit"&&!svgedit.units.isValidUnit("width",p)){a.alert(o.notification.invalidAttrValGiven);j.parent().addClass("error");return false}j.parent().removeClass("error");if(G!="fit"&&!svgedit.units.isValidUnit("height",
G)){a.alert(o.notification.invalidAttrValGiven);E.parent().addClass("error");return false}E.parent().removeClass("error");if(!b.setResolution(p,G)){a.alert(o.notification.noContentToFitTo);return false}a.pref("img_save",a("#image_save_opts :checked").val());Ya();oc()},zc=l.savePreferences=function(){var j=a("#bg_blocks div.cur_background").css("background-color")||"#FFF";A(j,a("#canvas_bg_url").val());j=a("#lang_select").val();j!==a.pref("lang")&&l.putLocale(j,Oa);Xb(a("#iconsize").val());m.gridSnapping=
a("#grid_snapping_on")[0].checked;m.snappingStep=a("#grid_snapping_step").val();m.gridColor=a("#grid_color").val();m.showRulers=a("#show_rulers")[0].checked;a("#rulers").toggle(m.showRulers);m.showRulers&&W();m.baseUnit=a("#base_unit").val();b.setConfig(m);Ya();pc()},dc=a.noop,qc=function(){a("#dialog_box").hide();if(!mb&&!hb&&!Ba)vb&&b.leaveContext();else{if(mb)wb!==a("#svg_source_textarea").val()?a.confirm(o.notification.QignoreSourceChanges,function(j){j&&ic()}):ic();else if(hb)oc();else Ba&&pc();
dc()}},rc={width:a(window).width(),height:a(window).height()};svgedit.browser.isIE()&&function(){dc=function(){if(ja[0].scrollLeft===0&&ja[0].scrollTop===0){ja[0].scrollLeft=Lb.left;ja[0].scrollTop=Lb.top}};Lb={left:ja[0].scrollLeft,top:ja[0].scrollTop};a(window).resize(dc);l.ready(function(){setTimeout(function(){dc()},500)});ja.scroll(function(){Lb={left:ja[0].scrollLeft,top:ja[0].scrollTop}})}();a(window).resize(function(){a.each(rc,function(j,p){var E=a(window)[j]();ja[0]["scroll"+(j==="width"?
"Left":"Top")]-=(E-p)/2;rc[j]=E});Ia()});(function(){ja.scroll(function(){if(a("#ruler_x").length!=0)a("#ruler_x")[0].scrollLeft=ja[0].scrollLeft;if(a("#ruler_y").length!=0)a("#ruler_y")[0].scrollTop=ja[0].scrollTop})})();a("#url_notice").click(function(){a.alert(this.title)});a("#change_image_url").click(S);(function(){var j="";a.each(["clear","open","save","source","delete","delete_multi","paste","clone","clone_multi","move_top","move_bottom"],function(p,E){j+=(p?",":"")+"#tool_"+E});a(j).mousedown(function(){a(this).addClass("tool_button_current")}).bind("mousedown mouseout",
function(){a(this).removeClass("tool_button_current")});a("#tool_undo, #tool_redo").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("tool_button_current")}).bind("mousedown mouseout",function(){a(this).removeClass("tool_button_current")})})();if(svgedit.browser.isMac()&&!window.opera){var ec=["tool_clear","tool_save","tool_source","tool_undo","tool_redo","tool_clone"];for(wa=ec.length;wa--;){var jc=document.getElementById(ec[wa]);if(jc){var kc=jc.title,sc=kc.indexOf("Ctrl+");jc.title=
[kc.substr(0,sc),"Cmd+",kc.substr(sc+5)].join("")}}}var tc=function(j){var p=j.attr("id")=="stroke_color"?"stroke":"fill",E=Pa[p].paint,G=p=="stroke"?"Pick a Stroke Paint and Opacity":"Pick a Fill Paint and Opacity";j=j.offset();a("#color_picker").draggable({cancel:".jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker",containment:"window"}).css(m.colorPickerCSS||{left:j.left-140,bottom:40}).jGraduate({paint:E,window:{pickerTitle:G},images:{clientPath:m.jGraduatePath},newstop:"inverse"},
function(L){E=new a.jGraduate.Paint(L);Pa[p].setPaint(E);b.setPaint(p,E);a("#color_picker").hide()},function(){a("#color_picker").hide()})};wa=function(j,p){var E,G,L=m[p==="fill"?"initFill":"initStroke"],Q=(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg"><rect width="16.5" height="16.5"\t\t\t\t\tfill="#'+L.color+'" opacity="'+L.opacity+'"/>\t\t\t\t\t<defs><linearGradient id="gradbox_"/></defs></svg>',"text/xml").documentElement;Q=a(j)[0].appendChild(document.importNode(Q,
true));Q.setAttribute("width",16.5);this.rect=Q.firstChild;this.defs=Q.getElementsByTagName("defs")[0];this.grad=this.defs.firstChild;this.paint=new a.jGraduate.Paint({solidColor:L.color});this.type=p;this.setPaint=function(X,ea){this.paint=X;var ha="none",ka=X.type,fa=X.alpha/100;switch(ka){case "solidColor":ha=X[ka]!="none"?"#"+X[ka]:X[ka];break;case "linearGradient":case "radialGradient":this.defs.removeChild(this.grad);this.grad=this.defs.appendChild(X[ka]);ha="url(#"+(this.grad.id="gradbox_"+
this.type)+")"}this.rect.setAttribute("fill",ha);this.rect.setAttribute("opacity",fa);if(ea){b.setColor(this.type,E,true);b.setPaintOpacity(this.type,G,true)}};this.update=function(X){if(oa){var ea,ha,ka=this.type;switch(oa.tagName){case "use":case "image":case "foreignObject":return;case "g":case "a":var fa=null,na=oa.getElementsByTagName("*");ea=0;for(ha=na.length;ea<ha;ea++){var sa=na[ea].getAttribute(ka);if(ea===0)fa=sa;else if(fa!==sa){fa=null;break}}if(fa===null){E=null;return}E=fa;G=1;break;
default:G=parseFloat(oa.getAttribute(ka+"-opacity"));if(isNaN(G))G=1;ea=ka==="fill"?"black":"none";E=oa.getAttribute(ka)||ea}if(X){b.setColor(ka,E,true);b.setPaintOpacity(ka,G,true)}G*=100;this.setPaint(nb(E,G,ka))}};this.prep=function(){switch(this.paint.type){case "linearGradient":case "radialGradient":var X=new a.jGraduate.Paint({copy:this.paint});b.setPaint(p,X)}}};Pa.fill=new wa("#fill_color","fill");Pa.stroke=new wa("#stroke_color","stroke");a("#stroke_width").val(m.initStroke.width);a("#group_opacity").val(m.initOpacity*
100);wa=Pa.fill.rect.cloneNode(false);wa.setAttribute("style","vector-effect:non-scaling-stroke");Ib=wa.style.vectorEffect==="non-scaling-stroke";wa.removeAttribute("style");wa=Pa.fill.rect.ownerDocument.createElementNS(svgedit.NS.SVG,"feGaussianBlur");wa.stdDeviationX===undefined&&a("#tool_blur").hide();a(wa).remove();(function(){var j="-"+Ob.toLowerCase()+"-zoom-",p=j+"in";ja.css("cursor",p);if(ja.css("cursor")===p){ua=p;ub=j+"out"}ja.css("cursor","auto")})();setTimeout(function(){b.embedImage("images/logo.png",
function(j){if(!j){a("#image_save_opts [value=embed]").attr("disabled","disabled");a("#image_save_opts input").val(["ref"]);a.pref("img_save","ref");a("#image_opt_embed").css("color","#666").attr("title",o.notification.featNotSupported)}})},1E3);a("#fill_color, #tool_fill .icon_label").click(function(){tc(a("#fill_color"));qb()});a("#stroke_color, #tool_stroke .icon_label").click(function(){tc(a("#stroke_color"));qb()});a("#group_opacityLabel").click(function(){a("#opacity_dropdown button").mousedown();
a(window).mouseup()});a("#zoomLabel").click(function(){a("#zoom_dropdown button").mousedown();a(window).mouseup()});a("#tool_move_top").mousedown(function(j){a("#tools_stacking").show();j.preventDefault()});a(".layer_button").mousedown(function(){a(this).addClass("layer_buttonpressed")}).mouseout(function(){a(this).removeClass("layer_buttonpressed")}).mouseup(function(){a(this).removeClass("layer_buttonpressed")});a(".push_button").mousedown(function(){a(this).hasClass("disabled")||a(this).addClass("push_button_pressed").removeClass("push_button")}).mouseout(function(){a(this).removeClass("push_button_pressed").addClass("push_button")}).mouseup(function(){a(this).removeClass("push_button_pressed").addClass("push_button")});
a("#layer_new").click(function(){var j,p=b.getCurrentDrawing().getNumLayers();do j=o.layers.layer+" "+ ++p;while(b.getCurrentDrawing().hasLayer(j));a.prompt(o.notification.enterUniqueLayerName,j,function(E){if(E)if(b.getCurrentDrawing().hasLayer(E))a.alert(o.notification.dupeLayerName);else{b.createLayer(E);Za();Ca()}})});a("#layer_delete").click(R);a("#layer_up").click(function(){ba(-1)});a("#layer_down").click(function(){ba(1)});a("#layer_rename").click(function(){var j=a("#layerlist tr.layersel td.layername").text();
a.prompt(o.notification.enterNewLayerName,"",function(p){if(p)if(j==p||b.getCurrentDrawing().hasLayer(p))a.alert(o.notification.layerHasThatName);else{b.renameCurrentLayer(p);Ca()}})});var Rb=-1,fc=false,lc=false,uc=function(j){var p=a("#ruler_x");a("#sidepanels").width("+="+j);a("#layerpanel").width("+="+j);p.css("right",parseInt(p.css("right"),10)+j);ja.css("right",parseInt(ja.css("right"),10)+j);b.runExtensions("workareaResized")},vc=function(j){if(lc)if(Rb!=-1){fc=true;j=Rb-j.pageX;var p=a("#sidepanels").width();
if(p+j>300)j=300-p;else if(p+j<2)j=2-p;if(j!=0){Rb-=j;uc(j)}}},mc=function(j){var p=a("#sidepanels").width();uc((p>2||j?2:150)-p)};a("#sidepanel_handle").mousedown(function(j){Rb=j.pageX;a(window).mousemove(vc);lc=false;setTimeout(function(){lc=true},20)}).mouseup(function(){fc||mc();Rb=-1;fc=false});a(window).mouseup(function(){Rb=-1;fc=false;a("#svg_editor").unbind("mousemove",vc)});Ca();a(window).bind("load resize",function(){ja.css("line-height",ja.height()+"px")});a("#resolution").change(function(){var j=
a("#canvas_width,#canvas_height");if(this.selectedIndex)if(this.value=="content")j.val("fit").attr("disabled","disabled");else{var p=this.value.split("x");a("#canvas_width").val(p[0]);a("#canvas_height").val(p[1]);j.removeAttr("disabled")}else a("#canvas_width").val()=="fit"&&j.removeAttr("disabled").val(100)});a("input,select").attr("autocomplete","off");eb=function(){var j=[{sel:"#tool_select",fn:Bb,evt:"click",key:["V",true]},{sel:"#tool_fhpath",fn:Yb,evt:"click",key:["Q",true]},{sel:"#tool_line",
fn:Zb,evt:"click",key:["L",true]},{sel:"#tool_rect",fn:gc,evt:"mouseup",key:["R",true],parent:"#tools_rect",icon:"rect"},{sel:"#tool_square",fn:sb,evt:"mouseup",parent:"#tools_rect",icon:"square"},{sel:"#tool_fhrect",fn:tb,evt:"mouseup",parent:"#tools_rect",icon:"fh_rect"},{sel:"#tool_ellipse",fn:ac,evt:"mouseup",key:["E",true],parent:"#tools_ellipse",icon:"ellipse"},{sel:"#tool_circle",fn:hc,evt:"mouseup",parent:"#tools_ellipse",icon:"circle"},{sel:"#tool_fhellipse",fn:$b,evt:"mouseup",parent:"#tools_ellipse",
icon:"fh_ellipse"},{sel:"#tool_path",fn:g,evt:"click",key:["P",true]},{sel:"#tool_text",fn:n,evt:"click",key:["T",true]},{sel:"#tool_image",fn:zb,evt:"mouseup"},{sel:"#tool_zoom",fn:Wa,evt:"mouseup",key:["Z",true]},{sel:"#tool_clear",fn:aa,evt:"mouseup",key:["N",true]},{sel:"#tool_save",fn:function(){if(mb)nc();else{var E={images:a.pref("img_save"),round_digits:6};b.save(E)}},evt:"mouseup",key:["S",true]},{sel:"#tool_export",fn:Ga,evt:"mouseup"},{sel:"#tool_open",fn:ca,evt:"mouseup",key:["O",true]},
{sel:"#tool_import",fn:Ea,evt:"mouseup"},{sel:"#tool_source",fn:Va,evt:"click",key:["U",true]},{sel:"#tool_wireframe",fn:Fb,evt:"click",key:["F",true]},{sel:"#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel",fn:qc,evt:"click",key:["esc",false,false],hidekey:true},{sel:"#tool_source_save",fn:nc,evt:"click"},{sel:"#tool_docprops_save",fn:yc,evt:"click"},{sel:"#tool_docprops",fn:wc,evt:"mouseup"},{sel:"#tool_prefs_save",fn:zc,evt:"click"},{sel:"#tool_prefs_option",fn:function(){xc();
return false},evt:"mouseup"},{sel:"#tool_delete,#tool_delete_multi",fn:u,evt:"click",key:["del/backspace",true]},{sel:"#tool_reorient",fn:P,evt:"click"},{sel:"#tool_node_link",fn:da,evt:"click"},{sel:"#tool_node_clone",fn:ga,evt:"click"},{sel:"#tool_node_delete",fn:ma,evt:"click"},{sel:"#tool_openclose_path",fn:M,evt:"click"},{sel:"#tool_add_subpath",fn:U,evt:"click"},{sel:"#tool_move_top",fn:C,evt:"click",key:"ctrl+shift+]"},{sel:"#tool_move_bottom",fn:D,evt:"click",key:"ctrl+shift+["},{sel:"#tool_topath",
fn:J,evt:"click"},{sel:"#tool_make_link,#tool_make_link_multi",fn:Z,evt:"click"},{sel:"#tool_undo",fn:Da,evt:"click"},{sel:"#tool_redo",fn:lb,evt:"click"},{sel:"#tool_clone,#tool_clone_multi",fn:Eb,evt:"click",key:["D",true]},{sel:"#tool_group_elements",fn:ob,evt:"click",key:["G",true]},{sel:"#tool_ungroup",fn:ob,evt:"click"},{sel:"#tool_unlink_use",fn:ob,evt:"click"},{sel:"[id^=tool_align]",fn:Pb,evt:"click"},{sel:"#tool_bold",fn:ia,evt:"mousedown"},{sel:"#tool_italic",fn:ra,evt:"mousedown"},{sel:"#sidepanel_handle",
fn:mc,key:["X"]},{sel:"#copy_save_done",fn:qc,evt:"click"},{key:"ctrl+left",fn:function(){O(0,1)}},{key:"ctrl+right",fn:function(){O(1,1)}},{key:"ctrl+shift+left",fn:function(){O(0,5)}},{key:"ctrl+shift+right",fn:function(){O(1,5)}},{key:"shift+O",fn:K},{key:"shift+P",fn:H},{key:[ib+"up",true],fn:function(){rb(2)}},{key:[ib+"down",true],fn:function(){rb(0.5)}},{key:[ib+"]",true],fn:function(){I("Up")}},{key:[ib+"[",true],fn:function(){I("Down")}},{key:["up",true],fn:function(){Y(0,-1)}},{key:["down",
true],fn:function(){Y(0,1)}},{key:["left",true],fn:function(){Y(-1,0)}},{key:["right",true],fn:function(){Y(1,0)}},{key:"shift+up",fn:function(){Y(0,-10)}},{key:"shift+down",fn:function(){Y(0,10)}},{key:"shift+left",fn:function(){Y(-10,0)}},{key:"shift+right",fn:function(){Y(10,0)}},{key:["alt+up",true],fn:function(){b.cloneSelectedElements(0,-1)}},{key:["alt+down",true],fn:function(){b.cloneSelectedElements(0,1)}},{key:["alt+left",true],fn:function(){b.cloneSelectedElements(-1,0)}},{key:["alt+right",
true],fn:function(){b.cloneSelectedElements(1,0)}},{key:["alt+shift+up",true],fn:function(){b.cloneSelectedElements(0,-10)}},{key:["alt+shift+down",true],fn:function(){b.cloneSelectedElements(0,10)}},{key:["alt+shift+left",true],fn:function(){b.cloneSelectedElements(-10,0)}},{key:["alt+shift+right",true],fn:function(){b.cloneSelectedElements(10,0)}},{key:"A",fn:function(){b.selectAllInCurrentLayer()}},{key:ib+"z",fn:Da},{key:ib+"shift+z",fn:lb},{key:ib+"y",fn:lb},{key:ib+"x",fn:s},{key:ib+"c",fn:F},
{key:ib+"v",fn:q}],p={"4/Shift+4":"#tools_rect_show","5/Shift+5":"#tools_ellipse_show"};return{setAll:function(){var E={};a.each(j,function(G,L){var Q;if(L.sel){Q=a(L.sel);if(Q.length==0)return true;if(L.evt){if(svgedit.browser.isTouch()&&L.evt==="click")L.evt="mousedown";Q[L.evt](L.fn)}if(L.parent&&a(L.parent+"_show").length!=0){var X=a(L.parent);X.length||(X=qa(L.parent.substr(1)));X.append(Q);a.isArray(E[L.parent])||(E[L.parent]=[]);E[L.parent].push(L)}}if(L.key){var ea=L.fn,ha=false;if(a.isArray(L.key)){X=
L.key[0];if(L.key.length>1)ha=L.key[1]}else X=L.key;X+="";a.each(X.split("/"),function(fa,na){a(document).bind("keydown",na,function(sa){ea();ha&&sa.preventDefault();return false})});if(L.sel&&!L.hidekey&&Q.attr("title")){var ka=Q.attr("title").split("[")[0]+" ("+X+")";p[X]=L.sel;Q.parents("#main_menu").length||Q.attr("title",ka)}}});Na(E);a(".attr_changer, #image_url").bind("keydown","return",function(G){a(this).change();G.preventDefault()});a(window).bind("keydown","tab",function(G){if(Ab==="canvas"){G.preventDefault();
H()}}).bind("keydown","shift+tab",function(G){if(Ab==="canvas"){G.preventDefault();K()}});a("#tool_zoom").dblclick(c)},setTitles:function(){a.each(p,function(E,G){var L=a(G).parents("#main_menu").length;a(G).each(function(){var Q;Q=L?a(this).text().split(" [")[0]:this.title.split(" [")[0];var X="";a.each(E.split("/"),function(ea,ha){var ka=ha.split("+"),fa="";if(ka.length>1){fa=ka[0]+"+";ha=ka[1]}X+=(ea?"/":"")+fa+(o["key_"+ha]||ha)});if(L)this.lastChild.textContent=Q+" ["+X+"]";else this.title=Q+
" ["+X+"]"})})},getButtonData:function(E){var G;a.each(j,function(L,Q){if(Q.sel===E)G=Q});return G}}}();eb.setAll();l.ready(function(){var j=m.initTool,p=a("#tools_left, #svg_editor .tools_flyout"),E=p.find("#tool_"+j);j=p.find("#"+j);(E.length?E:j.length?j:a("#tool_select")).click().mouseup();m.wireframe&&a("#tool_wireframe").click();m.showlayers&&mc();a("#rulers").toggle(!!m.showRulers);if(m.showRulers)a("#show_rulers")[0].checked=true;m.baseUnit&&a("#base_unit").val(m.baseUnit);if(m.gridSnapping)a("#grid_snapping_on")[0].checked=
true;m.snappingStep&&a("#grid_snapping_step").val(m.snappingStep);m.gridColor&&a("#grid_color").val(m.gridColor)});a("#rect_rx").SpinButton({min:0,max:1E3,callback:function(j){b.setRectRadius(j.value)}});a("#stroke_width").SpinButton({min:0,max:99,smallStep:0.1,callback:function(j){var p=j.value;if(p==0&&oa&&["line","polyline"].indexOf(oa.nodeName)>=0)p=j.value=1;b.setStrokeWidth(p)}});a("#angle").SpinButton({min:-180,max:180,step:5,callback:function(j){b.setRotationAngle(j.value);a("#tool_reorient").toggleClass("disabled",
parseInt(j.value,10)===0)}});a("#font_size").SpinButton({min:0.001,stepfunc:function(j,p){var E=Number(j.value),G=E+p,L=G>=E;if(p===0)return E;if(E>=24){if(L)return Math.round(E*1.1);return Math.round(E/1.1)}if(E<=1){if(L)return E*2;return E/2}return G},callback:function(j){b.setFontSize(j.value)}});a("#group_opacity").SpinButton({min:0,max:100,step:5,callback:Qb});a("#blur").SpinButton({min:0,max:10,step:0.1,callback:Gb});a("#zoom").SpinButton({min:0.001,max:1E4,step:50,stepfunc:function(j,p){var E=
Number(j.value);if(E===0)return 100;var G=E+p;if(p===0)return E;if(E>=100)return G;if(G>=E)return E*2;return E/2},callback:Kb}).val(b.getZoom()*100);a("#workarea").contextMenu({menu:"cmenu_canvas",inSpeed:0},function(j){switch(j){case "delete":u();break;case "cut":s();break;case "copy":F();break;case "paste":b.pasteElements();break;case "paste_in_place":b.pasteElements("in_place");break;case "group":case "group_elements":b.groupSelectedElements();break;case "ungroup":b.ungroupSelectedElement();break;
case "move_front":C();break;case "move_up":I("Up");break;case "move_down":I("Down");break;case "move_back":D();break;default:svgedit.contextmenu&&svgedit.contextmenu.hasCustomHandler(j)&&svgedit.contextmenu.getCustomHandler(j).call()}b.clipBoard.length&&la.enableContextMenuItems("#paste,#paste_in_place")});wa=function(j){switch(j){case "dupe":T();break;case "delete":R();break;case "merge_down":if(a("#layerlist tr.layersel").index()!=b.getCurrentDrawing().getNumLayers()-1){b.mergeLayer();Za();Ca()}break;
case "merge_all":b.mergeAllLayers();Za();Ca()}};a("#layerlist").contextMenu({menu:"cmenu_layers",inSpeed:0},wa);a("#layer_moreopts").contextMenu({menu:"cmenu_layers",inSpeed:0,allowLeft:true},wa);a(".contextMenu li").mousedown(function(j){j.preventDefault()});a("#cmenu_canvas li").disableContextMenu();la.enableContextMenuItems("#delete,#cut,#copy");window.addEventListener("beforeunload",function(j){if(jb.getUndoStackSize()===0)l.showSaveWarning=false;if(!m.no_save_warning&&l.showSaveWarning)return j.returnValue=
o.notification.unsavedChanges},false);l.openPrep=function(j){a("#main_menu").hide();jb.getUndoStackSize()===0?j(true):a.confirm(o.notification.QwantToOpen,j)};if(window.FileReader){wa=function(j){a.process_cancel(o.notification.loadingImage);j.stopPropagation();j.preventDefault();a("#workarea").removeAttr("style");a("#main_menu").hide();if(j=j.type=="drop"?j.dataTransfer.files[0]:this.files[0]){if(j.type.indexOf("image")!=-1){var p;if(j.type.indexOf("svg")!=-1){p=new FileReader;p.onloadend=function(E){E=
b.importSvgString(E.target.result,true);b.ungroupSelectedElement();b.ungroupSelectedElement();b.groupSelectedElements();b.alignSelectedElements("m","page");b.alignSelectedElements("c","page");b.selectOnly([E]);a("#dialog_box").hide()};p.readAsText(j)}else{p=new FileReader;p.onloadend=function(E){var G=100,L=100,Q=new Image;Q.src=E.target.result;Q.style.opacity=0;Q.onload=function(){G=Q.offsetWidth;L=Q.offsetHeight;var X=b.addSvgElementFromJson({element:"image",attr:{x:0,y:0,width:G,height:L,id:b.getNextId(),
style:"pointer-events:inherit"}});b.setHref(X,E.target.result);b.selectOnly([X]);b.alignSelectedElements("m","page");b.alignSelectedElements("c","page");Za();a("#dialog_box").hide()}};p.readAsDataURL(j)}}}else a("#dialog_box").hide()};ja[0].addEventListener("dragenter",ya,false);ja[0].addEventListener("dragover",ta,false);ja[0].addEventListener("dragleave",Ta,false);ja[0].addEventListener("drop",wa,false);ec=a('<input type="file">').change(function(){var j=this;l.openPrep(function(p){if(p){b.clear();
if(j.files.length===1){a.process_cancel(o.notification.loadingImage);p=new FileReader;p.onloadend=function(E){t(E.target.result);Ya()};p.readAsText(j.files[0])}}})});a("#tool_open").show().prepend(ec);wa=a('<input type="file">').change(wa);a("#tool_import").show().prepend(wa)}Ya(true);a(function(){window.svgCanvas=b;b.ready=l.ready});l.setLang=function(j,p){l.langChanged=true;a.pref("lang",j);a("#lang_select").val(j);if(p){var E=a("#layerlist tr.layersel td.layername").text()==o.common.layer+" 1";
a.extend(o,p);b.setUiStrings(p);eb.setTitles();if(E){b.renameCurrentLayer(o.common.layer+" 1");Ca()}if(za.length)for(;za.length;)za.shift().langReady({lang:j,uiStrings:o});else b.runExtensions("langReady",{lang:j,uiStrings:o});b.runExtensions("langChanged",j);gb();a.each({"#stroke_color":"#tool_stroke .icon_label, #tool_stroke .color_block","#fill_color":"#tool_fill label, #tool_fill .color_block","#linejoin_miter":"#cur_linejoin","#linecap_butt":"#cur_linecap"},function(G,L){a(L).attr("title",a(G)[0].title)});
a("#multiselected_panel div[id^=tool_align]").each(function(){a("#tool_pos"+this.id.substr(10))[0].title=this.title})}}};l.ready=function(r){e?r():N.push(r)};l.runCallbacks=function(){a.each(N,function(){this()});e=true};l.loadFromString=function(r){l.ready(function(){t(r)})};l.disableUI=function(){};l.loadFromURL=function(r,w){w||(w={});var A=w.cache,S=w.callback;l.ready(function(){a.ajax({url:r,dataType:"text",cache:!!A,beforeSend:function(){a.process_cancel(o.notification.loadingImage)},success:function(W){t(W,
S)},error:function(W,R,T){W.status!=404&&W.responseText?t(W.responseText,S):a.alert(o.notification.URLloadFail+": \n"+T,S)},complete:function(){a("#dialog_box").hide()}})})};l.loadFromDataURI=function(r){l.ready(function(){var w=false,A=r.match(/^data:image\/svg\+xml;base64,/);if(A)w=true;else A=r.match(/^data:image\/svg\+xml(?:;(?:utf8)?)?,/);if(A)A=A[0];A=r.slice(A.length);t(w?k.decode64(A):decodeURIComponent(A))})};l.addExtension=function(){var r=arguments;a(function(){b&&b.addExtension.apply(this,
r)})};return l}(jQuery);$(svgEditor.init)}})();var svgEditor=function(a,t){function l(d,k,e){var v,z,N,B,f,m=a("#svg_editor").parent();for(z in k){(N=k[z])||console.log(z);if(e)z="#"+z;v=m.find(z);if(v.length){B=m.find(z)[0];switch(d){case "content":for(v=0;v<B.childNodes.length;v++){f=B.childNodes[v];if(f.nodeType===3&&f.textContent.replace(/\s/g,"")){f.textContent=N;break}}break;case "title":B.title=N}}else console.log("Missing: "+z)}}var b;t.readLang=function(d){var k=t.canvas.runExtensions("addlangData",b,true);a.each(k,function(h,o){if(o.data)d=
a.merge(d,o.data)});if(d.tools){var e=d.tools;k=d.properties;var v=d.config,z=d.layers,N=d.common,B=d.ui;l("content",{curve_segments:k.curve_segments,fitToContent:e.fitToContent,fit_to_all:e.fit_to_all,fit_to_canvas:e.fit_to_canvas,fit_to_layer_content:e.fit_to_layer_content,fit_to_sel:e.fit_to_sel,icon_large:v.icon_large,icon_medium:v.icon_medium,icon_small:v.icon_small,icon_xlarge:v.icon_xlarge,image_opt_embed:v.image_opt_embed,image_opt_ref:v.image_opt_ref,includedImages:v.included_images,largest_object:e.largest_object,
layersLabel:z.layers,page:e.page,relativeToLabel:e.relativeTo,selLayerLabel:z.move_elems_to,selectedPredefined:v.select_predefined,selected_objects:e.selected_objects,smallest_object:e.smallest_object,straight_segments:k.straight_segments,svginfo_bg_url:v.editor_img_url+":",svginfo_bg_note:v.editor_bg_note,svginfo_change_background:v.background,svginfo_dim:v.doc_dims,svginfo_editor_prefs:v.editor_prefs,svginfo_height:N.height,svginfo_icons:v.icon_size,svginfo_image_props:v.image_props,svginfo_lang:v.language,
svginfo_title:v.doc_title,svginfo_width:N.width,tool_docprops_cancel:N.cancel,tool_docprops_save:N.ok,tool_source_cancel:N.cancel,tool_source_save:N.ok,tool_prefs_cancel:N.cancel,tool_prefs_save:N.ok,sidepanel_handle:z.layers.split("").join(" "),tool_clear:e.new_doc,tool_docprops:e.docprops,tool_export:e.export_img,tool_import:e.import_doc,tool_imagelib:e.imagelib,tool_open:e.open_doc,tool_save:e.save_doc,svginfo_units_rulers:v.units_and_rulers,svginfo_rulers_onoff:v.show_rulers,svginfo_unit:v.base_unit,
svginfo_grid_settings:v.grid,svginfo_snap_onoff:v.snapping_onoff,svginfo_snap_step:v.snapping_stepsize,svginfo_grid_color:v.grid_color},true);var f,m={};for(f in d.shape_cats)m['#shape_cats [data-cat="'+f+'"]']=d.shape_cats[f];setTimeout(function(){l("content",m)},2E3);var i={};a.each(["cut","copy","paste","paste_in_place","delete","group","ungroup","move_front","move_up","move_down","move_back"],function(){i['#cmenu_canvas a[href="#'+this+'"]']=e[this]});a.each(["dupe","merge_down","merge_all"],
function(){i['#cmenu_layers a[href="#'+this+'"]']=z[this]});i['#cmenu_layers a[href="#delete"]']=z.del;l("content",i);l("title",{align_relative_to:e.align_relative_to,circle_cx:k.circle_cx,circle_cy:k.circle_cy,circle_r:k.circle_r,cornerRadiusLabel:k.corner_radius,ellipse_cx:k.ellipse_cx,ellipse_cy:k.ellipse_cy,ellipse_rx:k.ellipse_rx,ellipse_ry:k.ellipse_ry,fill_color:k.fill_color,font_family:k.font_family,idLabel:k.id,image_height:k.image_height,image_url:k.image_url,image_width:k.image_width,layer_delete:z.del,
layer_down:z.move_down,layer_new:z["new"],layer_rename:z.rename,layer_moreopts:N.more_opts,layer_up:z.move_up,line_x1:k.line_x1,line_x2:k.line_x2,line_y1:k.line_y1,line_y2:k.line_y2,linecap_butt:k.linecap_butt,linecap_round:k.linecap_round,linecap_square:k.linecap_square,linejoin_bevel:k.linejoin_bevel,linejoin_miter:k.linejoin_miter,linejoin_round:k.linejoin_round,main_icon:e.main_menu,mode_connect:e.mode_connect,tools_shapelib_show:e.mode_shapelib,palette:B.palette_info,zoom_panel:B.zoom_level,
path_node_x:k.node_x,path_node_y:k.node_y,rect_height_tool:k.rect_height,rect_width_tool:k.rect_width,seg_type:k.seg_type,selLayerNames:z.move_selected,selected_x:k.pos_x,selected_y:k.pos_y,stroke_color:k.stroke_color,stroke_style:k.stroke_style,stroke_width:k.stroke_width,svginfo_title:v.doc_title,text:k.text_contents,toggle_stroke_tools:B.toggle_stroke_tools,tool_add_subpath:e.add_subpath,tool_alignbottom:e.align_bottom,tool_aligncenter:e.align_center,tool_alignleft:e.align_left,tool_alignmiddle:e.align_middle,
tool_alignright:e.align_right,tool_aligntop:e.align_top,tool_angle:k.angle,tool_blur:k.blur,tool_bold:k.bold,tool_circle:e.mode_circle,tool_clone:e.clone,tool_clone_multi:e.clone,tool_delete:e.del,tool_delete_multi:e.del,tool_ellipse:e.mode_ellipse,tool_eyedropper:e.mode_eyedropper,tool_fhellipse:e.mode_fhellipse,tool_fhpath:e.mode_fhpath,tool_fhrect:e.mode_fhrect,tool_font_size:k.font_size,tool_group_elements:e.group_elements,tool_make_link:e.make_link,tool_link_url:e.set_link_url,tool_image:e.mode_image,
tool_italic:k.italic,tool_line:e.mode_line,tool_move_bottom:e.move_bottom,tool_move_top:e.move_top,tool_node_clone:e.node_clone,tool_node_delete:e.node_delete,tool_node_link:e.node_link,tool_opacity:k.opacity,tool_openclose_path:e.openclose_path,tool_path:e.mode_path,tool_position:e.align_to_page,tool_rect:e.mode_rect,tool_redo:e.redo,tool_reorient:e.reorient_path,tool_select:e.mode_select,tool_source:e.source_save,tool_square:e.mode_square,tool_text:e.mode_text,tool_topath:e.to_path,tool_undo:e.undo,
tool_ungroup:e.ungroup,tool_wireframe:e.wireframe_mode,view_grid:e.toggle_grid,tool_zoom:e.mode_zoom,url_notice:e.no_embed},true);t.setLang(b,d)}};t.putLocale=function(d,k){if(d)b=d;else{b=a.pref("lang");if(!b){if(navigator.userLanguage)b=navigator.userLanguage;else if(navigator.language)b=navigator.language;if(b==null)return}console.log("Lang: "+b);if(a.inArray(b,k)===-1&&b!=="test")b="en"}var e=t.curConfig.langPath+"lang."+b+".js";a.getScript(e,function(v){if(!v){v=document.createElement("script");
v.src=e;document.querySelector("head").appendChild(v)}})};return t}(jQuery,svgEditor);svgedit=svgedit||{};
(function(){var a=this;if(!svgedit.contextmenu)svgedit.contextmenu={};a.contextMenuExtensions={};svgEditor.ready(function(){for(var t in contextMenuExtensions){var l=contextMenuExtensions[t];Object.keys(a.contextMenuExtensions).length===0&&$("#cmenu_canvas").append("<li class='separator'>");var b=l.shortcut||"";$("#cmenu_canvas").append("<li class='disabled'><a href='#"+l.id+"'>"+l.label+"<span class='shortcut'>"+b+"</span></a></li>")}});svgedit.contextmenu.resetCustomMenus=function(){a.contextMenuExtensions={}};
svgedit.contextmenu.add=function(t){if(t&&t.id&&t.label&&t.action&&typeof t.action=="function")if(t.id in a.contextMenuExtensions)console.error('Cannot add extension "'+t.id+'", an extension by that name already exists"');else{console.log("Registed contextmenu item: {id:"+t.id+", label:"+t.label+"}");a.contextMenuExtensions[t.id]=t}else console.error("Menu items must be defined and have at least properties: id, label, action, where action must be a function")};svgedit.contextmenu.hasCustomHandler=
function(t){return a.contextMenuExtensions[t]&&true};svgedit.contextmenu.getCustomHandler=function(t){return a.contextMenuExtensions[t].action}})();
